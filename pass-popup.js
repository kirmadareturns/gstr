document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("domainfor"),t=document.getElementById("domainfor2"),n=document.getElementById("userId0"),o=document.getElementById("password0"),c=(document.getElementById("moreinput"),document.getElementById("nickname0")),a=document.getElementById("save"),d=document.getElementById("search"),s=document.getElementById("AddIcon"),r=document.getElementById("SearchIcon"),i=document.getElementById("credentialsList");function l(){return new Promise((e=>{chrome.tabs.query({active:!0,currentWindow:!0},(t=>{const n=new URL(t[0].url).hostname,o=n.split(".");let c=n;if(o.length>2){const e=["gov.in","co.in","ac.in","nic.in","org.in"],t=o.slice(-2).join("."),n=o.slice(-3).join(".");c=e.includes(t)?n:t}e(c)}))}))}async function u(){const n=await l();e.innerHTML=n,t.innerHTML=n,chrome.storage.local.get([n],(e=>{i.innerHTML='<br><br><br><h5>Create Your GST Credentials Here for Quick and Easy Access. </h5><hr><h3 style="color:blue;"> This is not Mandetory! </h3><hr><h7 style="color:red;">Note: Your credentials will be stored in the browser. Please use this feature only on your personal computer.</h7>',e[n]&&(i.innerHTML="",e[n].forEach((e=>{m(e.userId0,e.password0,e.nickName0)})))}))}function m(e,t,n){const o=document.createElement("li");o.innerHTML=`<i class="fa fa-hand-pointer-o" style="font-size:18px; color:blue;" aria-hidden="true"> ${n} </i>`;const c=document.createElement("button");c.innerHTML='<i class="fa fa-trash-o fa-1x" style="font-size:20px" aria-hidden="true"></i>',c.className="delete-button",c.addEventListener("click",(async t=>{t.stopPropagation();const n=await l();chrome.storage.local.get([n],(t=>{const o=(t[n]||[]).filter((t=>t.userId0!==e));chrome.storage.local.set({[n]:o},(()=>{u()}))}))})),o.appendChild(c),o.addEventListener("click",(()=>{chrome.windows.getCurrent({},(function(e){chrome.windows.update(e.id,{state:"normal",focused:!0})})),chrome.tabs.query({active:!0,currentWindow:!1},(n=>{const o=n[0];chrome.scripting.executeScript({target:{tabId:o.id},files:["pass-content.js"]},(()=>{chrome.tabs.sendMessage(o.id,{action:"typeCredentials",userId:e,password:t},(e=>{if(!e)return document.getElementById("resultPass").innerHTML="No response. Make sure you're on GST portal tab.",void alert("make sure! you're on GST portal tab.");if("GSTReload"==e.error&&location.reload(),e.captchaSrc){document.getElementById("captchaImg").src=e.captchaSrc,document.getElementById("captchaSection").style.display="block",document.getElementById("credentialsList").style.display="none",document.getElementById("captchaInput").focus();const t=document.getElementById("captchaSubmit");captchaInput.addEventListener("keydown",(function(e){"Enter"===e.key&&(e.preventDefault(),t.click())}))}}))}))})),document.getElementById("captchaSubmit").addEventListener("click",(()=>{const e=document.getElementById("captchaInput").value;chrome.windows.getCurrent({},(function(e){chrome.windows.update(e.id,{state:"normal",focused:!0})})),chrome.tabs.query({active:!0,currentWindow:!1},(t=>{const n=t[0];chrome.tabs.sendMessage(n.id,{action:"finishLogin",captcha:e})})),document.getElementById("captchaSection").style.display="none",document.getElementById("captchaInput").value="",document.getElementById("credentialsList").style.display="block"})),chrome.runtime.onMessage.addListener((e=>{"reloadPopup"===e.action&&(location.reload(),chrome.windows.getCurrent({},(function(e){chrome.windows.update(e.id,{state:"maximized",focused:!0})})))}))})),i.appendChild(o)}s.addEventListener("click",(async()=>{document.getElementById("adddiv").style.display="block",document.getElementById("searchdiv").style.display="none"})),r.addEventListener("click",(async()=>{document.getElementById("searchdiv").style.display="block",document.getElementById("adddiv").style.display="none"})),a.addEventListener("click",(async()=>{const e=n.value.trim(),t=o.value.trim(),a=c.value.trim(),d=await l();e&&t&&a&&chrome.storage.local.get([d],(s=>{const r=s[d]||[],i=r.findIndex((t=>t.userId0===e));-1!==i?r[i]={userId0:e,password0:t,nickName0:a}:r.push({userId0:e,password0:t,nickName0:a}),chrome.storage.local.set({[d]:r},(()=>{u(),n.value="",o.value="",c.value=""}))}))})),d.addEventListener("input",(async()=>{const e=d.value.toLowerCase();i.innerHTML="";const t=await l();chrome.storage.local.get([t],(n=>{n[t]&&n[t].filter((t=>t.nickName0.toLowerCase().includes(e))).forEach((e=>{m(e.userId0,e.password0,e.nickName0)}))}))})),u()}));