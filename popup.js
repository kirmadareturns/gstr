"use strict";var port,currentUrl,responseHandlers={},msgId=1,session={hostname:null,gstRegType:"?",businessName:"",gstin:"",dropdown:null,periods:[],return:null,finYear:"2017-18"};let configR3B={key:"G3B",display:"GSTR-3B (JSON)",apiCode:"GSTR3B",fileNameCode:"R3B",fileType:"",fileTypeCode:"",expFilingStatus:"FIL",isQuarterly:!1,isAnnual:!1,needsFileGeneration:!1,hostname:"return.gst.gov.in",startDate:new Date("2017-07-01T00:00:00.000Z")},configR1={key:"G1",display:"GSTR-1 (JSON)",apiCode:"GSTR1",fileNameCode:"R1",fileType:"",fileTypeCode:"",expFilingStatus:"FIL",isQuarterly:!1,isAnnual:!1,needsFileGeneration:!0,hostname:"return.gst.gov.in",startDate:new Date("2017-07-01T00:00:00.000Z")},configR2A={key:"G2A",display:"GSTR-2A (JSON)",apiCode:"GSTR2A",fileNameCode:"R2A",fileType:"",fileTypeCode:"",expFilingStatus:"NF",isQuarterly:!1,isAnnual:!1,needsFileGeneration:!0,hostname:"return.gst.gov.in",startDate:new Date("2017-07-01T00:00:00.000Z")},configR2AExcel={key:"G2AEXL",display:"GSTR-2A (Excel)",apiCode:"GSTR2A",fileNameCode:"R2A",fileType:"EX",fileTypeCode:"EXL",expFilingStatus:"NF",isQuarterly:!1,isAnnual:!1,needsFileGeneration:!0,hostname:"return.gst.gov.in",startDate:new Date("2017-07-01T00:00:00.000Z")},configR2B={key:"G2B",display:"GSTR-2B (JSON)",apiCode:"GSTR2B",fileNameCode:"R2B",fileType:"",fileTypeCode:"",expFilingStatus:"NF",isQuarterly:!1,isAnnual:!1,needsFileGeneration:!1,hostname:"gstr2b.gst.gov.in",startDate:new Date("2020-07-01T00:00:00.000Z")},configR2BE={key:"G2BEXL",display:"GSTR-2B (EXCEL)",apiCode:"GSTR2B",fileNameCode:"R2B",fileType:"EX",fileTypeCode:"EXL",expFilingStatus:"NF",isQuarterly:!1,isAnnual:!1,needsFileGeneration:!0,hostname:"gstr2b.gst.gov.in",startDate:new Date("2020-07-01T00:00:00.000Z")},configR4={key:"G4",display:"GSTR-4 (JSON)",apiCode:"GSTR4",fileNameCode:"R4",fileType:"",fileTypeCode:"",expFilingStatus:"FIL",isQuarterly:!0,isAnnual:!1,needsFileGeneration:!0,hostname:"return.gst.gov.in",startDate:new Date("2017-07-01T00:00:00.000Z")},configR4A={key:"G4A",display:"GSTR-4A (JSON)",apiCode:"GSTR4A",fileNameCode:"R4A",fileType:"",fileTypeCode:"",expFilingStatus:"NF",isQuarterly:!0,isAnnual:!1,needsFileGeneration:!0,hostname:"return.gst.gov.in",startDate:new Date("2017-07-01T00:00:00.000Z")},configR9={key:"G9",display:"GSTR-9 (JSON)",apiCode:"GSTR9",fileNameCode:"R9",fileType:"",fileTypeCode:"",expFilingStatus:"FIL",isQuarterly:!1,isAnnual:!0,needsFileGeneration:!1,hostname:"return.gst.gov.in",startDate:new Date("2017-07-01T00:00:00.000Z")},configCL={key:"CL",display:"GSTR-CL (JSON)",apiCode:"GSTRCL",fileNameCode:"CL",fileType:"",fileTypeCode:"",expFilingStatus:"FIL",isQuarterly:!1,isAnnual:!0,needsFileGeneration:!0,hostname:"payment.gst.gov.in",startDate:new Date("2017-07-01T00:00:00.000Z")},returnConfig={};function connect(t){return new Promise((function(e,n){if(t)try{(port=chrome.tabs.connect(t,{name:"xlsdeal-gst-assistant"})).onMessage.addListener((function(t){responseHandlers[t.Id]&&responseHandlers[t.Id](t)})),e()}catch(t){n(t)}else chrome.tabs.query({active:!0,currentWindow:!0},(function(s){if(!s||!s[0])return n("No active tab found to connect");t=s[0].id;try{(port=chrome.tabs.connect(t,{name:"xlsdeal-gst-assistant"})).onMessage.addListener((function(t){responseHandlers[t.Id]&&responseHandlers[t.Id](t)})),e()}catch(t){n(t)}}))}))}async function processAsync(t){return new Promise((function(e,n){var s=msgId++;responseHandlers[s]=e,t.Id=s,port.postMessage(t)}))}function displayRegType(t){return"NT"==t||"TP"==t?"Regular":"CA"==t?"Casual":"CO"==t?"Composition":t}function displayFilingStatus(t,e,n){return"FIL"==t?"Filed":"NF"==t?"GSTR1"===n?"YES"===window.web_user?'Not filed <button class="yetoR1Retur btn btn-outline-primary" style="height:24px;" data-period="'+e+'">Send to xlsdeal.com</button>':"Not filed | Can View on WebApplication":"Not filed":"FRZ"==t?"GSTR1"===n?"YES"===window.web_user?'Not filed <button class="yetoR1Retur btn btn-outline-primary" style="height:24px;" data-period="'+e+'">Send to xlsdeal.com</button>':"Not filed | Can View on WebApplication":"Submitted, but not filed":t}function displayGenTime(t,e,n,s){const a=moment(`${t} ${e}`,"DD/MM/YYYY HH:mm:ss");return"GSTR1"===s&&"YES"===window.web_user?`<a data-toggle="tooltip" title="Generated on ${t} ${e}">Generated ${a.fromNow()}</a><button class="yetoR1Retur btn btn-outline-primary" style="height:24px; display:none;" data-period="${n}" >Send to xlsdeal.com</button>`:`<a data-toggle="tooltip" title="Generated on ${t} ${e}">Generated ${a.fromNow()}</a>`}function showStatus(t){const e=getElement("status"),n=getElement("statusText");t?(e.hidden=!1,n.innerHTML=t):(e.hidden=!0,n.innerHTML="")}function getElement(t){return document.getElementById(t)}returnConfig[configR3B.key]=configR3B,returnConfig[configR1.key]=configR1,returnConfig[configR2A.key]=configR2A,returnConfig[configR2AExcel.key]=configR2AExcel,returnConfig[configR2B.key]=configR2B,returnConfig[configR2BE.key]=configR2BE,returnConfig[configR4.key]=configR4,returnConfig[configR4A.key]=configR4A,returnConfig[configR9.key]=configR9,returnConfig[configCL.key]=configCL,document.addEventListener("DOMContentLoaded",(async function(){try{const t=await getActiveTabInNormalWindow();if(!t||!t.id)return void showStatus("Please open GST Portal in a normal tab first.");await chrome.scripting.executeScript({target:{tabId:t.id},files:["jszip.min.js"]}),await chrome.scripting.executeScript({target:{tabId:t.id},files:["contentscript.js"]}),await startupAsync(t)}catch(t){showStatus('<sapn id="gstportalopen" style="cursor:pointer;">Please Click to open <b style="color:blue;"  class="blink">https://gst.gov.in</b>  in your <i class="fa fa-chrome fa-spin fa-1x fa-fw" aria-hidden="true"></i> Browser<br><br><img src="images/gst.png" style=" width:40%; height:auto; margin-left:30%;"></span>')}}),!1),document.addEventListener("click",(function(t){const e=t.target;if(t.target.classList.contains("yetoR1Retur")){const n=t.target.dataset.period;e.disabled=!0;e.innerHTML;e.innerHTML="Waiting...",document.getElementById("result").innerHTML="<i class='fa fa-spinner fa-pulse fa-3x fa-fw' aria-hidden='true'></i> Please Wait..",yetoR1Retur(n)}}));const gstn={ustatus:function(t){return"gstr2b.gst.gov.in"==t?"https://gstr2b.gst.gov.in/services/api/ustatus?adhrflag=N":`https://${t}/services/api/ustatus`},dropdown:t=>`https://${t}/returns/auth/api/dropdown`,rolestatus:function(t,e){let n=new URL(`https://${t}/returns/auth/api/rolestatus`);return n.searchParams.set("rtn_prd",e.value),e.rt&&n.searchParams.set("userType",e.rt),n.toString()},generateFile:function(t,e,n,s){let a=new URL(`https://${t}/returns/auth/api/offline/download/generate`);return a.searchParams.set("rtn_typ",e.apiCode),a.searchParams.set("rtn_prd",n.value),a.searchParams.set("flag",s?"1":"0"),e.fileType&&a.searchParams.set("file_type",e.fileType),a.toString()},pdfgenerateR1:function(t,e){let n=new URL("https://return.gst.gov.in/returns/auth/api/gstr1/summary");return n.searchParams.set("rtn_prd",t.value),n.searchParams.set("flag",e?"1":"0"),n.toString()},downloadFile:function(t,e,n,s){let a=new URL(`https://${t}/returns/auth/api/offline/download/url`);return a.searchParams.set("rtn_typ",e.apiCode),a.searchParams.set("rtn_prd",n.value),a.searchParams.set("file_num",s),e.fileType&&a.searchParams.set("file_type",e.fileType),a.toString()},gstr3bSummary:function(t,e){let n=new URL(`https://${t}/returns/auth/api/gstr3b/summary`);return n.searchParams.set("rtn_prd",e.value),n.toString()},gstrCLSummary:function(t,e,n){let s=new URL("https://payment.gst.gov.in/payment/auth/api/cashdetls");return s.searchParams.set("fdate",e),s.searchParams.set("tdate",n),decodeURIComponent(s)},gstr3bPayable:function(t,e){let n=new URL(`https://${t}/returns/auth/api/gstr3b/taxpayble`);return n.searchParams.set("rtn_prd",e.value),n.toString()},annualrolestatus:function(t,e){let n=new URL(`https://${t}/returns2/auth/api/annualrolestatus`);return n.searchParams.set("return_prd",`03${e+1}`),n.toString()},gstr2b:function(t,e,n){let s=new URL(`https://${t}/gstr2b/auth/api/gstr2b/getjson`);return s.searchParams.set("rtnprd",e.value),n&&s.searchParams.set("fn",n.toString()),s.toString()},gstr2bCheck:function(t,e){let n=new URL(`https://${t}/gstr2b/auth/api/gstr2b/getdata`);return n.searchParams.set("rtnprd",e.value),n.toString()}};function saveJsonFile(t,e){var n=new Blob([e],{type:"text/json"}),s=URL.createObjectURL(n);chrome.downloads.download({url:s,filename:t})}function saveZipFile(t,e){var n=new Blob([e],{type:"application/zip"}),s=URL.createObjectURL(n);chrome.downloads.download({url:s,filename:t})}function saveBlobUrl(t,e){chrome.downloads.download({url:e,filename:t})}function zip(t,e,n){var s=new JSZip;s.file(e,t),s.generateAsync({type:"blob"}).then(n)}function saveJsonAsZipAsync(t,e,n){return processAsync({request:"save-json-as-zip",jsonfilename:t,zipfilename:e,jsonData:n})}function formatNumber(t,e){for(var n=""+t;n.length<e;)n="0"+n;return n}function extractRegex(t,e){var n=new RegExp(e).exec(t);return n?n[0]:n}function makeJsonFileName(t,e,n){var s=new Date;return`returns_${formatNumber(s.getDate(),2)+formatNumber(s.getMonth()+1,2)+s.getFullYear()}_${t}_${e}_${n}`}function makeZipFileName(t,e,n,s){var a=new Date;return`${e}_${t}_${n}_${a.getFullYear()+formatNumber(a.getMonth()+1,2)+formatNumber(a.getDate(),2)}${s?`_${s}`:""}`}function getFileGenStatus(t){return void 0===t.status?"Invalid response received":1!=t.status?void 0===t.error?"Unknown error occurred":"RTN_24"==t.error.errorCode||"RTN_24_2A"==t.error.errorCode?(getElement("banner-generating").hidden=!1,"Generating file..."):t.error.message:void 0===t.data?"No response received":0==t.data.status?null:1==t.data.status?(getElement("banner-generating").hidden=!1,"Generating file..."):t.data.msg}function getReturnInfo(t,e){var n;for(n=0;n<t.data.user.length;n++){var s,a=t.data.user[n];for(s=0;s<a.returns.length;s++)if(a.returns[s].return_ty==e)return a.returns[s]}return{status:"Not available"}}async function getActiveTabInNormalWindow(){const t=await chrome.windows.getAll({populate:!0,windowTypes:["normal"]});for(const e of t){const t=e.tabs.find((t=>t.active));if(t)return t}return null}async function startupAsync(t){try{const e=t||await getActiveTabInNormalWindow();if(!e||!e.url||e.url.startsWith("chrome://")||e.url.startsWith("chrome-extension://"))return void showStatus("Please open GST Portal in a normal tab first.");const n=new URL(e.url);session.hostname=n.hostname.toLowerCase(),showStatus("Connecting..."),await connect(e.id),showStatus("!! Radhe Radhe !! <br><br> [F5] Refresh! | Please Open GST Portal");const s=await processAsync({request:"get",url:gstn.ustatus(session.hostname)});if(showStatus("!! Radhe Radhe !!  <br><br> [F5] Refresh! | Please Open GST Portal"),!s.status)return showStatus('Redirected to: <a href="https://services.gst.gov.in/services/login" target="_blank">gst.gov.in</a>'),await redirectgstPage(),showStatus("<span text-align='center'><br> You may not be login yet! at <b class='blink' style='color:blue;'>gst.gov.in </b><br><span style='color:grey; font-size:10px;'>** Please [F5] Refresh after login.</span></span><br><br>"),document.getElementById("NoticeBoard").style.display="none",void(document.getElementById("passmanager").style.display="block");const a=JSON.parse(s.response);if(!a.regType)return showStatus("<span text-align='center'><br>You may not be login yet! at <b class='blink' style='color:blue;'>gst.gov.in </b><br><span style='color:grey; font-size:10px;'>** Please [F5] Refresh after login.</span></span><br><br>"),document.getElementById("NoticeBoard").style.display="none",void(document.getElementById("passmanager").style.display="block");if("return.gst.gov.in"!==session.hostname&&"gstr2b.gst.gov.in"!==session.hostname&&"payment.gst.gov.in"!==session.hostname)return showStatus("Please Wait...<i class='fa fa-spinner fa-pulse fa-3x fa-fw' aria-hidden='true'></i> || Press [F5] to Reload!"),setTimeout((()=>{location.reload()}),1e3),void await intoReturnPage();await updateBusinessInfo(a)}catch(t){console.error("Error during startupAsync:",t),showStatus("An error occurred!")}}async function intoReturnPage(){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!1});"return.gst.gov.in"==new URL(t.url).host||(await chrome.scripting.executeScript({target:{tabId:t.id},function:clickOnButtonReturn}),setTimeout((()=>{location.reload()}),1e3),document.getElementById("result").innerHTML="<h1 style='color:blue; font-style:bold; text-align:center; margin-left:10%'><i class='fa fa-hand-o-up' aria-hidden='true'></i> Re-Click to Start</h1>")}catch(t){console.error("Error in intoReturnPage:",t),showStatus("An error occurred while navigating. ")}}async function intoReturnPagenoRefresh(){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!1});"return.gst.gov.in"==new URL(t.url).host||(await chrome.scripting.executeScript({target:{tabId:t.id},function:clickOnButtonReturn}),document.getElementById("returnStatus").style.display="none")}catch(t){console.error("Error in intoReturnPage:",t),showStatus("An error occurred while navigating. ")}}function clickOnButtonReturn(){const t=document.createElement("a");t.href="https://return.gst.gov.in/returns/auth/dashboard",t.target="_self",t.textContent="xlsdeal",t.id="xlsdeal",document.body.appendChild(t),t.click()}async function intoCLedgerPage(){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!1});new URL(t.url);await chrome.scripting.executeScript({target:{tabId:t.id},function:clickOnButtonCledger})}catch(t){console.error("Error in intoCLedgerPage:",t),showStatus("An error occurred while navigating. ")}}function clickOnButtonCledger(){const t=document.createElement("a");t.href="https://payment.gst.gov.in/payment/auth/ledger/cashledger",t.target="_self",t.textContent="xlsdeal",t.id="xlsdeal",document.body.appendChild(t),t.click()}async function intoLogoutPage(){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!1});new URL(t.url);await chrome.scripting.executeScript({target:{tabId:t.id},function:clickOnButtonLogout}),chrome.windows.getCurrent({},(function(t){chrome.windows.update(t.id,{state:"normal",focused:!0})}))}catch(t){console.error("Error in intoCLedgerPage:",t),showStatus("An error occurred while navigating. ")}}function clickOnButtonLogout(){const t=document.createElement("a");t.href="https://services.gst.gov.in/services/logout",t.target="_self",t.textContent="xlsdeal",t.id="xlsdeal",document.body.appendChild(t),t.click()}async function intoNoticsPage(){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!1});new URL(t.url);await chrome.scripting.executeScript({target:{tabId:t.id},function:clickOnintoNoticsPage})}catch(t){console.error("Error in intoNoticePage:",t),showStatus("An error occurred while navigating. ")}}function clickOnintoNoticsPage(){const t=document.createElement("a");t.href="https://services.gst.gov.in/litserv/auth/viewadnlntcord",t.target="_self",t.textContent="xlsdeal",t.id="xlsdeal",document.body.appendChild(t),t.click()}async function intodeshboadPage(){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!1});new URL(t.url);await chrome.scripting.executeScript({target:{tabId:t.id},function:clickOnintodeshboadPage})}catch(t){console.error("Error in intoNoticePage:",t),showStatus("An error occurred while navigating. ")}}function clickOnintodeshboadPage(){const t=document.createElement("a");t.href="https://services.gst.gov.in/services/auth/dashboard",t.target="_self",t.textContent="xlsdeal",t.id="xlsdeal",document.body.appendChild(t),t.click()}async function intoGSINSearchPage(){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!1});new URL(t.url);await chrome.scripting.executeScript({target:{tabId:t.id},function:clickOnintoGSINSearchPage})}catch(t){console.error("Error in intoNoticePage:",t),showStatus("An error occurred while navigating. ")}}function clickOnintoGSINSearchPage(){const t=document.createElement("a");t.href="https://services.gst.gov.in/services/auth/searchtp",t.target="_self",t.textContent="xlsdeal",t.id="xlsdeal",document.body.appendChild(t),t.click()}async function intoReturn2BPage(){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!1});"gstr2b.gst.gov.in"==new URL(t.url).host||(await chrome.scripting.executeScript({target:{tabId:t.id},function:clickOnButton2BReturn}),setTimeout((()=>{location.reload()}),1e3),document.getElementById("result").innerHTML="<h1 style='color:blue; font-style:bold; text-align:center; margin-left:15%'><i class='fa fa-hand-o-up' aria-hidden='true'></i> Re-Click to Start</h1>")}catch(t){console.error("Error in intoReturnPage:",t),showStatus("An error occurred while navigating. ")}}function clickOnButton2BReturn(){const t=document.createElement("a");t.href="https://gstr2b.gst.gov.in/gstr2b/auth/gstr2b/summary",t.target="_self",t.textContent="xlsdeal",t.id="xlsdeal",document.body.appendChild(t),t.click()}async function intoReturn2BPagewoRefresh(){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!1});"gstr2b.gst.gov.in"==new URL(t.url).host||(await chrome.scripting.executeScript({target:{tabId:t.id},function:clickOnButton2BReturn}),setTimeout((()=>{}),1e3),document.getElementById("result").innerHTML="<h1 style='color:blue; font-style:bold; text-align:center; margin-left:15%'><i class='fa fa-hand-o-up' aria-hidden='true'></i> Re-Click to Start</h1>")}catch(t){console.error("Error in intoReturnPage:",t),showStatus("An error occurred while navigating. ")}}async function redirectgstPage(){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!1});new URL(t.url);await chrome.scripting.executeScript({target:{tabId:t.id},function:clickOnButtonReturn2})}catch(t){console.error("Error in intoReturnPage:",t),showStatus("An error occurred while navigating. ")}}function clickOnButtonReturn2(){const t=document.createElement("a");t.href="https://services.gst.gov.in/services/login",t.target="_self",t.textContent="xlsdeal",t.id="xlsdeal",document.body.appendChild(t),t.click()}async function updateBusinessInfo(t){try{showStatus(null);const{bname:e,gstin:n,regType:s}=t;switch(session.businessName=e,session.gstin=n,getElement("businessName").innerHTML=session.businessName,getElement("businessGSTIN").innerHTML="GSTIN: "+session.gstin,getElement("businessName2").innerHTML=session.businessName,getElement("businessGSTIN2").innerHTML="GSTIN: "+session.gstin,getElement("gstin").value=session.gstin,getElement("businessInfo").hidden=!1,s){case"NT":case"TP":case"CA":session.gstRegType="";break;case"CO":session.gstRegType="CO";break;default:return void showStatus(`Registration type ${s} is not supported.`)}await updatePeriods(),runautochecker()}catch(t){console.error("Error updating business info:",t),showStatus("Please Refresh [F5] An error occurred while updating business info."),intoReturnPage(),setTimeout((()=>{location.reload()}),1e3)}}function addOption(t,e,n){var s=document.createElement("option");s.value=n,s.innerHTML=e,t.appendChild(s)}function updateReturns(){const t=getElement("gstReturnType");session.gstRegType?(addOption(t,configR4.display,configR4.key),addOption(t,configR4A.display,configR4A.key),addOption(t,configR3B.display,configR3B.key),addOption(t,configR1.display,configR1.key),addOption(t,configR2A.display,configR2A.key),addOption(t,configR2B.display,configR2B.key),addOption(t,configR2BE.display,configR2BE.key),addOption(t,configR2AExcel.display,configR2AExcel.key),addOption(t,configR9.display,configR9.key),addOption(t,configCL.display,configCL.key)):(addOption(t,configR3B.display,configR3B.key),addOption(t,configR1.display,configR1.key),addOption(t,configR2A.display,configR2A.key),addOption(t,configR2AExcel.display,configR2AExcel.key),addOption(t,configR2B.display,configR2B.key),addOption(t,configR2BE.display,configR2BE.key),addOption(t,configR9.display,configR9.key),addOption(t,configR4.display,configR4.key),addOption(t,configR4A.display,configR4A.key),addOption(t,configCL.display,configCL.key))}async function updatePeriods(){showStatus('Please Wait.... <i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i>   [F5] Refresh! | { Getting periods}');const t=await processAsync({request:"get",url:gstn.dropdown(session.hostname)});if(!t.status)return void showStatus("Failed to get periods!");const e=JSON.parse(t.response);if(1!=e.status)return void showStatus("Rejected");showStatus(null),session.dropdown=e.data,session.dropdown.Years.sort(((t,e)=>-1*t.year.localeCompare(e.year)));const n=getElement("finYear");for(let t=0;t<session.dropdown.Years.length;t++){let e=document.createElement("option");e.value=session.dropdown.Years[t].year,e.innerHTML=session.dropdown.Years[t].year,n.appendChild(e)}const s=getElement("finYearcl");for(let t=0;t<session.dropdown.Years.length;t++){let e=document.createElement("option");e.value=session.dropdown.Years[t].year,e.innerHTML=session.dropdown.Years[t].year,s.appendChild(e)}getElement("refresher").onclick=function(t){location.reload()};getElement("meLogout").onclick=function(t){intoLogoutPage(),setTimeout((()=>{location.reload()}),100)},getElement("workspace").hidden=!1}function fetchPaidChallns(){const t=document.getElementById("finYear").value.slice(0,4);chrome.windows.getCurrent({},(function(t){chrome.windows.update(t.id,{state:"maximized"})})),function(t){const e=new Date;function n(t){const[e,n,s]=t.split("/").map(Number);return new Date(s,n-1,e)}function a(t){return t.toLocaleDateString("en-GB")}[{start:`01/04/${t}`,end:`31/07/${t}`},{start:`01/08/${t}`,end:`30/11/${t}`},{start:`01/12/${t}`,end:`31/03/${Number(t)+1}`}].forEach((t=>{let i=n(t.start),o=n(t.end);i<=e&&(e<=o&&(o=e),s(`${a(i)}`,`${a(o)}`,`${session.gstin}`))}))}(t);let e=1,n="<button class='btn btn-outline-info' id='download-selected'><i class='fa fa-file-pdf-o' aria-hidden='true'> Download Selected</i></button> <button id='exportBtn' class='btn btn-outline-primary' style='margin-left:160px;  border-radius:18px;'><i class='fa fa-file-excel-o' aria-hidden='true'></i> Download</button><table id='challanstable' border='1' style='border-collapse:collapse;width:100%;text-align:center;'>";function s(t,s,a){chrome.tabs.query({active:!0,currentWindow:!1},(i=>{const o=i[0];chrome.scripting.executeScript({target:{tabId:o.id},files:["contentscript.js"]},(()=>{chrome.tabs.sendMessage(o.id,{action:"fetchchallansme",fr:t,to:s,gstin:a},(s=>{const a=document.getElementById("result");if(s){if(s.success){const i=s.data;if(!Array.isArray(i)||0===i.length)return void(a.innerHTML="No challan records found.");i.forEach(((s,a)=>{"S"===s.status&&(n+="<tr>",n+=`<td><input type="checkbox" value="${t||""}"></td>`,n+=`<td>${e++}</td>`,n+=`<td>${s.payment_dt||""}</td>`,n+=`<td>${s.payment_tim||""}</td>`,n+=`<td>${s.cpin||""}</td>`,n+=`<td class="pdf-cell" data-json='${JSON.stringify(s.pdf_json_data)}'><a href="#"><i class="fa fa-file-pdf-o" aria-hidden="true">   ${s.pdf_json_data?.brn_num||""}</i></a></td>`,n+=`<td>${s.pdf_json_data?.cin||""}</td>`,n+=`<td>${s.pdf_json_data?.bank_nam||""}</td>`,n+=`<td style="text-align:right;">${indianFormat(s.igst_tot_amt)||""}</td>`,n+=`<td style="text-align:right;">${indianFormat(s.cgst_tot_amt)||""}</td>`,n+=`<td style="text-align:right;">${indianFormat(s.sgst_tot_amt)||""}</td>`,n+=`<td style="text-align:right;">${indianFormat(s.cess_tot_amt)||""}</td>`,n+=`<td style="text-align:right;"><b>${indianFormat(s.total_amt)||""}</b></td>`,n+="</tr>")})),a.style.height="75%",a.innerHTML=n,function(){const t=document.querySelector("#result table tbody"),e=Array.from(t.querySelectorAll("tr"));e.sort(((t,e)=>{const n=t.cells[2].innerText.trim(),s=e.cells[2].innerText.trim(),[a,i,o]=n.split("/").map(Number),[l,r,d]=s.split("/").map(Number);return new Date(o,i-1,a)-new Date(d,r-1,l)})),e.forEach(((e,n)=>{e.cells[1].innerText=n+1,t.appendChild(e)}))}(),document.getElementById("exportBtn").addEventListener("click",(()=>{const t=XLSX.utils.book_new(),e=document.querySelector("#challanstable");if(e){const n=XLSX.utils.table_to_sheet(e);Object.keys(n).forEach((t=>{if("!"===t[0])return;const s=parseInt(t.replace(/[^0-9]/g,""))-1,a=t.replace(/[0-9]/g,"").charCodeAt(0)-65;if(1===a){const i=e.rows[s]?.cells[a];if(i){const e=i.innerText.trim();n[t].t="s",n[t].v=e,n[t].w=e}}})),XLSX.utils.book_append_sheet(t,n,"XLSDEAL-Challan")}XLSX.writeFile(t,`${finYear.value}_Challans_${session.gstin}.xlsx`)})),document.getElementById("ALLChecks").addEventListener("change",(function(){const t=this.checked;document.querySelectorAll("#result input[type='checkbox']").forEach((e=>{e.checked=t}))}))}else a.innerHTML=`Error: ${s.error}`;document.querySelectorAll(".pdf-cell").forEach((t=>{t.addEventListener("click",(()=>{const e=JSON.parse(t.dataset.json),n=t.closest("tr"),s=n.closest("tbody"),a=Array.from(s.rows).indexOf(n);"Prime"===window.userStatusNow||a<4?generateChallanPDF(e):showpopup()}))})),document.getElementById("download-selected").addEventListener("click",(()=>{"Prime"===window.userStatusNow?function(){const t=document.querySelectorAll("#result table tbody input[type='checkbox']:checked");if(0===t.length)return void alert("Please select at least one checkbox!");t.forEach((t=>{const e=t.closest("tr").querySelector(".pdf-cell");if(e){const t=JSON.parse(e.dataset.json);generateChallanPDF(t)}}))}():showpopup()}))}else a.innerHTML="No response. Make sure you're on GST portal tab."}))}))}))}n+='\n    <thead>\n      <tr>\n        <th><input type="checkbox" id="ALLChecks"> Select</th>\n        <th>SL</th>\n              <th>PAYMENT DATE</th>\n        <th>TIME</th>\n        <th>CPIN</th>\n        <th>E-Cheque [Download]</th>\n        <th>UTR</th>\n        <th>BANK</th>\n\n        <th>IGST</th>\n        <th>CGST</th>\n        <th>SGST</th>\n        <th>CESS</th>\n        <th>TOTAL</th>\n        \n      </tr>\n    </thead>\n    <tbody>\n  '}function my_all_reports_fetch(t){const e=document.getElementById("finYearcl").value.slice(0,4);chrome.tabs.query({active:!0,currentWindow:!1},(n=>{const s=n[0];chrome.scripting.executeScript({target:{tabId:s.id},files:["contentscript.js"]},(()=>{chrome.tabs.sendMessage(s.id,{action:"allreports",slectfy:e},(e=>{e?e.success&&(document.getElementById("result").style.height="75%",document.getElementById("result").innerHTML="",view_allreports(e.data.data,t)):document.getElementById("result").innerHTML="No response Make sure you're on GST portal tab."}))}))}))}async function xlsdeal_m2mtable(t){if("GSTR2B"==t?intoReturn2BPage():intoReturnPage(),session.hostname!=session.return.hostname){return void(getElement("returnStatus").innerHTML=session.return.key==configR2B.key?'<div class="row alert alert-warning" role="alert">Please open GSTR-2B of any period to download GSTR-2B JSON files. </div>':`<div class="row alert alert-warning" role="alert">Please open Return Dashboard to download ${session.return.display}.</div>`)}if(session.return.key==configR9.key)return void await updateWorkspaceForGstr9();const e=getElement("returnStatus");e.innerHTML=`Getting ${session.return.display} status...`;let n="";session.periods.length=0;for(let t=0;t<session.dropdown.Years.length;t++)if(session.dropdown.Years[t].year==session.finYear)for(var s=0;s<session.dropdown.Years[t].months.length;s++){let e=session.dropdown.Years[t].months[s];e.isValid=!1,session.periods.push(e);let i="",o="";if("EX"!==session.return.fileType&&(i="YES"===window.web_user?`\n    <button type="button" class="btn btn-outline-info" style="width:50px" id="viw-gen-${e.value}" data-fp="${e.value}" hidden><i class="fa fa-eye" aria-hidden="true"></i> VIEW</button>\n    <button type="button" class="btn btn-outline-primary" style="width:106px" id="upload-gen-${e.value}" data-fp="${e.value}" hidden>Send to xlsdeal.com</button>\n    `:`\n    <button type="button" class="btn btn-outline-info" style="width:50px" id="viw-gen-${e.value}" data-fp="${e.value}" hidden><i class="fa fa-eye" aria-hidden="true"></i> VIEW</button>\n    <span hidden><button type="button" class="btn btn-outline-primary" style="width:106px" id="upload-gen-${e.value}" data-fp="${e.value}" hidden>Send to xlsdeal.com</button></span>\n    `),o="R1"===session.return.fileNameCode||"R3B"===session.return.fileNameCode?`<button type="button" style="width:50px" class="btn btn-outline-danger" id="pdf-gen-${e.value}" data-fp="${e.value}" hidden><i class="fa fa-file-pdf-o" aria-hidden="true"></i> PDF</button>`:"","R1"===session.return.fileNameCode||"R2A"===session.return.fileNameCode||"R2B"===session.return.fileNameCode)var a=`<button type="button" style="width:50px" class="btn btn-outline-success" id="xlsx-gen-${e.value}" data-fp="${e.value}" hidden><i class="fa fa-file-excel-o" aria-hidden="true"></i> XLS</button>`;else a="";let l=session.return.needsFileGeneration?`<div class="btn-group btn-group-sm" role="group">\n          <button type="button" class="btn btn-success" style="width:75px" id="btn-download-${e.value}" data-fp="${e.value}" hidden><i class="fa fa-cloud-download" aria-hidden="true"></i> Download</button>\n          <span hidden><button type="button" class="btn btn-warning" id="btn-gen-${e.value}" data-fp="${e.value}" style="width:75px" hidden><i class="fa fa-history" aria-hidden="true"></i> Generate</button></span>\n        ${o}${a}${i}\n        </div>`:`<div class="btn-group btn-group-sm" role="group"><button type="button" class="btn btn-success btn-sm" id="btn-download-${e.value}" data-fp="${e.value}" style="width:75px" hidden><i class="fa fa-cloud-download" aria-hidden="true"></i>Download</button>\n        ${o}${a}${i}</div>`;n+=`<tr>\n          <td class="align-middle" style="font-size:12px; width:120px;"><b>${e.month}</b></td>\n          <td class="align-middle">${l}</td>\n          <td class="align-middle" style="color:blue; font-style: italic; font-size:10px;"><span style="display: inline-block;overflow: hidden;white-space: nowrap;max-width: 350px;text-overflow: ellipsis;/* overflow: hidden; */vertical-align: bottom;" id="info-${e.value}">...</span></td>\n          \n        </tr>`}if("YES"===window.web_user)var i=session.return.needsFileGeneration?'<div class="btn-group btn-group-sm float-right mr-2" role="group">\n      <button type="button" class="btn btn-success" id="btn-download-all" hidden><strong><i class="fa fa-download" aria-hidden="true"></i> JSON All</strong></button>\n      <button type="button" class="btn btn-warning" id="btn-gen-all" hidden><strong>Generate All</strong></button>\n    <button type="button" class="btn btn-outline-primary" id="upload-gen-all" ><strong> Send all to xlsdeal.com</strong></button>\n    </div>':'<div class="btn-group btn-group-sm float-right mr-2" role="group">\n    <button type="button" class="btn btn-info" id="club_view_r2b" hidden><strong><i class="fa fa-eye" aria-hidden="true"></i> View All</strong></button>\n      <button type="button" class="btn btn-success" id="btn-download-all" hidden><strong><i class="fa fa-download" aria-hidden="true"></i> JSON All</strong></button>\n    <button type="button" class="btn btn-outline-primary" id="upload-gen-all" ><strong> Send all to xlsdeal.com</strong></button>\n    </div>';else i=session.return.needsFileGeneration?'<div class="btn-group btn-group-sm float-right mr-2" role="group">\n      <button type="button" class="btn btn-success" id="btn-download-all" hidden><strong><i class="fa fa-download" aria-hidden="true"></i> JSON All</strong></button>\n      <button type="button" class="btn btn-warning" id="btn-gen-all" hidden><strong>Generate All</strong></button>\n    <button type="button" class="btn btn-outline-primary" id="upload-gen-all" style="display:none"><strong> Send all to xlsdeal.com</strong></button>\n    </div>':'<div class="btn-group btn-group-sm float-right mr-2" role="group">\n    <button type="button" class="btn btn-info" id="club_view_r2b" hidden><strong><i class="fa fa-eye" aria-hidden="true"></i> View All</strong></button>\n      <button type="button" class="btn btn-success" id="btn-download-all" hidden><strong><i class="fa fa-download" aria-hidden="true"></i> JSON All</strong></button>\n    <button type="button" class="btn btn-outline-primary" id="upload-gen-all" style="display:none"><strong> Send all to xlsdeal.com</strong></button>\n    </div>';e.innerHTML=`<div class="row">\n      <table class="table table-bordered table-sm">\n        <tr>\n          <th>Period</th>\n          <th>Action: for ${t}</th>\n          <th>Status</th>\n        </tr>\n        ${n}\n      </table>\n    </div>\n    <div class="row" id="all" hidden>\n      <div class="col px-0">${i}</div>\n    </div>`;let o=0;if(session.return.key==configR2B.key)for(let t=0;t<session.periods.length;t++)await updateRow2B(session.periods[t]);else await Promise.all(session.periods.map((t=>updateRow(t))));for(let t=0;t<session.periods.length;t++)session.periods[t].isValid&&o++;if(o>1){getElement("all").hidden=!1;const t=getElement("btn-download-all");t.hidden=!1,t.onclick=function(t){reportButtonClicked(t),downloadAll()};const e=getElement("upload-gen-all");e.hidden=!1,e.onclick=function(t){reportButtonClicked(t),uplaodAll()};const n=getElement("club_view_r2b");n&&(n.hidden=!1,n.onclick=function(t){reportButtonClicked(t),club_gstr2b_view()});const s=getElement("btn-gen-all");s&&(s.hidden=!1,s.onclick=function(t){reportButtonClicked(t),generateAll()})}}async function updateRow(t){const e=getElement(`info-${t.value}`);let n=parseInt(t.value.substring(0,2)),s=parseInt(t.value.substring(2));if(session.return.isQuarterly){if(n<13)return void(e.innerHTML="Not available")}if(session.return.startDate&&n<13){if(new Date(Date.UTC(s,n-1,1))<session.return.startDate)return void(e.innerHTML="Not available")}const a=await processAsync({request:"get",url:gstn.rolestatus(session.hostname,t)});if(!a.status)return void(e.innerHTML="Failed!");const i=getReturnInfo(JSON.parse(a.response),session.return.apiCode).status;if(i!=session.return.expFilingStatus)return void(e.innerHTML=displayFilingStatus(i,t.value,session.return.apiCode));if(session.return.needsFileGeneration){e.innerHTML="Checking files...";let n=await processAsync({request:"get",url:gstn.generateFile(session.hostname,session.return,t,!1)});if(!n.status)return void(e.innerHTML="Failed!");const s=JSON.parse(n.response),a=getFileGenStatus(s);if(a)return void(e.innerHTML=a);e.innerHTML=displayGenTime(s.data.date,s.data.time,t.value,session.return.apiCode),t.isValid=!0,t.fileCount=s.data.url.length}else e.innerHTML="Filed",t.isValid=!0,t.fileCount=1;const o=getElement(`btn-download-${t.value}`),l=getElement(`viw-gen-${t.value}`),r=getElement(`upload-gen-${t.value}`),d=getElement(`pdf-gen-${t.value}`),c=getElement(`xlsx-gen-${t.value}`);if(o.innerHTML=1==t.fileCount?'<i class="fa fa-download" aria-hidden="true"></i> JSON':`JSON ${t.fileCount} files`,o.hidden=!1,l.hidden=!1,r.hidden=!1,d&&(d.hidden=!1),c&&(c.hidden=!1),o.onclick=function(e){reportButtonClicked(e),"Prime"===window.userStatusNow||"April"==t.month||"May"==t.month||"June"==t.month?download(t):(document.getElementById("result").innerHTML="",download(t),alert("Please Upgrade Your "+session.gstin+" to Prime user! get Unlimited Access."))},l.onclick=function(e){document.getElementById("result").innerHTML="Please Wait.....<i class='fa fa-spinner fa-pulse fa-3x fa-fw' aria-hidden='true'></i> Radhe Radhe!!",reportButtonClicked(e),"Prime"===window.userStatusNow||"April"==t.month||"May"==t.month||"June"==t.month?viewdownload(t,session.return.apiCode):(document.getElementById("result").innerHTML="",showpopup())},d&&(d.onclick=function(e){document.getElementById("result").innerHTML="Please Wait.....<i class='fa fa-spinner fa-pulse fa-3x fa-fw' aria-hidden='true'></i> Radhe Radhe!!",reportButtonClicked(e),"Prime"===window.userStatusNow||"April"==t.month||"May"==t.month||"June"==t.month?pdfdownload(t,session.return.apiCode):(document.getElementById("result").innerHTML="",showpopup()),document.getElementById("result").innerHTML=""}),r.onclick=function(e){reportButtonClicked(e),"Prime"===window.userStatusNow||"April"==t.month||"May"==t.month||"June"==t.month?UplaodJsonxlsdeal(t):(document.getElementById("result").innerHTML="",showpopup())},c&&(c.onclick=function(e){document.getElementById("result").innerHTML="Please Wait.....<i class='fa fa-spinner fa-pulse fa-3x fa-fw' aria-hidden='true'></i> Radhe Radhe!!",reportButtonClicked(e),"Prime"===window.userStatusNow||"April"==t.month||"May"==t.month||"June"==t.month?xlsxdownload(t,session.return.apiCode):(document.getElementById("result").innerHTML="",showpopup())}),session.return.needsFileGeneration){const e=getElement(`btn-gen-${t.value}`),n=getElement(`viw-gen-${t.value}`),s=getElement(`upload-gen-${t.value}`),a=getElement(`pdf-gen-${t.value}`),i=getElement(`xlsx-gen-${t.value}`);e.hidden=!1,n.hidden=!1,s.hidden=!1,a&&(a.hidden=!1),i&&(i.hidden=!1),e.onclick=function(e){reportButtonClicked(e),generate(t)},n.onclick=function(e){document.getElementById("result").innerHTML="Please Wait.....<i class='fa fa-spinner fa-pulse fa-3x fa-fw' aria-hidden='true'></i> Radhe Radhe!!",reportButtonClicked(e),"Prime"===window.userStatusNow||"April"==t.month||"May"==t.month||"June"==t.month?viewdownload(t,session.return.apiCode):(document.getElementById("result").innerHTML="",showpopup())},a&&(a.onclick=function(e){document.getElementById("result").innerHTML="Please Wait.....<i class='fa fa-spinner fa-pulse fa-3x fa-fw' aria-hidden='true'></i> Radhe Radhe!!",reportButtonClicked(e),"Prime"===window.userStatusNow||"April"==t.month||"May"==t.month||"June"==t.month?pdfdownload(t,session.return.apiCode):(document.getElementById("result").innerHTML="",showpopup()),document.getElementById("result").innerHTML=""}),s.onclick=function(e){reportButtonClicked(e),"Prime"===window.userStatusNow||"April"==t.month||"May"==t.month||"June"==t.month?UplaodJsonxlsdeal(t):(document.getElementById("result").innerHTML="",showpopup())}}}function yetoR1Retur(t){document.getElementById("result").innerHTML='<i class="fa fa-spinner fa-pulse fa-3x fa-fw" aria-hidden="true"></i> Please Wait...';const e=t;chrome.tabs.query({active:!0,currentWindow:!1},(t=>{if(!t||!t.length)return;const n=t[0];chrome.scripting.executeScript({target:{tabId:n.id},files:["contentscript.js"]},(()=>{const t=["B2B","CN"],s={};let a=0,i=!1;function o(l,r=!1){chrome.tabs.sendMessage(n.id,{action:"imsoutward",gstin:session.gstin,section:l,period:e},(n=>{r||a++,n&&n.success?s[l]=n.data:s[l]={status:0},function(){if(a!==t.length)return;if(!(s.B2B&&0!==s.B2B.status&&s.B2B.data?.b2b&&0!==s.B2B.data.b2b.length||i))return i=!0,console.warn("⚠ B2B empty, retrying once..."),void o("B2B",!0);!function(){const t={b2b:s.B2B?.data?.b2b||[],cn:s.CN?.data?.cdn||[]};if(!t.b2b.length)return void console.error("❌ B2B still empty after retry. Upload aborted.");const n=flattenGSTData(t),a={gstin:session.gstin,fp:e,data:n};uploadJsonFileR1N(session.gstin,"R1N",e,a),console.log("✅ R1N upload completed",a)}()}()}))}t.forEach((t=>o(t)))}))}))}function uploadJsonFileR1N(t,e,n,s){document.getElementById("result").innerHTML='<i class="fa fa-spinner fa-pulse fa-3x fa-fw" aria-hidden="true"></i> Please Wait... for '+n;const a=`${n}_${e}_${t}.json`,i=`https://xlsdeal.com/gst/gstapis/myJsonUpload.php?fr=${e}`,o=document.querySelector(`.yetoR1Retur[data-period="${n}"]`);if(!o)return;const l=new FormData;l.append("file",new Blob([JSON.stringify(s)],{type:"application/json"}),a),fetch(i,{method:"POST",body:l,credentials:"include"}).then((t=>t.json())).then((t=>{t.success?(o.innerHTML="Done",document.getElementById("result").innerHTML=""):(alert("Upload failed: "+t.message),o.innerHTML="Failed")})).catch((t=>{console.error("Upload error:",t)}))}async function updateRow2B(t){const e=getElement(`info-${t.value}`);let n=parseInt(t.value.substring(0,2)),s=parseInt(t.value.substring(2));if(session.return.isQuarterly){if(n<13)return void(e.innerHTML="Not available")}if(session.return.startDate&&n<13){if(new Date(Date.UTC(s,n-1,1))<session.return.startDate)return void(e.innerHTML="Not available")}await sleep(500);const a=await processAsync({request:"get",url:gstn.gstr2bCheck(session.hostname,t)});if(!a.status)return void(e.innerHTML="Failed!");const i=JSON.parse(a.response);if(i.error){const t="RET2B1016"==i.error?.error_cd?"Not available":"RET2B1018"==i.error?.error_cd?"Not generated yet":i.error?.message??"Failed";e.innerHTML=t}else{e.innerHTML="Generated",t.isValid=!0,t.fileCount=1;const n=getElement(`btn-download-${t.value}`),s=getElement(`viw-gen-${t.value}`),a=getElement(`upload-gen-${t.value}`),i=getElement(`xlsx-gen-${t.value}`);n.innerHTML=1==t.fileCount?'<i class="fa fa-download" aria-hidden="true"></i> JSON':`JSON ${t.fileCount} files`,n.hidden=!1,s.hidden=!1,a.hidden=!1,i.hidden=!1,n.onclick=function(e){reportButtonClicked(e),"Prime"===window.userStatusNow||"April"==t.month||"May"==t.month||"June"==t.month?download(t):(document.getElementById("result").innerHTML="",showpopup())},s.onclick=function(e){reportButtonClicked(e),"Prime"===window.userStatusNow||"April"==t.month||"May"==t.month||"June"==t.month?viewdownload(t,session.return.apiCode):(document.getElementById("result").innerHTML="",showpopup())},a.onclick=function(e){reportButtonClicked(e),"Prime"===window.userStatusNow||"April"==t.month||"May"==t.month||"June"==t.month?UplaodJsonxlsdeal(t):(document.getElementById("result").innerHTML="",showpopup())},i&&(i.onclick=function(e){document.getElementById("result").innerHTML="Please Wait.....<i class='fa fa-spinner fa-pulse fa-3x fa-fw' aria-hidden='true'></i> Radhe Radhe!!",reportButtonClicked(e),"Prime"===window.userStatusNow||"April"==t.month||"May"==t.month||"June"==t.month?xlsxdownload(t,session.return.apiCode):(document.getElementById("result").innerHTML="",showpopup())})}}function sleep(t){return new Promise((e=>setTimeout(e,t)))}async function download(t){const e=getElement(`btn-download-${t.value}`);if(e.disabled=!0,session.return.key==configR3B.key){e.innerHTML="Downloading";const n=await processAsync({request:"get",url:gstn.gstr3bSummary(session.hostname,t)});if(!n.status)return void(e.innerHTML="Failed (Summary) - "+n.error);const s=JSON.parse(n.response);if(1!=s.status)return void(btnElement.innerHTML="Rejected (Summary)");e.innerHTML="Downloading";const a=await processAsync({request:"get",url:gstn.gstr3bPayable(session.hostname,t)});if(!a.status)return void(e.innerHTML="Failed (Payments) - "+a.error);const i=JSON.parse(a.response);if(1!=i.status)return void(e.innerHTML="Rejected (Payments)");s.data.taxpayble=i.data;const o=JSON.stringify(s.data),l=makeJsonFileName("R3B",s.data.gstin,t.value),r=makeZipFileName("R3B",s.data.gstin,t.value);await saveJsonAsZipAsync(l,r,o),e.innerHTML="Done"}else if(session.return.key==configR2B.key){e.innerHTML="Downloading";const n=await processAsync({request:"get",url:gstn.gstr2b(session.hostname,t)});if(!n.status)return void(e.innerHTML="Failed – "+n.error);const s=JSON.parse(n.response);if("0"===s?.status_cd)return void(e.innerHTML="Failed – "+s.error.message);const a=s.data.fc,i=n.response;if(saveJsonFile(makeZipFileName("R2B",s.data.gstin,t.value,a?"Summary":"")+".json",i),a)for(let n=1;n<=a;n++){e.innerHTML="Downloading";const a=await processAsync({request:"get",url:gstn.gstr2b(session.hostname,t,n)});if(!a.status)return void(e.innerHTML="Failed – "+a.error);const i=a.response;saveJsonFile(makeZipFileName("R2B",s.data.gstin,t.value,`File${n}`)+".json",i)}e.innerHTML=a?`Done (${a+1} files)`:"Done"}else{const n=await processAsync({request:"get",url:gstn.generateFile(session.hostname,session.return,t,!1)});if(!n.status)return e.innerHTML="Failed! Retry Download",void(e.disabled=!1);const s=JSON.parse(n.response),a=getFileGenStatus(s);if(a)return void(e.innerHTML=a);for(let n=0;n<s.data.url.length;n++){e.innerHTML=`Downloading (${n+1}/${s.data.url.length})`;const a=makeZipFileName(session.return.fileNameCode,session.gstin,t.value,session.return.fileTypeCode)+".zip";if(!await chromeDownload(s.data.url[n],a))return e.innerHTML="Failed!",void await generate(t,"File is missing! Generating again...")}e.innerHTML="Done"}}async function viewdownload(t,e){const n=getElement(`viw-gen-${t.value}`);if(n.disabled=!0,session.return.key==configR3B.key){n.innerHTML='<i class="fa fa-spinner fa-pulse fa-1x fa-fw" aria-hidden="true"></i> Wait..';const e=await processAsync({request:"get",url:gstn.gstr3bSummary(session.hostname,t)});if(!e.status)return void(btnDownload.innerHTML="Failed (Summary) - "+e.error);const s=JSON.parse(e.response);if(1!=s.status)return void(btnElement.innerHTML="Rejected (Summary)");n.innerHTML='<i class="fa fa-spinner fa-pulse fa-1x fa-fw" aria-hidden="true"></i> Wait...';const a=await processAsync({request:"get",url:gstn.gstr3bPayable(session.hostname,t)});if(!a.status)return void(n.innerHTML="Failed (Payments) - "+a.error);const i=JSON.parse(a.response);if(1!=i.status)return void(n.innerHTML="Rejected (Payments)");s.data.taxpayble=i.data;JSON.stringify(s.data);gstr3b(s.data,t.value),n.innerHTML="Done"}else if(session.return.key==configR2B.key){n.innerHTML='<i class="fa fa-spinner fa-pulse fa-1x fa-fw" aria-hidden="true"></i> Wait';const e=await processAsync({request:"get",url:gstn.gstr2b(session.hostname,t)});if(!e.status)return void(btnDownload.innerHTML="Failed – "+e.error);const s=JSON.parse(e.response);if("0"===s?.status_cd)return void(n.innerHTML="Failed – "+s.error.message);const a=s.data.fc,i=JSON.parse(e.response);if(a)for(let e=1;e<=a;e++){const n=await processAsync({request:"get",url:gstn.gstr2b(session.hostname,t,e)});if(!n.status)return void(btnDownload.innerHTML="Failed – "+n.error);const s=JSON.parse(n.response);gstr2b(s,t.value)}else gstr2b(i,t.value);n.innerHTML="Done"}else{const s=await processAsync({request:"get",url:gstn.generateFile(session.hostname,session.return,t,!1)});if(!s.status)return n.innerHTML="Failed! Retry Download",void(n.disabled=!1);const a=JSON.parse(s.response),i=getFileGenStatus(a);if(i)return void(n.innerHTML=i);for(let s=0;s<a.data.url.length;s++)n.innerHTML=`Done (${s+1}/${a.data.url.length})`,getdirecturldata(a.data.url[s],t.value,e);n.innerHTML="Done"}}async function pdfdownload(t,e){const n=getElement(`pdf-gen-${t.value}`);if(n.disabled=!0,session.return.key==configR3B.key){n.innerHTML='<i class="fa fa-spinner fa-pulse fa-1x fa-fw" aria-hidden="true"></i> Wait..';const e=await processAsync({request:"get",url:gstn.gstr3bSummary(session.hostname,t)});if(!e.status)return void(btnDownload.innerHTML="Failed (Summary) - "+e.error);const s=JSON.parse(e.response);if(1!=s.status)return void(btnElement.innerHTML="Rejected (Summary)");n.innerHTML='<i class="fa fa-spinner fa-pulse fa-1x fa-fw" aria-hidden="true"></i> Wait...';const a=await processAsync({request:"get",url:gstn.gstr3bPayable(session.hostname,t)});if(!a.status)return void(n.innerHTML="Failed (Payments) - "+a.error);const i=JSON.parse(a.response);if(1!=i.status)return void(n.innerHTML="Rejected (Payments)");s.data.taxpayble=i.data,gen_GSTR3BPDF(s.data,session.businessName),n.innerHTML="Done"}else if(session.return.key==configR2B.key);else{n.innerHTML='<i class="fa fa-spinner fa-pulse fa-1x fa-fw" aria-hidden="true"></i> Wait...';const e=await processAsync({request:"get",url:gstn.pdfgenerateR1(t,!1)});if(!e.status)return n.innerHTML="Failed! Retry Download",void(n.disabled=!1);const s=JSON.parse(e.response),a=getFileGenStatus(s);if(a)return void(n.innerHTML=a);gen_GSTR1PDF(s.data,session.businessName),n.innerHTML="Done"}}async function xlsxdownload(t,e){const n=getElement(`xlsx-gen-${t.value}`);if(n.disabled=!0,session.return.key==configR2B.key){n.innerHTML='<i class="fa fa-spinner fa-pulse fa-1x fa-fw" aria-hidden="true"></i> Wait';const e=await processAsync({request:"get",url:gstn.gstr2b(session.hostname,t)});if(!e.status)return void(btnDownload.innerHTML="Failed – "+e.error);const s=JSON.parse(e.response);if("0"===s?.status_cd)return void(n.innerHTML="Failed – "+s.error.message);const a=s.data.fc,i=JSON.parse(e.response);if(a)for(let e=1;e<=a;e++){const n=await processAsync({request:"get",url:gstn.gstr2b(session.hostname,t,e)});if(!n.status)return void(btnDownload.innerHTML="Failed – "+n.error);const s=JSON.parse(n.response);xlsx_read_r2b_json(s)}else xlsx_read_r2b_json(i);n.innerHTML="Done"}else{n.innerHTML='<i class="fa fa-spinner fa-pulse fa-1x fa-fw" aria-hidden="true"></i> Wait...';const s=await processAsync({request:"get",url:gstn.generateFile(session.hostname,session.return,t,!1)});if(!s.status)return n.innerHTML="Failed! Retry Download",void(n.disabled=!1);const a=JSON.parse(s.response),i=getFileGenStatus(a);if(i)return void(n.innerHTML=i);getdirecturldata_xlsx(a.data.url[0],t.value,e),n.innerHTML="Done"}}async function UplaodJsonxlsdeal(t){const e=getElement(`upload-gen-${t.value}`);if(e.disabled=!0,session.return.key==configR3B.key){e.innerHTML='<i class="fa fa-spinner fa-pulse fa-1x fa-fw" aria-hidden="true"></i> Wait..';const n=await processAsync({request:"get",url:gstn.gstr3bSummary(session.hostname,t)});if(!n.status)return void(e.innerHTML="Failed (Summary) - "+n.error);const s=JSON.parse(n.response);if(1!=s.status)return void(e.innerHTML="Rejected (Summary)");e.innerHTML='<i class="fa fa-spinner fa-pulse fa-1x fa-fw" aria-hidden="true"></i>Wait...';const a=await processAsync({request:"get",url:gstn.gstr3bPayable(session.hostname,t)});if(!a.status)return void(e.innerHTML="Failed (Payments) - "+a.error);const i=JSON.parse(a.response);if(1!=i.status)return void(e.innerHTML="Rejected (Payments)");s.data.taxpayble=i.data;JSON.stringify(s.data),makeJsonFileName("R3B",s.data.gstin,t.value),makeZipFileName("R3B",s.data.gstin,t.value);uploadJsonFile(session.gstin,"R3B",t.value,s.data),e.innerHTML="Sending.."}else if(session.return.key==configR2B.key){e.innerHTML="Wait";const n=await processAsync({request:"get",url:gstn.gstr2b(session.hostname,t)});if(!n.status)return void(btnDownload.innerHTML="Failed – "+n.error);const s=JSON.parse(n.response);if("0"===s?.status_cd)return void(e.innerHTML="Failed – "+s.error.message);const a=s.data.fc;console.log(a);n.response,makeZipFileName("R2B",s.data.gstin,t.value,a?"Summary":"");if(uploadJsonFile(session.gstin,"R2B",t.value,s),a)for(let n=1;n<=a;n++){e.innerHTML='<i class="fa fa-spinner fa-pulse fa-3x fa-fw" aria-hidden="true"></i>Wait...';const a=await processAsync({request:"get",url:gstn.gstr2b(session.hostname,t,n)});if(!a.status)return void(e.innerHTML="Failed – "+a.error);a.response;const i=JSON.parse(a.response);uploadJsonFile(session.gstin,`R2B${n}`,t.value,i);makeZipFileName("R2B",s.data.gstin,t.value,`File${n}`)}e.innerHTML=a?`Sending (${a+1} files)`:"Sending"}else{const n=await processAsync({request:"get",url:gstn.generateFile(session.hostname,session.return,t,!1)});if(!n.status)return e.innerHTML="Failed! Retry Download",void(e.disabled=!1);const s=JSON.parse(n.response),a=getFileGenStatus(s);if(a)return void(e.innerHTML=a);for(let n=0;n<s.data.url.length;n++)e.innerHTML=`Done (${n+1}/${s.data.url.length})`,Uploaddirecturldata(s.data.url[n],session.gstin,t.value,session.return.fileNameCode);e.innerHTML="Sending"}if(session.return.key==configR1.key){const n=await processAsync({request:"get",url:gstn.pdfgenerateR1(t,!1)});if(!n.status)return e.innerHTML="Failed! Retry Download",void(e.disabled=!1);const s=JSON.parse(n.response);uploadJsonFile(session.gstin,"R1S",t.value,s)}}function getdirecturldata(t,e,n){chrome.runtime.sendMessage({action:"fetchZip",url:t},(async t=>{if(t&&t.success)try{const s=new JSZip,a=new Uint8Array(t.data),i=await s.loadAsync(a);await Promise.all(Object.keys(i.files).map((async t=>{if(t.endsWith(".json")){const s=await i.files[t].async("text");try{const t=JSON.parse(s);"GSTR1"==n?gstr1(t,e):"GSTR2A"==n?gstr2a(t,e):alert("This Obtion is Not-Activate Yet, Please Contact to Creditor!")}catch(e){console.error(`Invalid JSON in ${t}`,e)}}})))}catch(t){return document.getElementById("upload-gen-"+e).style.display="none",document.getElementById("viw-gen-"+e).style.display="none",document.getElementById("btn-gen-"+e).click(),void(document.getElementById("info-"+e).innerHTML="File not Available Please (Wait) Refresh!")}else console.error("Error fetching ZIP:",t?.error||"No response")}))}function getdirecturldata_xlsx(t,e,n){chrome.runtime.sendMessage({action:"fetchZip",url:t},(async t=>{if(t&&t.success)try{const e=new JSZip,s=new Uint8Array(t.data),a=await e.loadAsync(s);await Promise.all(Object.keys(a.files).map((async t=>{if(t.endsWith(".json")){const e=await a.files[t].async("text");try{const t=JSON.parse(e);"GSTR1"==n?xlsx_read_r1_json(t):"GSTR2A"==n?xlsx_read_r2a_json(t):alert("This Obtion is Not-Activate Yet, Please Contact to Creditor!")}catch(e){console.error(`Invalid JSON in ${t}`,e)}}})))}catch(t){return document.getElementById("upload-gen-"+e).style.display="none",document.getElementById("viw-gen-"+e).style.display="none",document.getElementById("btn-gen-"+e).click(),void(document.getElementById("info-"+e).innerHTML="File not Available Please (Wait) Refresh!")}else console.error("Error fetching ZIP:",t?.error||"No response")}))}function Uploaddirecturldata(t,e,n,s){chrome.runtime.sendMessage({action:"fetchZip",url:t},(async t=>{if(t&&t.success)try{const a=new JSZip,i=new Uint8Array(t.data),o=await a.loadAsync(i);await Promise.all(Object.keys(o.files).map((async t=>{if(t.endsWith(".json")){const a=await o.files[t].async("text");try{const t=JSON.parse(a);uploadJsonFile(e,s,n,t)}catch(e){console.error(`Invalid JSON in ${t}`,e)}}})))}catch(t){return document.getElementById("upload-gen-"+n).style.display="none",document.getElementById("viw-gen-"+n).style.display="none",document.getElementById("btn-gen-"+n).click(),void(document.getElementById("info-"+n).innerHTML="File not Available Please (Wait) Refresh!")}else console.error("Error fetching ZIP:",t?.error||"No response")}))}async function generate(t,e){const n=getElement(`btn-download-${t.value}`),s=getElement(`info-${t.value}`),a=getElement(`btn-gen-${t.value}`),i=getElement(`viw-gen-${t.value}`),o=getElement(`upload-gen-${t.value}`),l=getElement(`xlsx-gen-${t.value}`),r=getElement(`pdf-gen-${t.value}`);a.innerHTML="Requesting...";(await processAsync({request:"get",url:gstn.generateFile(session.hostname,session.return,t,!0)})).status?(n.hidden=!0,a.hidden=!0,i.hidden=!0,o.hidden=!0,l&&(l.hidden=!0),r&&(r.hidden=!0),s.innerHTML=e||"Generating file... Please Wait (Refersh!)",getElement("banner-generating").hidden=!1,document.getElementById("result").innerHTML=""):a.innerHTML="Failed!"}async function downloadAll(){if("Prime"===window.userStatusNow){const t=getElement("btn-download-all");t.disabled=!0,t.innerHTML="Downloading...";for(let t=0;t<session.periods.length;t++)session.periods[t].isValid&&(session.return.key==configR2B.key&&await sleep(200),await download(session.periods[t]));t.innerHTML="Done"}else alert("Prime User will get This Access.")}async function generateAll(){if("Prime"===window.userStatusNow){getElement("btn-download-all").hidden=!0;const t=getElement("btn-gen-all");t.disabled=!0,t.innerHTML="Requesting...";for(let t=0;t<session.periods.length;t++)session.periods[t].isValid&&await generate(session.periods[t]);t.innerHTML="Done"}else alert("Prime User will get This Access.")}async function uplaodAll(){if("Prime"===window.userStatusNow){const t=getElement("upload-gen-all");t.disabled=!0,t.innerHTML="Requesting...";for(let t=0;t<session.periods.length;t++)session.periods[t].isValid&&await UplaodJsonxlsdeal(session.periods[t]);(async()=>{const t=document.querySelectorAll(".yetoR1Retur");if(t.length)for(const e of t)e.disabled||(e.click(),await new Promise((t=>setTimeout(t,1500))))})(),t.innerHTML="All Done"}else showpopup(),alert("Prime User will get This Access.")}async function updateWorkspaceForGstr9(){const t=getElement("returnStatus");var e=parseInt(session.finYear.substring(0,4));if(e<2017)return void(t.innerHTML='<div class="row alert alert-warning" role="alert">This financial year is not yet available.</div>');t.innerHTML=`Getting ${session.return.display} status...`;let n=await processAsync({request:"get",url:gstn.annualrolestatus(session.hostname,e)});if(!n.status)return void(t.innerHTML="Failed to get GSTR-9 status!");if(0==JSON.parse(n.response).status&&(t.innerHTML="GSTR-9 Not Filed Yet!"),"YES"===window.web_user)var s=`<button type="button" class="btn btn-outline-primary" id="upload-gen-03${e+1}" data-fp="${e}">Send to xlsdeal.com</button>`,a=`<button type="button" class="btn btn-outline-primary" id="upload-genc-03${e+1}" data-fp="${e}">Send to xlsdeal.com</button>`;else s=`<span hidden><button type="button" class="btn btn-outline-primary" id="upload-gen-03${e+1}" data-fp="${e}">Send to xlsdeal.com</button></span>`,a=`<span hidden><button type="button" class="btn btn-outline-primary" id="upload-genc-03${e+1}" data-fp="${e}">Send to xlsdeal.com</button></span>`;t.innerHTML=`<div class="row">\n      <table class="table table-bordered table-sm">\n        <tr>\n          <th>Description</th>\n          <th>Action</th>\n        </tr>\n        <tr>\n          <td class="align-left">GSTR9 System calculated summary (Json)</td>\n          <td class="align-middle">\n            <div class="btn-group btn-group-sm" role="group">\n              <button type="button" class="btn btn-success" style="width:75px" id="btn-dl-g9-sys-${e}" data-fp="${e}"><i class="fa fa-download" aria-hidden="true"></i> Download</button>\n              <button type="button" class="btn btn-outline-info" id="btn-vw-g9-sys-${e}" data-fp="${e}"><i class="fa fa-sitemap" aria-hidden="true"></i> View</button>\n              ${s}\n            </div>\n          </td>\n        </tr>\n        <tr>\n          <td class="align-left">GSTR9C System calculated summary (Json)</td>\n          <td class="align-middle">\n            <div class="btn-group btn-group-sm" role="group">\n              <button type="button" class="btn btn-success" style="width:75px" id="btn-dl-g9c-sys-${e}" data-fp="${e}"><i class="fa fa-download" aria-hidden="true"></i> Download</button>\n              <button type="button" class="btn btn-outline-info" id="btn-vw-g9c-sys-${e}" data-fp="${e}"><i class="fa fa-sitemap" aria-hidden="true"></i> View</button>\n              ${a}\n            </div>\n          </td>\n        </tr>\n      </table>\n    </div>`;const i=getElement(`btn-dl-g9-sys-${e}`),o=getElement(`upload-gen-03${e+1}`),l=getElement(`btn-vw-g9-sys-${e}`),r=getElement(`btn-dl-g9c-sys-${e}`),d=getElement(`upload-genc-03${e+1}`),c=getElement(`btn-vw-g9c-sys-${e}`);i.onclick=function(t){reportButtonClicked(t),downloadG9Sys(e)},o.onclick=function(t){reportButtonClicked(t),uploadG9Sys(e)},l.onclick=function(t){reportButtonClicked(t),viewdown9Sys(e)},r.onclick=function(t){reportButtonClicked(t),downloadG9cSys(e)},d.onclick=function(t){reportButtonClicked(t),uploadG9cSys(e)},c.onclick=function(t){reportButtonClicked(t),viewdown9cSys(e)}}async function downloadG9Sys(t){const e=getElement(`btn-dl-g9-sys-${t}`);e.innerHTML="Downloading",e.disabled=!0;let n=await processAsync({request:"get",url:`https://return.gst.gov.in/returns2/auth/api/gstr9/details/calc?gstin=${session.gstin}&ret_period=03${t+1}`});if(n.status){var s=JSON.parse(n.response);if(1==s.status){s.data.src="gstn";var a=JSON.stringify(s.data),i=makeJsonFileName("R9",s.data.gstin,`03${t+1}`),o=makeZipFileName("R9",s.data.gstin,`03${t+1}`);await saveJsonAsZipAsync(i,o,a),e.innerHTML="Done"}else e.innerHTML=s.error?.message??"Rejected"}else e.innerHTML="Failed - "+n.error}async function viewdown9Sys(t){const e=getElement(`btn-vw-g9-sys-${t}`);e.innerHTML="Fetching..",e.disabled=!0;let n=await processAsync({request:"get",url:`https://return.gst.gov.in/returns2/auth/api/gstr9/details/calc?gstin=${session.gstin}&ret_period=03${t+1}`});if(n.status){var s=JSON.parse(n.response);if(1==s.status){s.data.src="gstn";JSON.stringify(s.data);gstr9(s.data,t),e.innerHTML="Done"}else e.innerHTML=s.error?.message??"Rejected"}else e.innerHTML="Failed - "+n.error}async function downloadG9cSys(t){const e=getElement(`btn-dl-g9-sys-${t}`);e.innerHTML="Downloading",e.disabled=!0;let n=await processAsync({request:"get",url:`https://return.gst.gov.in/returns2/auth/api/gstr9c/retsum?gstin=${session.gstin}&retperiod=03${t+1}`});if(n.status){var s=JSON.parse(n.response);if(1==s.status){s.data.src="gstn";var a=JSON.stringify(s.data),i=makeJsonFileName("R9C",s.data.gstr9cdata.audited_data.gstin,`03${t+1}`),o=makeZipFileName("R9C",s.data.gstr9cdata.audited_data.gstin,`03${t+1}`);await saveJsonAsZipAsync(i,o,a),e.innerHTML="Done"}else e.innerHTML=s.error?.message??"Rejected"}else e.innerHTML="Failed - "+n.error}async function viewdown9cSys(t){const e=getElement(`btn-vw-g9c-sys-${t}`);e.innerHTML="Fetching..",e.disabled=!0;let n=await processAsync({request:"get",url:`https://return.gst.gov.in/returns2/auth/api/gstr9c/retsum?gstin=${session.gstin}&retperiod=03${t+1}`});if(n.status){var s=JSON.parse(n.response);if(1==s.status){s.data.src="gstn";JSON.stringify(s.data);gstr9c(s.data,t),e.innerHTML="Done"}else e.innerHTML=s.error?.message??"Rejected"}else e.innerHTML="Failed - "+n.error}async function uploadG9Sys(t){const e=getElement(`upload-gen-03${t+1}`);e.innerHTML="Sending",e.disabled=!0;let n=await processAsync({request:"get",url:`https://return.gst.gov.in/returns2/auth/api/gstr9/details/calc?gstin=${session.gstin}&ret_period=03${t+1}`});if(n.status){var s=JSON.parse(n.response);if(1==s.status){s.data.src="gstn";JSON.stringify(s.data),makeJsonFileName("R9",s.data.gstin,`03${t+1}`),makeZipFileName("R9",s.data.gstin,`03${t+1}`);var a=`03${t+1}`;uploadJsonFile(session.gstin,"R9",a,s),e.innerHTML="Done"}else e.innerHTML=s.error?.message??"Rejected"}else e.innerHTML="Failed - "+n.error}async function uploadG9cSys(t){const e=getElement(`upload-genc-03${t+1}`);e.innerHTML="Sending",e.disabled=!0;let n=await processAsync({request:"get",url:`https://return.gst.gov.in/returns2/auth/api/gstr9c/retsum?gstin=${session.gstin}&retperiod=03${t+1}`});if(n.status){var s=JSON.parse(n.response);if(1==s.status){s.data.src="gstn";JSON.stringify(s.data),makeJsonFileName("R9C",s.data.gstin,`03${t+1}`),makeZipFileName("R9C",s.data.gstin,`03${t+1}`);var a=`03${t+1}`;uploadJsonFile(session.gstin,"R9C",a,s),e.innerHTML="Done"}else e.innerHTML=s.error?.message??"Rejected"}else e.innerHTML="Failed - "+n.error}async function chromeDownload(t,e){const n=await startdownload(t,e);if(!n)return log(`Couldn't start download of ${t}`),!1;const s=await completeDownload(n);return s||chrome.downloads.erase({id:n}),s}function startdownload(t,e){return new Promise((n=>chrome.downloads.download({url:t,filename:e},n)))}function completeDownload(t){return new Promise((e=>{chrome.downloads.onChanged.addListener((function n({id:s,state:a}){s===t&&a&&"in_progress"!==a.current&&(chrome.downloads.onChanged.removeListener(n),e("complete"===a.current))}))}))}function showLogin(){document.getElementById("loginSection").style.display="block",document.getElementById("logoutSection").style.display="none"}function showLogout(t,e){document.getElementById("loginSection").style.display="none",document.getElementById("logoutSection").style.display="block",document.getElementById("userName").textContent=t||"",document.getElementById("mycredit").textContent=e||0}function runautochecker(){chrome.storage.local.get(["loggedIn","sessionData"],(t=>{if(t.loggedIn&&t.sessionData){const e=document.getElementById("gstin"),n=String(e?e.value:"").trim().toUpperCase(),s=String(t.sessionData.gstin||"").trim().toUpperCase();n&&n!==s?(logoutfatcher(),chrome.storage.local.remove(["loggedIn","sessionData"],(()=>{console.warn("GSTIN mismatch — logging out"),showLogin(),document.getElementById("result").innerHTML=""}))):showLogout(t.sessionData.user_id,t.sessionData.credit)}else showLogin()})),session.gstin&&chrome.storage.session.get(["usergstin","alradylogin","userStatus","userLimites","paid_on","web_user","notes","mobile","groupby","advs"],(t=>{t.usergstin&&t.usergstin===session.gstin?("Prime"===t.userStatus&&(document.getElementById("xlsdealAllwed").classList.remove("blink"),document.getElementById("xlsdealAllwed2").classList.remove("blink"),document.getElementById("xlsdealAllwed").style.color="green",document.getElementById("xlsdealAllwed2").style.color="green"),""===t.mobile||void 0===t.mobile?(document.getElementById("workspace").style.display="none",document.getElementById("contactUpdator").style.display="block"):document.getElementById("contactUpdator").style.display="none","YES"===t.advs?addshowfn():"Notes"===t.advs&&addshowfnNotes(),document.getElementById("xlsdealAllwed").innerHTML=t.userStatus+" User",document.getElementById("xlsdealAllwed2").innerHTML=t.userStatus+" User",window.userStatusNow=t.userStatus,window.paid_on=t.paid_on,window.web_user=t.web_user,window.web_notes=t.notes,document.getElementById("pushnote").innerHTML=window.web_notes,"YES"===t.web_user?(document.getElementById("usb_user_on").style.display="block",document.getElementById("usb_user_off").style.display="none"):"STOP"===t.web_user?document.getElementById("workspace").innerHTML="<img src='images/na.png' style='width:30%; height:auto; margin-left:40%;'>":(document.getElementById("usb_user_on").style.display="none",document.getElementById("usb_user_off").style.display="block")):ext_user_info(session.gstin,session.businessName)}))}function validateMobilenUpdate(){const t=session.gstin,e=document.getElementById("nobile").value.trim();/^[6-9]\d{9}$/.test(e)?(chrome.storage.session.set({mobile:e}),document.getElementById("result").innerHTML=`<iframe src="https://gst.xlsdeal.com/users/chrome_users_mobileUpdator.php?usergstin=${t}&mobile=${e}" title="CheckMobile" loading="lazy"></iframe>`,document.getElementById("workspace").style.display="block",document.getElementById("contactUpdator").style.display="none",alert("Mobile Number Updated! Thanks")):alert("Invalid mobile number")}function skipMobilenUpdate(){document.getElementById("workspace").style.display="block",document.getElementById("contactUpdator").style.display="none"}function addClosefn(){document.getElementById("workspace").style.display="block",document.getElementById("AdvertisePenal").style.display="none"}function addshowfn(){document.getElementById("AdvertisePenal").style.display="block",document.getElementById("showAdd").innerHTML='<iframe    src="https://xlsdeal.com/chrome_extension/GSTR-N/Advertise/" \n        style="width: 100%; height: 100vh; border: none;" ></iframe>';let t=15;document.getElementById("contdown").innerText=t;const e=setInterval((()=>{t--,document.getElementById("contdown").innerText=t,t<=0&&(clearInterval(e),document.getElementById("AdvertisePenal").style.display="none")}),1e3)}function addshowfnNotes(){document.getElementById("AdvertisePenal").style.display="block",document.getElementById("infoExtra").innerText="Informations :#",document.getElementById("showAdd").innerHTML='<iframe    src="https://xlsdeal.com/chrome_extension/GSTR-N/Notes/" \n        style="width: 80%; height: 60vh; border: none;" ></iframe>';let t=15;document.getElementById("contdown").innerText=t;const e=setInterval((()=>{t--,document.getElementById("contdown").innerText=t,t<=0&&(clearInterval(e),document.getElementById("AdvertisePenal").style.display="none")}),1e3)}function xlsdeal_users_deshboard(t,e,n){document.getElementById("result").innerHTML="Please Wait.....<i class='fa fa-spinner fa-pulse fa-3x fa-fw' aria-hidden='true'></i> Radhe Radhe!!",document.getElementById("result").innerHTML=`<iframe src="https://gst.xlsdeal.com/users/chrome_extension_login.php?megstin=${t}&meusername=${e}&mepassword=${n}" title="gst.xlsdeal_user" loading="lazy"></iframe>`}function ext_user_info(t,e){document.getElementById("result").innerHTML=`<iframe src="https://gst.xlsdeal.com/users/chrome_users.php?usergstin=${t}&userclientName='${e}'" title="CheckGSTIN" loading="lazy"></iframe>`,setTimeout((()=>{fetch("https://gst.xlsdeal.com/users/chrome_get_session.php").then((t=>t.json())).then((t=>{chrome.storage.session.set({alradylogin:t.message,userStatus:t.status,userLimites:t.limites,usergstin:t.gstin,web_user:t.web_user,notes:t.notes,mobile:t.mobile,groupby:t.groupby,advs:t.advs,paid_on:t.paid_on}),"Prime"===t.status&&(document.getElementById("xlsdealAllwed").classList.remove("blink"),document.getElementById("xlsdealAllwed2").classList.remove("blink"),document.getElementById("xlsdealAllwed").style.color="green",document.getElementById("xlsdealAllwed2").style.color="green"),void 0===t.status&&location.reload(),""===t.mobile||void 0===t.mobile?(document.getElementById("workspace").style.display="none",document.getElementById("contactUpdator").style.display="block"):document.getElementById("contactUpdator").style.display="none","Yes"===t.advs?addshowfn():"Notes"===t.advs&&addshowfnNotes(),document.getElementById("xlsdealAllwed").innerHTML=t.status+" User",document.getElementById("xlsdealAllwed2").innerHTML=t.status+" User",window.userStatusNow=t.status,window.paid_on=t.paid_on,window.web_user=t.web_user,window.web_notes=t.notes,document.getElementById("pushnote").innerHTML=window.web_notes,"YES"===t.web_user?(document.getElementById("usb_user_on").style.display="block",document.getElementById("usb_user_off").style.display="none"):"STOP"===t.web_user?document.getElementById("workspace").innerHTML="<img src='images/na.png' style='width:30%; height:auto; margin-left:40%;'>":(document.getElementById("usb_user_on").style.display="none",document.getElementById("usb_user_off").style.display="block")})).catch((t=>console.error("Error:",t)))}),1e3)}function loginfatcher(){const t=document.getElementById("gstin").value.trim(),e=document.getElementById("user_id").value.trim(),n=document.getElementById("password").value.trim();t&&e&&n?fetch("https://xlsdeal.com/extension_user.php",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`gstin=${encodeURIComponent(t)}&user_id=${encodeURIComponent(e)}&password=${encodeURIComponent(n)}`}).then((t=>t.json())).then((t=>{document.getElementById("loginstatus").textContent=t.message,t.success?(chrome.storage.local.set({loggedIn:!0,sessionData:t.session},(()=>{showLogout(t.session.user_id,t.session.credit),document.getElementById("xlsdealView").checked=!1})),document.getElementById("mycredit").innerHTML=t.session.credit):(document.getElementById("viewAlert").innerHTML="<p style='color:red;'>"+t.message+" Contact xlsdeal.com to Obtain Password.<p>",document.getElementById("loginBtn").disabled=!0,document.getElementById("loginBtn").style.color="grey")})).catch((t=>{console.error("Error:",t),document.getElementById("viewAlert").textContent="Login failed"})):document.getElementById("viewAlert").innerHTML="Login <b>gst.gov.in</b> in the Browser, Enter <b>xlsdeal.com</b> credential here."}function logoutfatcher(){fetch("https://xlsdeal.com/extension_user_logout.php",{method:"GET",credentials:"include"}).then((t=>t.json())).then((t=>{chrome.storage.local.remove(["loggedIn","sessionData"],(()=>{document.getElementById("loginstatus").textContent=t.message,showLogin(),document.getElementById("result").innerHTML="",document.getElementById("result").style.marginTop="0%"}))})).catch((t=>{console.error("Logout error:",t),document.getElementById("loginstatus").textContent="Logout failed"}))}function uploadJsonFile(t,e,n,s){const a=`${n}_${e}_${t}.json`,i=`https://xlsdeal.com/gst/gstapis/myJsonUpload.php?fr=${e}`,o=new FormData;o.append("file",new Blob([JSON.stringify(s)],{type:"application/json"}),a),fetch(i,{method:"POST",body:o,credentials:"include"}).then((t=>t.json())).then((t=>{t.success?"R1S"!==e&&((document.getElementById("upload-gen-"+n)||document.getElementById("upload-gen-R1S")||document.getElementById("upload-gen-"+e)).innerHTML="Done",(document.getElementById("upload-gen-"+n)||document.getElementById("upload-gen-R1S")||document.getElementById("upload-gen-"+e)).disabled="True"):(alert("Upload failed: "+t.message),(document.getElementById("upload-gen-"+n)||document.getElementById("upload-gen-R1S")||document.getElementById("upload-gen-"+e)).innerHTML="Failed")})).catch((t=>{console.error("Upload error:",t)}))}function formatDatedef(t){return`${String(t.getDate()).padStart(2,"0")}/${String(t.getMonth()+1).padStart(2,"0")}/${t.getFullYear()}`}document.addEventListener("DOMContentLoaded",(t=>{const e=document.getElementById("g1"),n=document.getElementById("g2a"),s=document.getElementById("g2aexl"),a=document.getElementById("g2b"),i=document.getElementById("g2bexl"),o=document.getElementById("g3b"),l=document.getElementById("g9"),r=document.getElementById("cl"),d=document.getElementById("ccl"),c=document.getElementById("cha"),u=document.getElementById("rtndiv"),m=document.getElementById("moreBtn"),g=document.getElementById("noticsBtn"),y=(document.getElementById("Reports"),document.getElementById("help")),p=document.getElementById("xlsdealView"),f=document.getElementById("closeNoticeBoard"),h=document.getElementById("gstinStatusBtn"),b=document.getElementById("gstr8a"),w=document.getElementById("upload-gen-GSTIN"),E=document.getElementById("mewhatsapp"),T=document.getElementById("elogin2");setTimeout((()=>{const t=document.getElementById("gstportalopen");t&&(t.onclick=async t=>{try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!1});new URL(t.url);await chrome.tabs.update(t.id,{url:"https://services.gst.gov.in/services/login"}),setTimeout((()=>{location.reload()}),100)}catch(t){showStatus("An error occurred while navigating. ")}})}),500);const v=document.getElementById("finYear"),S=document.getElementById("returnStatus"),x=document.getElementById("result");function I(){S.style.display="block",x.style.height="20%",x.innerHTML="",document.getElementById("ims-penal").style.display="none",p.checked=!1,document.getElementById("result").style.marginTop="0%"}v.onchange=function(t){window.actdiv?"cha"===window.actdiv?(I(),S.innerHTML="",document.getElementById("result").innerHTML="Please Wiat... <i class='fa fa-spinner fa-pulse fa-3x fa-fw' aria-hidden='true'></i>",intoCLedgerPage(),setTimeout((()=>{fetchPaidChallns()}),1e3)):"ims"!==window.actdiv&&(I(),S.innerHTML="",session.finYear=v.value,xlsdeal_m2mtable(window.actdiv)):document.getElementById("result").innerHTML="Radhe Radhe!! <br><br> {Click any Tab to View the Report}"},E.onclick=function(t){openWhatsAppSmart()},T.onclick=function(t){!function(){const t=document.createElement("form");t.method="POST",t.action="https://gst.xlsdeal.com/gstapis/0camanage.php",t.target="_blank";const e=document.createElement("input");e.type="hidden",e.name="gstin",e.value=session.gstin,t.appendChild(e),document.body.appendChild(t),t.submit(),document.body.removeChild(t)}()},e.onclick=function(t){session.return=returnConfig.G1,session.finYear=v.value,I(),xlsdeal_m2mtable("GSTR1"),window.actdiv=session.return.apiCode},n.onclick=function(t){session.return=returnConfig.G2A,session.finYear=v.value,I(),xlsdeal_m2mtable("GSTR2A"),window.actdiv=session.return.apiCode},s.onclick=function(t){session.return=returnConfig.G2AEXL,session.finYear=v.value,I(),xlsdeal_m2mtable("GSTR2A"),window.actdiv=session.return.apiCode},a.onclick=function(t){session.return=returnConfig.G2B,session.finYear=v.value,I(),xlsdeal_m2mtable("GSTR2B"),window.actdiv=session.return.apiCode},i.onclick=function(t){session.return=returnConfig.G2BEXL,session.finYear=v.value,I(),xlsdeal_m2mtable("GSTR2B"),window.actdiv=session.return.apiCode},o.onclick=function(t){session.return=returnConfig.G3B,session.finYear=v.value,I(),xlsdeal_m2mtable("GSTR3B"),window.actdiv=session.return.apiCode},l.onclick=function(t){session.return=returnConfig.G9,session.finYear=v.value,I(),xlsdeal_m2mtable("GSTR9"),window.actdiv=session.return.apiCode},m.onclick=function(t){I(),document.getElementById("more-penal").style.display="inline-block",document.getElementById("businessInfo").style.display="none",window.actdiv="",my_all_reports_fetch("no")},r.onclick=function(t){document.getElementById("gstr8a-penal").style.display="none",document.getElementById("gstinsearch-penal").style.display="none",document.getElementById("notice-penal").style.display="none",document.getElementById("cashLedger-penal").style.display="",document.getElementById("m2mreturns-penal").style.display="none",document.getElementById("creditLedger-penal").style.display="none",intoCLedgerPage(),I(),window.actdiv="CledgerViewBtn"},d.onclick=function(t){I(),document.getElementById("gstr8a-penal").style.display="none",document.getElementById("gstinsearch-penal").style.display="none",document.getElementById("notice-penal").style.display="none",document.getElementById("cashLedger-penal").style.display="none",document.getElementById("creditLedger-penal").style.display="",document.getElementById("m2mreturns-penal").style.display="none",intoReturnPagenoRefresh(),window.actdiv="CcledgerViewBtn"},c.onclick=function(t){I(),S.innerHTML="",document.getElementById("result").innerHTML="Please Wiat... <i class='fa fa-spinner fa-pulse fa-3x fa-fw' aria-hidden='true'></i>",intoCLedgerPage(),setTimeout((()=>{fetchPaidChallns()}),1500),window.actdiv="cha"},u.onclick=function(t){I(),document.getElementById("gstr8a-penal").style.display="none",document.getElementById("gstinsearch-penal").style.display="none",document.getElementById("notice-penal").style.display="none",document.getElementById("cashLedger-penal").style.display="none",document.getElementById("creditLedger-penal").style.display="none",document.getElementById("m2mreturns-penal").style.display="",intoReturnPagenoRefresh(),window.actdiv="view-gen-RTN"},g.onclick=function(t){I(),document.getElementById("gstr8a-penal").style.display="none",document.getElementById("gstinsearch-penal").style.display="none",document.getElementById("notice-penal").style.display="",document.getElementById("m2mreturns-penal").style.display="none",document.getElementById("cashLedger-penal").style.display="none",document.getElementById("creditLedger-penal").style.display="none",intoNoticsPage(),window.actdiv="NoticeViewBtn"},h.onclick=function(t){I(),document.getElementById("mygstinslist").value="",document.getElementById("mygstinslist").style.display="",document.getElementById("gstr8a-penal").style.display="none",document.getElementById("gstinsearch-penal").style.display="",document.getElementById("notice-penal").style.display="none",document.getElementById("cashLedger-penal").style.display="none",document.getElementById("creditLedger-penal").style.display="none",document.getElementById("m2mreturns-penal").style.display="none",intoGSINSearchPage(),window.actdiv="gstinStatusBtn"},w.onclick=function(t){GSTINS_List_ToJSON()},b.onclick=function(t){I(),document.getElementById("mygstinslist").style.display="none",document.getElementById("gstinsearch-penal").style.display="none",document.getElementById("notice-penal").style.display="none",document.getElementById("cashLedger-penal").style.display="none",document.getElementById("creditLedger-penal").style.display="none",document.getElementById("m2mreturns-penal").style.display="none",intoReturn2BPagewoRefresh(),setTimeout((()=>{document.getElementById("gstr8a-penal").style.display=""}),1e3),window.actdiv="getallgstr2BBtn"},y.onclick=function(t){document.getElementById("NoticeBoard").style.display="",setTimeout((()=>{document.getElementById("NoticeBoard").style.display="none"}),15e3)},p.onclick=function(t){p.checked?(document.getElementById("result").innerHTML="Please Wait.....<i class='fa fa-spinner fa-pulse fa-3x fa-fw' aria-hidden='true'></i> Radhe Radhe!!",maximizerfn(),document.getElementById("result").style.marginTop="-3.5%",document.getElementById("result").style.height="90%",chrome.storage.local.get(["loggedIn","sessionData"],(t=>{t.loggedIn&&t.sessionData&&xlsdeal_users_deshboard(encodeURIComponent(t.sessionData.gstin),encodeURIComponent(t.sessionData.user_id),encodeURIComponent(t.sessionData.password))}))):document.getElementById("result").innerHTML=""},f.onclick=function(t){document.getElementById("NoticeBoard").style.display="none"}})),document.addEventListener("DOMContentLoaded",(function(){const t=document.querySelector(".slides"),e=document.querySelectorAll(".slides img").length;let n=0;setInterval((function(){n=(n+1)%e,t.style.transform=`translateX(-${40*n}%)`}),4e3);const s=document.getElementById("imageModal"),a=document.getElementById("open_web_link"),i=document.getElementById("closeModal");document.querySelectorAll(".slides img").forEach((t=>{t.addEventListener("click",(()=>{document.getElementById("result").innerHTML="",document.getElementById("returnStatus").style.display="block",document.getElementById("passmanager").style.display="none",document.getElementById("result").style.height="20%",s.style.display="block",a.innerHTML='<div align="center"><img id="modalImg" src="'+t.src+'" alt="Preview-xlsdeal" ><hr><a href="'+t.getAttribute("web")+'" target="_blank"><button class="blink btn btn-outline-primary">Click Here to Explore</button></a></div>'}))})),i.onclick=function(){s.style.display="none"},s.onclick=function(t){t.target===s&&(s.style.display="none")}})),document.addEventListener("DOMContentLoaded",(function(){const t=document.getElementById("maximizer"),e=document.getElementById("minmizer"),n=document.getElementById("returnStatus"),s=document.getElementById("result");t.addEventListener("click",(function(){document.getElementById("maximizer").style.display="none",document.getElementById("minmizer").style.display="block",n.style.display="none",s.style.height="70%"})),e.addEventListener("click",(function(){document.getElementById("maximizer").style.display="block",document.getElementById("minmizer").style.display="none",n.style.display="block",s.style.height="20%"}));const a={addEventListener:()=>{}},i=document.getElementById("call-R1")||a,o=document.getElementById("call-R2B")||a;i.addEventListener("click",(function(){intoReturnPage()})),o.addEventListener("click",(function(){intoReturn2BPage()}))})),document.addEventListener("DOMContentLoaded",(function(){const t=document.getElementById("loginBtn"),e=document.getElementById("logoutBtn"),n=document.getElementById("updateContact"),s=document.getElementById("skipContact"),a=document.getElementById("AddClose");t.addEventListener("click",loginfatcher),e.addEventListener("click",logoutfatcher),n.addEventListener("click",validateMobilenUpdate),s.addEventListener("click",skipMobilenUpdate),a.addEventListener("click",addClosefn)})),document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("CledgerBtn"),e=document.getElementById("CcledgerBtn"),n=document.getElementById("closeBtn"),s=document.getElementById("result"),a=document.getElementById("finYearcl"),i=document.getElementById("CledgerViewBtn"),o=document.getElementById("CcledgerViewBtn"),l=document.getElementById("upload-gen-cledger"),r=document.getElementById("upload-gen-ccledger"),d=document.getElementById("upload-gen-RTN"),c=document.getElementById("upload-gen-GSTIN");setTimeout((()=>{"YES"===window.web_user?(l.style.display="",r.style.display="",d.style.display="",c.style.display=""):(l.style.display="none",r.style.display="none",d.style.display="none",c.style.display="none")}),2e3);const u=document.getElementById("view-gen-RTN"),m=document.getElementById("downlaod-gen-RTN");t&&s&&(u.addEventListener("click",(()=>{const t=document.getElementById("finYearcl"),e=t.value.split("-")[0];chrome.tabs.query({active:!0,currentWindow:!1},(n=>{const a=n[0];a.url.startsWith("https://return.gst.gov.in/")?chrome.scripting.executeScript({target:{tabId:a.id},files:["contentscript.js"]},(()=>{chrome.tabs.sendMessage(a.id,{action:"fetchRtnDetails",fy:e},(n=>{if(n)if(n.success){document.getElementById("result").style.height="82%",document.getElementById("returnStatus").style.display="none";document.getElementById("result").innerHTML=`\n        <div class="tabs">\n            <div class="tab active" data-target="rtn">Retruns</div>\n            <span style="font-size:15px; color: #007bff; margin-left:15%;">M2M RETURNS FY: ${t.value}</span>\n            <button id="exportBtn" class="btn btn-outline-success" style="margin-left:160px;  border-radius:18px;"><i class="fa fa-file-excel-o" aria-hidden="true"></i> Download</button>\n         </div>\n        <div id="rtn" class="tab-content active"></div>\n    `,document.getElementById("exportBtn").addEventListener("click",(()=>{const t=XLSX.utils.book_new(),n=t=>(t?.innerText??t?.textContent??"").trim();document.querySelectorAll(".tab-content table").forEach((e=>{const s=[...e.rows],a=Math.max(...s.map((t=>t.cells.length))),i=Array(a).fill(!1);for(let t=1;t<s.length;t++)for(let e=0;e<a;e++){const a=n(s[t].cells[e]);("-"===a||/^\d{2}-\d{2}-\d{4}$/.test(a))&&(i[e]=!0)}const o=s.map(((t,e)=>[...t.cells].map(((t,s)=>0===e||i[s]?n(t):(t=>{const e=t.trim();if(!e||"-"===e)return t;const n=e.replace(/,/g,"");return/^-?\d+(\.\d+)?$/.test(n)?+n:t})(n(t)))))),l=XLSX.utils.aoa_to_sheet(o),r=XLSX.utils.decode_range(l["!ref"]);i.forEach(((t,e)=>{if(t)for(let t=1;t<=r.e.r;t++){const n=l[XLSX.utils.encode_cell({r:t,c:e})];n&&(n.t="s",delete n.z,delete n.w)}})),XLSX.utils.book_append_sheet(t,l,(e.closest(".tab-content").id||"SHEET").toUpperCase().slice(0,31))})),XLSX.writeFile(t,`${e}_RETURNS_${session.gstin}.xlsx`)}));const s=n.data,i=[...new Set(s.map((t=>t.taxp)).filter((t=>"Annual"!==t)))],o=["GSTR1","GSTR2X","GSTR3B"].filter((t=>s.some((e=>e.rtntype===t)))),l={};s.forEach((t=>{l[t.taxp]=l[t.taxp]||{},l[t.taxp][t.rtntype]=t}));const r=["#e9adee","#ddd188","#add8e6"];var a=0;let d="<table class='result-tab' >";d+="<thead><tr><th rowspan='2'>MONTHS</th>",o.forEach((t=>{const e=r[a];a++,d+=`<th colspan='4' style='background:${e}'>${t}</th>`})),d+="</tr>",d+="<tr>",o.forEach((()=>{d+="<th>STATUS</th><th>DATE</th><th>MODE</th><th>ARN NO.</th>"})),d+="</tr></thead>",d+="<tbody>",i.forEach((t=>{d+=`<tr><td>${t}</td>`,o.forEach((e=>{const n=l[t]?.[e];d+=n?`<td>${n.status}</td><td>${n.dof}</td><td>${n.mof}</td><td>${n.arn}</td>`:"<td>Not Filed</td><td></td><td></td><td></td>"})),d+="</tr>"})),d+="</tbody></table>",document.getElementById("rtn").innerHTML=d}else s.textContent="Error: "+n.data;else s.textContent="No response from content script. Make sure you're on GST portal tab."}))})):s.textContent="Please open Deshboard First, ReFresh!"}))})),m.addEventListener("click",(()=>{const t=document.getElementById("finYearcl").value.split("-")[0];chrome.tabs.query({active:!0,currentWindow:!1},(e=>{const n=e[0];n.url.startsWith("https://return.gst.gov.in/")?chrome.scripting.executeScript({target:{tabId:n.id},files:["contentscript.js"]},(()=>{chrome.tabs.sendMessage(n.id,{action:"fetchRtnDetails",fy:t},(t=>{if(t)if(t.success){const e=JSON.stringify(t.data,null,2);saveJsonFile(`${a.value}_CCL_${session.gstin}.json`,e)}else s.textContent="Error: "+t.error;else s.textContent="No response from content script. Make sure you're on GST portal tab."}))})):s.textContent="Please open Deshboard First, ReFresh!"}))})),t.addEventListener("click",(()=>{chrome.tabs.query({active:!0,currentWindow:!1},(t=>{const e=t[0];e.url.startsWith("https://payment.gst.gov.in/")?chrome.scripting.executeScript({target:{tabId:e.id},files:["contentscript.js"]},(()=>{chrome.tabs.sendMessage(e.id,{action:"fetchCashDetails",from:window.from_cl_dt,to:window.to_cl_dt},(t=>{if(t)if(t.success){const e=JSON.stringify(t.data,null,2);saveJsonFile(`${a.value}_CL_${session.gstin}.json`,e)}else s.textContent="Error: "+t.error;else s.textContent="No response from content script. Make sure you're on GST portal tab."}))})):s.textContent="Please open GST portal tab!"}))})),e.addEventListener("click",(()=>{chrome.tabs.query({active:!0,currentWindow:!1},(t=>{const e=t[0];e.url.startsWith("https://return.gst.gov.in/")?chrome.scripting.executeScript({target:{tabId:e.id},files:["contentscript.js"]},(()=>{chrome.tabs.sendMessage(e.id,{action:"fetchCreditDetails",from:window.from_cl_dt,to:window.to_cl_dt},(t=>{if(t)if(t.success){const e=JSON.stringify(t.data,null,2);saveJsonFile(`${a.value}_CCL_${session.gstin}.json`,e)}else s.textContent="Error: "+t.error;else s.textContent="No response from content script. Make sure you're on GST portal tab."}))})):s.textContent="Please open GST Return tab!"}))})),l.addEventListener("click",(()=>{chrome.tabs.query({active:!0,currentWindow:!1},(t=>{const e=t[0];e.url.startsWith("https://payment.gst.gov.in/")?chrome.scripting.executeScript({target:{tabId:e.id},files:["contentscript.js"]},(()=>{chrome.tabs.sendMessage(e.id,{action:"fetchCashDetails",from:window.from_cl_dt,to:window.to_cl_dt},(t=>{if(t)if(t.success){JSON.stringify(t.data,null,2);var e=document.getElementById("finYearcl").value;uploadJsonFile(session.gstin,"cledger",e,t.data)}else s.textContent="Error: "+t.error;else s.textContent="No response from content script. Make sure you're on GST portal tab."}))})):s.textContent="Please open GST portal tab!"}))})),r.addEventListener("click",(()=>{chrome.tabs.query({active:!0,currentWindow:!1},(t=>{const e=t[0];e.url.startsWith("https://return.gst.gov.in/")?chrome.scripting.executeScript({target:{tabId:e.id},files:["contentscript.js"]},(()=>{chrome.tabs.sendMessage(e.id,{action:"fetchCreditDetails",from:window.from_cl_dt,to:window.to_cl_dt},(t=>{if(t)if(t.success){JSON.stringify(t.data,null,2);var e=document.getElementById("finYearcl").value;uploadJsonFile(session.gstin,"ccledger",e,t.data)}else s.textContent="Error: "+t.error;else s.textContent="No response from content script. Make sure you're on GST portal tab."}))})):s.textContent="Please open GST portal tab!"}))})),d.addEventListener("click",(()=>{const t=document.getElementById("finYearcl").value.split("-")[0];chrome.tabs.query({active:!0,currentWindow:!1},(e=>{const n=e[0];n.url.startsWith("https://return.gst.gov.in/")?chrome.scripting.executeScript({target:{tabId:n.id},files:["contentscript.js"]},(()=>{chrome.tabs.sendMessage(n.id,{action:"fetchRtnDetails",fy:t},(t=>{if(t)if(t.success){JSON.stringify(t.data,null,2);var e=document.getElementById("finYearcl").value;uploadJsonFile(session.gstin,"RTN",e,t.data)}else s.textContent="Error: "+t.error;else s.textContent="No response from content script. Make sure you're on GST portal tab."}))})):s.textContent="Please open Deshboard First, ReFresh!"}))})),i.addEventListener("click",(()=>{chrome.tabs.query({active:!0,currentWindow:!1},(t=>{const e=t[0];if(!e.url.startsWith("https://payment.gst.gov.in/"))return void(s.textContent="Please open GST portal tab!");const n=document.getElementById("result");n.innerHTML=`\n        <div class="tabs">\n            <div class="tab active" data-target="allcl">All</div>\n            <div class="tab" data-target="igstcl">IGST</div>\n            <div class="tab" data-target="cgstcl">CGST</div>\n            <div class="tab" data-target="sgstcl">SGST</div>\n      <div class="tab" data-target="cesscl">CESS</div>\n             <span style="font-size:15px; color: #007bff; margin-left:15%; white-space:nowrap;">CASH LEDGER:${a.value}</span>\n            <button id="exportBtn" class="btn btn-outline-primary" style="margin-left:160px;  border-radius:18px;"><i class="fa fa-file-excel-o" aria-hidden="true"></i>  Download</button>\n        </div>\n        <div id="allcl" class="tab-content active"></div>\n        <div id="igstcl" class="tab-content"></div>\n        <div id="cgstcl" class="tab-content"></div>\n        <div id="sgstcl" class="tab-content"></div>\n      <div id="cesscl" class="tab-content"></div>\n            `,n.querySelectorAll(".tab").forEach((t=>{t.addEventListener("click",(()=>{n.querySelectorAll(".tab").forEach((t=>t.classList.remove("active"))),n.querySelectorAll(".tab-content").forEach((t=>t.classList.remove("active"))),t.classList.add("active"),document.getElementById(t.dataset.target).classList.add("active")}))})),document.getElementById("exportBtn").addEventListener("click",(()=>{const t=XLSX.utils.book_new();document.querySelectorAll(".tab-content").forEach((e=>{const n=e.querySelector("table");if(n){const s=XLSX.utils.table_to_sheet(n);Object.keys(s).forEach((t=>{if("!"===t[0])return;const e=parseInt(t.replace(/[^0-9]/g,""))-1,a=t.replace(/[0-9]/g,"").charCodeAt(0)-65;if(1===a){const i=n.rows[e]?.cells[a];if(i){const e=i.innerText.trim();s[t].t="s",s[t].v=e,s[t].w=e}}})),XLSX.utils.book_append_sheet(t,s,e.id.toUpperCase())}})),XLSX.writeFile(t,`${a.value}_CASH-Ledger_${session.gstin}.xlsx`)})),chrome.windows.getCurrent({},(function(t){chrome.windows.update(t.id,{state:"maximized"})}));document.getElementById("result").style.height="74%",chrome.scripting.executeScript({target:{tabId:e.id},files:["contentscript.js"]},(()=>{chrome.tabs.sendMessage(e.id,{action:"fetchCashDetails",from:window.from_cl_dt,to:window.to_cl_dt},(t=>{t?t.success?(document.getElementById("allcl").innerHTML=buildTable_allcl(t.data.tr),document.getElementById("igstcl").innerHTML=buildTable_igstcl(t.data.tr),document.getElementById("cgstcl").innerHTML=buildTable_cgstcl(t.data.tr),document.getElementById("sgstcl").innerHTML=buildTable_sgstcl(t.data.tr),document.getElementById("cesscl").innerHTML=buildTable_cesscl(t.data.tr)):s.textContent="Error: "+t.error:s.textContent="No response from content script. Make sure you're on GST portal tab."}))}))}))})),n.addEventListener("click",(()=>{document.getElementById("result").innerHTML="Radhe Radhe!! <br><br>Please Wiat... <i class='fa fa-spinner fa-pulse fa-3x fa-fw' aria-hidden='true'></i>",document.getElementById("more-penal").style.display="none",intoReturnPage(),setTimeout((()=>{location.reload()}),1e3)})),o.addEventListener("click",(()=>{chrome.tabs.query({active:!0,currentWindow:!1},(t=>{const e=t[0];if(!e.url.startsWith("https://return.gst.gov.in/"))return void(s.textContent="Please open GST portal tab!");const n=document.getElementById("result");n.innerHTML=`\n        <div class="tabs">\n            <div class="tab active" data-target="allcl">All</div>\n            <div class="tab" data-target="igstcl">IGST</div>\n            <div class="tab" data-target="cgstcl">CGST</div>\n            <div class="tab" data-target="sgstcl">SGST</div>\n      <div class="tab" data-target="cesscl">CESS</div>\n             <span style="font-size:15px; color: #007bff; margin-left:15%; white-space:nowrap">CREDIT LEDGER:${a.value}</span>\n            <button id="exportBtn" class="btn btn-outline-primary" style="margin-left:160px;  border-radius:18px;"><i class="fa fa-file-excel-o" aria-hidden="true"></i>  Download</button>\n        </div>\n        <div id="allcl" class="tab-content active"></div>\n        <div id="igstcl" class="tab-content"></div>\n        <div id="cgstcl" class="tab-content"></div>\n        <div id="sgstcl" class="tab-content"></div>\n      <div id="cesscl" class="tab-content"></div>\n            `,n.querySelectorAll(".tab").forEach((t=>{t.addEventListener("click",(()=>{n.querySelectorAll(".tab").forEach((t=>t.classList.remove("active"))),n.querySelectorAll(".tab-content").forEach((t=>t.classList.remove("active"))),t.classList.add("active"),document.getElementById(t.dataset.target).classList.add("active")}))})),document.getElementById("exportBtn").addEventListener("click",(()=>{const t=XLSX.utils.book_new();document.querySelectorAll(".tab-content").forEach((e=>{const n=e.querySelector("table");if(n){const s=XLSX.utils.table_to_sheet(n);Object.keys(s).forEach((t=>{if("!"===t[0])return;const e=parseInt(t.replace(/[^0-9]/g,""))-1,a=t.replace(/[0-9]/g,"").charCodeAt(0)-65;if(1===a){const i=n.rows[e]?.cells[a];if(i){const e=i.innerText.trim();s[t].t="s",s[t].v=e,s[t].w=e}}})),XLSX.utils.book_append_sheet(t,s,e.id.toUpperCase())}})),XLSX.writeFile(t,`${a.value}_Credit-Ledger_${session.gstin}.xlsx`)})),chrome.windows.getCurrent({},(function(t){chrome.windows.update(t.id,{state:"maximized"})}));document.getElementById("result").style.height="74%",chrome.scripting.executeScript({target:{tabId:e.id},files:["contentscript.js"]},(()=>{chrome.tabs.sendMessage(e.id,{action:"fetchCreditDetails",from:window.from_cl_dt,to:window.to_cl_dt},(t=>{t?t.success?(document.getElementById("allcl").innerHTML=buildTable_allccl(t.data.tr),document.getElementById("igstcl").innerHTML=buildTable_igstccl(t.data.tr),document.getElementById("cgstcl").innerHTML=buildTable_cgstccl(t.data.tr),document.getElementById("sgstcl").innerHTML=buildTable_sgstccl(t.data.tr),document.getElementById("cesscl").innerHTML=buildTable_cessccl(t.data.tr)):s.textContent="Error: "+t.error:s.textContent="No response from content script. Make sure you're on GST portal tab."}))}))}))})),a.addEventListener("change",(function(){const t=this.value,[e]=t.split("-"),n=parseInt(e,10),s=n+1;let a=new Date(n,3,1),i=new Date(s,2,31);const o=new Date(2017,6,1),l=new Date;a<o&&(a=o),i>l&&(i=l);const r=t=>`${String(t.getDate()).padStart(2,"0")}/${String(t.getMonth()+1).padStart(2,"0")}/${t.getFullYear()}`;window.from_cl_dt=r(a),window.to_cl_dt=r(i),window.actdiv?(document.getElementById(window.actdiv).click(),["upload-gen-cledger","upload-gen-ccledger","upload-gen-RTN","upload-gen-GSTIN"].forEach((t=>{const e=document.getElementById(t);e&&(e.disabled=!1),e&&(e.innerHTML="Send to xlsdeal.com")}))):document.getElementById("result").innerHTML="Radhe Radhe!! <br><br>{Click any Tab to View the Report}"})),window.from_cl_dt=formatDatedef(fyStartDate),window.to_cl_dt=formatDatedef(today))}));const today=new Date,currentMonth=today.getMonth()+1;let fyStartYear=today.getFullYear();currentMonth<4&&(fyStartYear-=1);const fyStartDate=new Date(fyStartYear,3,1);function buildTable_allcl(t){let e="<table class='result-tab' id='all_cledger'><thead><tr>";["SL","Date","Description","Period","SGST Total","CGST Total","IGST Total","GST Total","Running Balances","Reference No.","Types","ON Time"].forEach((t=>e+=`<th>${t}</th>`)),e+="</tr></thead><tbody>";var n=0;return t.forEach((t=>{n++,e+="<tr>",e+=`<td style="text-align:left">${n}</td>`,e+=`<td style="text-align:left">${t.dpt_dt||""}</td>`,e+=`<td style="text-align:left">${t.desc||""}</td>`,e+=`<td>${t.ret_period||""}</td>`,"Cr"==`${t.tr_typ}`?(e+=`<td>-${indianFormat(t.sgst?.tot)??""}</td>`,e+=`<td>-${indianFormat(t.cgst?.tot)??""}</td>`,e+=`<td>-${indianFormat(t.igst?.tot)??""}</td>`,e+=`<td><b>-${indianFormat(t.tot_tr_amt)??""}</b></td>`):(e+=`<td>${indianFormat(t.sgst?.tot)??""}</td>`,e+=`<td>${indianFormat(t.cgst?.tot)??""}</td>`,e+=`<td>${indianFormat(t.igst?.tot)??""}</td>`,e+=`<td><b>${indianFormat(t.tot_tr_amt)??""}</b></td>`),e+=`<td style="background:pink;">${indianFormat(t.tot_rng_bal)??""}</td>`,e+=`<td style="text-align:left">${t.refNo||""}</td>`,e+=`<td>${t.tr_typ||""}</td>`,e+=`<td>${t.dpt_time||""}</td>`,e+="</tr>"})),e+="</tbody></table>",e}function buildTable_igstcl(t){let e="<table class='result-tab' id='igst_cledger'><thead><tr>";["SL","Date","Description","Period","IGST Interest","IGST Other","IGST Tax","IGST Fee","IGST Penalty","IGST Total","IGST Balance Total","Reference No.","Type"].forEach((t=>e+=`<th>${t}</th>`)),e+="</tr></thead><tbody>";let n=0;return t.forEach((t=>{0==`${t.igst?.tot}`&&n>0||(n++,e+="<tr>",e+=`<td style="text-align:left">${n}</td>`,e+=`<td style="text-align:left">${t.dpt_dt||""}</td>`,e+=`<td style="text-align:left">${t.desc||""}</td>`,e+=`<td>${t.ret_period||""}</td>`,"Cr"==`${t.tr_typ}`?(e+=`<td>-${indianFormat(t.igst?.intr)??""}</td>`,e+=`<td>-${indianFormat(t.igst?.oth)??""}</td>`,e+=`<td>-${indianFormat(t.igst?.tx)??""}</td>`,e+=`<td>-${indianFormat(t.igst?.fee)??""}</td>`,e+=`<td>-${indianFormat(t.igst?.pen)??""}</td>`,e+=`<td><b>-${indianFormat(t.igst?.tot)??""}</b></td>`):(e+=`<td>${indianFormat(t.igst?.intr)??""}</td>`,e+=`<td>${indianFormat(t.igst?.oth)??""}</td>`,e+=`<td>${indianFormat(t.igst?.tx)??""}</td>`,e+=`<td>${indianFormat(t.igst?.fee)??""}</td>`,e+=`<td>${indianFormat(t.igst?.pen)??""}</td>`,e+=`<td><b>${indianFormat(t.igst?.tot)??""}</b></td>`),e+=`<td style="background:pink;">${indianFormat(t.igstbal?.tot)??""}</td>`,e+=`<td style="text-align:left">${t.refNo||""}</td>`,e+=`<td>${t.tr_typ||""}</td>`,e+="</tr>")})),e+="</tbody></table>",e}function buildTable_cgstcl(t){let e="<table class='result-tab' id='cgst_cledger'><thead><tr>";["SL","Date","Description","Period","CGST Interest","CGST Other","CGST Tax","CGST Fee","CGST Penalty","CGST Total","CGST Balance Total","Reference No.","Type"].forEach((t=>e+=`<th>${t}</th>`)),e+="</tr></thead><tbody>";let n=0;return t.forEach((t=>{0==`${t.cgst?.tot}`&&n>0||(n++,e+="<tr>",e+=`<td style="text-align:left">${n}</td>`,e+=`<td style="text-align:left">${t.dpt_dt||""}</td>`,e+=`<td style="text-align:left">${t.desc||""}</td>`,e+=`<td>${t.ret_period||""}</td>`,"Cr"==`${t.tr_typ}`?(e+=`<td>-${indianFormat(t.cgst?.intr)??""}</td>`,e+=`<td>-${indianFormat(t.cgst?.oth)??""}</td>`,e+=`<td>-${indianFormat(t.cgst?.tx)??""}</td>`,e+=`<td>-${indianFormat(t.cgst?.fee)??""}</td>`,e+=`<td>-${indianFormat(t.cgst?.pen)??""}</td>`,e+=`<td><b>-${indianFormat(t.cgst?.tot)??""}</b></td>`):(e+=`<td>${indianFormat(t.cgst?.intr)??""}</td>`,e+=`<td>${indianFormat(t.cgst?.oth)??""}</td>`,e+=`<td>${indianFormat(t.cgst?.tx)??""}</td>`,e+=`<td>${indianFormat(t.cgst?.fee)??""}</td>`,e+=`<td>${indianFormat(t.cgst?.pen)??""}</td>`,e+=`<td><b>${indianFormat(t.cgst?.tot)??""}</b></td>`),e+=`<td style="background:pink;">${indianFormat(t.cgstbal?.tot)??""}</td>`,e+=`<td style="text-align:left">${t.refNo||""}</td>`,e+=`<td>${t.tr_typ||""}</td>`,e+="</tr>")})),e+="</tbody></table>",e}function buildTable_sgstcl(t){let e="<table class='result-tab' id='sgst_cledger'><thead><tr>";["SL","Date","Description","Period","SGST Interest","SGST Other","SGST Tax","SGST Fee","SGST Penalty","SGST Total","SGST Balance Total","Reference No.","Type"].forEach((t=>e+=`<th>${t}</th>`)),e+="</tr></thead><tbody>";let n=0;return t.forEach((t=>{0==`${t.sgst?.tot}`&&n>0||(n++,e+="<tr>",e+=`<td style="text-align:left">${n}</td>`,e+=`<td style="text-align:left">${t.dpt_dt||""}</td>`,e+=`<td style="text-align:left">${t.desc||""}</td>`,e+=`<td>${t.ret_period||""}</td>`,"Cr"==`${t.tr_typ}`?(e+=`<td>-${indianFormat(t.sgst?.intr)??""}</td>`,e+=`<td>-${indianFormat(t.sgst?.oth)??""}</td>`,e+=`<td>-${indianFormat(t.sgst?.tx)??""}</td>`,e+=`<td>-${indianFormat(t.sgst?.fee)??""}</td>`,e+=`<td>-${indianFormat(t.sgst?.pen)??""}</td>`,e+=`<td><b>-${indianFormat(t.sgst?.tot)??""}</b></td>`):(e+=`<td>${indianFormat(t.sgst?.intr)??""}</td>`,e+=`<td>${indianFormat(t.sgst?.oth)??""}</td>`,e+=`<td>${indianFormat(t.sgst?.tx)??""}</td>`,e+=`<td>${indianFormat(t.sgst?.fee)??""}</td>`,e+=`<td>${indianFormat(t.sgst?.pen)??""}</td>`,e+=`<td><b>${indianFormat(t.sgst?.tot)??""}</b></td>`),e+=`<td style="background:pink;">${indianFormat(t.sgstbal?.tot)??""}</td>`,e+=`<td style="text-align:left">${t.refNo||""}</td>`,e+=`<td>${t.tr_typ||""}</td>`,e+="</tr>")})),e+="</tbody></table>",e}function buildTable_cesscl(t){let e="<table class='result-tab' id='cess_cledger'><thead><tr>";["SL","Date","Description","Period","CESS Interest","CESS Other","CESS Tax","CESS Fee","CESS Penalty","CESS Total","CESS Balance Total","Reference No.","Type"].forEach((t=>e+=`<th>${t}</th>`)),e+="</tr></thead><tbody>";let n=0;return t.forEach((t=>{0==`${t.cess?.tot}`&&n>0||(n++,e+="<tr>",e+=`<td style="text-align:left">${n}</td>`,e+=`<td style="text-align:left">${t.dpt_dt||""}</td>`,e+=`<td style="text-align:left">${t.desc||""}</td>`,e+=`<td>${t.ret_period||""}</td>`,"Cr"==`${t.tr_typ}`?(e+=`<td>-${indianFormat(t.cess?.intr)??""}</td>`,e+=`<td>-${indianFormat(t.cess?.oth)??""}</td>`,e+=`<td>-${indianFormat(t.cess?.tx)??""}</td>`,e+=`<td>-${indianFormat(t.cess?.fee)??""}</td>`,e+=`<td>-${indianFormat(t.cess?.pen)??""}</td>`,e+=`<td><b>-${indianFormat(t.cess?.tot)??""}</b></td>`):(e+=`<td>${indianFormat(t.cess?.intr)??""}</td>`,e+=`<td>${indianFormat(t.cess?.oth)??""}</td>`,e+=`<td>${indianFormat(t.cess?.tx)??""}</td>`,e+=`<td>${indianFormat(t.cess?.fee)??""}</td>`,e+=`<td>${indianFormat(t.cess?.pen)??""}</td>`,e+=`<td><b>${indianFormat(t.cess?.tot)??""}</b></td>`),e+=`<td style="background:pink;">${indianFormat(t.cessbal?.tot)??""}</td>`,e+=`<td style="text-align:left">${t.refNo||""}</td>`,e+=`<td>${t.tr_typ||""}</td>`,e+="</tr>")})),e+="</tbody></table>",e}function buildTable_allccl(t){let e="<table class='result-tab' id='all_cledger'><thead><tr>";["SL","Date","Description","Period","SGST Total","CGST Total","IGST Total","CESS Total","GST Total","Running Balances","Reference No.","Types","ON Time"].forEach((t=>e+=`<th>${t}</th>`)),e+="</tr></thead><tbody>";var n=0;return t.forEach((t=>{n++,e+="<tr>",e+=`<td style="text-align:left">${n}</td>`,e+=`<td style="text-align:left">${t.dt||""}</td>`,e+=`<td style="text-align:left">${t.desc||""}</td>`,e+=`<td>${t.ret_period||""}</td>`,"Cr"==`${t.tr_typ}`?(e+=`<td>-${indianFormat(t.sgstTaxAmt)??""}</td>`,e+=`<td>-${indianFormat(t.cgstTaxAmt)??""}</td>`,e+=`<td>-${indianFormat(t.igstTaxAmt)??""}</td>`,e+=`<td>-${indianFormat(t.cessTaxAmt)??""}</td>`,e+=`<td><b>-${indianFormat(t.tot_tr_amt)??""}</b></td>`):(e+=`<td>${indianFormat(t.sgstTaxAmt)??""}</td>`,e+=`<td>${indianFormat(t.cgstTaxAmt)??""}</td>`,e+=`<td>${indianFormat(t.igstTaxAmt)??""}</td>`,e+=`<td>${indianFormat(t.cessTaxAmt)??""}</td>`,e+=`<td><b>${indianFormat(t.tot_tr_amt)??""}</b></td>`),e+=`<td style="background:pink;">${indianFormat(t.tot_rng_bal)??""}</td>`,e+=`<td style="text-align:left">${t.ref_no||""}</td>`,e+=`<td>${t.tr_typ||""}</td>`,e+=`<td>${t.dpt_time||""}</td>`,e+="</tr>"})),e+="</tbody></table>",e}function buildTable_igstccl(t){let e="<table class='result-tab' id='igst_cledger'><thead><tr>";["SL","Date","Description","Period","IGST Tax","IGST Balance Total","Reference No.","Type"].forEach((t=>e+=`<th>${t}</th>`)),e+="</tr></thead><tbody>";let n=0;return t.forEach((t=>{0==`${t.igstTaxAmt}`&&n>0||(n++,e+="<tr>",e+=`<td style="text-align:left">${n}</td>`,e+=`<td style="text-align:left">${t.dt||""}</td>`,e+=`<td style="text-align:left">${t.desc||""}</td>`,e+=`<td>${t.ret_period||""}</td>`,"Cr"==`${t.tr_typ}`?e+=`<td>-${indianFormat(t.igstTaxAmt)??""}</td>`:e+=`<td>${indianFormat(t.igstTaxAmt)??""}</td>`,e+=`<td style="background:pink;">${indianFormat(t.igstTaxBal)??""}</td>`,e+=`<td style="text-align:left">${t.ref_no||""}</td>`,e+=`<td>${t.tr_typ||""}</td>`,e+="</tr>")})),e+="</tbody></table>",e}function buildTable_cgstccl(t){let e="<table class='result-tab' id='igst_cledger'><thead><tr>";["SL","Date","Description","Period","IGST Tax","IGST Balance Total","Reference No.","Type"].forEach((t=>e+=`<th>${t}</th>`)),e+="</tr></thead><tbody>";let n=0;return t.forEach((t=>{0==`${t.cgstTaxAmt}`&&n>0||(n++,e+="<tr>",e+=`<td style="text-align:left">${n}</td>`,e+=`<td style="text-align:left">${t.dt||""}</td>`,e+=`<td style="text-align:left">${t.desc||""}</td>`,e+=`<td>${t.ret_period||""}</td>`,"Cr"==`${t.tr_typ}`?e+=`<td>-${indianFormat(t.cgstTaxAmt)??""}</td>`:e+=`<td>${indianFormat(t.cgstTaxAmt)??""}</td>`,e+=`<td style="background:pink;">${indianFormat(t.cgstTaxBal)??""}</td>`,e+=`<td style="text-align:left">${t.ref_no||""}</td>`,e+=`<td>${t.tr_typ||""}</td>`,e+="</tr>")})),e+="</tbody></table>",e}function buildTable_sgstccl(t){let e="<table class='result-tab' id='igst_cledger'><thead><tr>";["SL","Date","Description","Period","IGST Tax","IGST Balance Total","Reference No.","Type"].forEach((t=>e+=`<th>${t}</th>`)),e+="</tr></thead><tbody>";let n=0;return t.forEach((t=>{0==`${t.cgstTaxAmt}`&&n>0||(n++,e+="<tr>",e+=`<td style="text-align:left">${n}</td>`,e+=`<td style="text-align:left">${t.dt||""}</td>`,e+=`<td style="text-align:left">${t.desc||""}</td>`,e+=`<td>${t.ret_period||""}</td>`,"Cr"==`${t.tr_typ}`?e+=`<td>-${indianFormat(t.cgstTaxAmt)??""}</td>`:e+=`<td>${indianFormat(t.cgstTaxAmt)??""}</td>`,e+=`<td style="background:pink;">${indianFormat(t.cgstTaxBal)??""}</td>`,e+=`<td style="text-align:left">${t.ref_no||""}</td>`,e+=`<td>${t.tr_typ||""}</td>`,e+="</tr>")})),e+="</tbody></table>",e}function buildTable_cessccl(t){let e="<table class='result-tab' id='igst_cledger'><thead><tr>";["SL","Date","Description","Period","IGST Tax","IGST Balance Total","Reference No.","Type"].forEach((t=>e+=`<th>${t}</th>`)),e+="</tr></thead><tbody>";let n=0;return t.forEach((t=>{0==`${t.cessTaxAmt}`&&n>0||(n++,e+="<tr>",e+=`<td style="text-align:left">${n}</td>`,e+=`<td style="text-align:left">${t.dt||""}</td>`,e+=`<td style="text-align:left">${t.desc||""}</td>`,e+=`<td>${t.ret_period||""}</td>`,"Cr"==`${t.tr_typ}`?e+=`<td>-${indianFormat(t.cessTaxAmt)??""}</td>`:e+=`<td>${indianFormat(t.cessTaxAmt)??""}</td>`,e+=`<td style="background:pink;">${indianFormat(t.cessTaxBal)??""}</td>`,e+=`<td style="text-align:left">${t.ref_no||""}</td>`,e+=`<td>${t.tr_typ||""}</td>`,e+="</tr>")})),e+="</tbody></table>",e}function populateMonths(t){let[e,n]=t.split("-");e=parseInt(e);var s=parseInt("20"+n);const a=document.getElementById("monthSelect");a.innerHTML="",[{text:"Apr",num:"04"},{text:"May",num:"05"},{text:"Jun",num:"06"},{text:"Jul",num:"07"},{text:"Aug",num:"08"},{text:"Sep",num:"09"},{text:"Oct",num:"10"},{text:"Nov",num:"11"},{text:"Dec",num:"12"},{text:"Jan",num:"01"},{text:"Feb",num:"02"},{text:"Mar",num:"03"}].forEach(((t,n)=>{let i=n<9?e:s;const o=t.num+i,l=document.createElement("option");l.value=o,l.textContent=`${t.text}-${i}`,a.appendChild(l)})),a.selectedIndex=0}function AllGroupedTable(t){const e=document.getElementById("result");function n(t,e){return t.filter((t=>t.from!==e))}e.innerHTML='\n        <div class="tabs">\n            <div class="tab active" data-target="inv" >VIEW</div>\n            <div class="tab" data-target="invup" >UPDATE</div>\n\n\n  <input type="text" id="searchBox" placeholder="Search Name / GSTIN / Invoice..." style="padding:0px; margin-left:10px; width:200px; border-radius:20px;">\n  \n  \n\n             <span style="font-size:15px; color: #007bff; margin-left:15px;">IMS-INWARD</span>\n\n\n\n\n\n\n\n      <span id="moredtlbtn2" style="margin-left:40px;">\n      \n      <div class="checkbox-wrapper-14">\n  <input id="showTotals" type="checkbox" class="switch" checked>\n  <label for="showTotals">Group </label>\n\n    \n        <label class="btn btn-outline-success" style="height:24px;"><input type=\'checkbox\' id="IMSINV" checked > INV</label>\n        <label class="btn btn-outline-success" style="height:24px;"><input type=\'checkbox\' id="IMSCN" checked > CN</label>\n        <label class="btn btn-outline-success" style="height:24px;"><input type=\'checkbox\' id="IMSDN" checked > DN</label>\n        <label class="btn btn-outline-success" style="height:24px;"><input type=\'checkbox\' id="IMSECOM" checked> ECOM</label>\n\n      </div>\n                </span>\n                  <button id="exportBtn" class="btn btn-outline-primary" style="margin-left:40px;  border-radius:18px;"><i class="fa fa-file-excel-o" aria-hidden="true"></i>  Download</button>\n                </div>\n        <div id="inv" class="tab-content active"></div>\n      <div id="invup" class="tab-content">\n      <input id=\'imsfile\' type=\'file\' accept=".xlsx"/>\n      <button id=\'imsupdate\'>Validate</button>\n      <button id=\'syncimsbtn\' disabled>Sync with Portal</button>\n      <div id="inv_org"></div>\n      <hr>\n      <div id="uploadresponse"><b>Upload your that Downloaded Excel File with your Required Actions {A/R/P}. <br><span style=\'color:red;\'>Note: Credit Note Actions {A/R} </span></b><br><br><h3><b>A: accept <br> R: reject <br> P: pending</b></h3></div>\n      </div>\n            ',maximizerfn(),oneGroupedTable(t),document.getElementById("moredtlbtn2").addEventListener("change",(()=>{if(0==document.getElementById("IMSINV").checked)var e=n(t,"b2b");else e=t;if(0==document.getElementById("IMSCN").checked)var s=n(e,"cn");else s=e;if(0==document.getElementById("IMSDN").checked)var a=n(s,"dn");else a=s;if(0==document.getElementById("IMSECOM").checked)var i=n(a,"ecom");else i=a;oneGroupedTable(i)})),e.querySelectorAll(".tab").forEach((t=>{t.addEventListener("click",(()=>{e.querySelectorAll(".tab").forEach((t=>t.classList.remove("active"))),e.querySelectorAll(".tab-content").forEach((t=>t.classList.remove("active"))),t.classList.add("active"),document.getElementById(t.dataset.target).classList.add("active")}))})),document.getElementById("exportBtn").addEventListener("click",(()=>{const t=XLSX.utils.book_new();document.querySelectorAll(".tab-content_org").forEach((e=>{const n=e.querySelector("table");if(n){const e=Array.from(n.querySelectorAll("tr")).map((t=>Array.from(t.querySelectorAll("th,td")).map((t=>t.innerText.trim())))),s=XLSX.utils.aoa_to_sheet(e),a=XLSX.utils.decode_range(s["!ref"]);for(let t=a.s.r+1;t<=a.e.r;++t)[2].forEach((e=>{const n=XLSX.utils.encode_cell({r:t,c:e}),a=s[n];if(a&&"string"==typeof a.v){let t=a.v.replace(/,/g,"");isNaN(t)||""===t||(a.v=Number(t),a.t="n")}}));XLSX.utils.book_append_sheet(t,s,"XLSDEAL-IMS")}})),XLSX.writeFile(t,`LIVE_IMS_${session.gstin}.xlsx`)}))}function AllGroupedTableoutward(t){function e(t,e){return t.filter((t=>t.from!==e))}document.getElementById("result").innerHTML='\n        <div class="tabs">\n            <div class="tab active" data-target="inv" >VIEW</div>\n             <span style="font-size:15px; color: #007bff; margin-left:1%; white-space: nowrap;">R1/IFF :IMS-OUTWARD</span>\n        <span id="moredtlbtn2" style="margin-left:2%;">\n      \n      <div class="checkbox-wrapper-14">\n  \n        <label class="btn btn-outline-success" style="height:24px;"><input type=\'checkbox\' id="IMSINV" checked > INV</label>\n        <label class="btn btn-outline-success" style="height:24px;"><input type=\'checkbox\' id="IMSCN" checked > CN</label>\n\n<span id="expOptions"></span>\n      </div>\n                </span>\n      \n                </div>\n        <div id="inv" class="tab-content active"></div>\n\n      </div>\n            ',maximizerfn(),oneGroupedTable_outward(t),document.getElementById("moredtlbtn2").addEventListener("change",(()=>{if(0==document.getElementById("IMSINV").checked)var n=e(t,"b2b");else n=t;if(0==document.getElementById("IMSCN").checked)var s=e(n,"cn");else s=n;oneGroupedTable_outward(s)}))}function oneGroupedTable_outward(t){let e='\n    <label for="actionFilter">Filter by Action: </label>\n    <select class="btn btn-outline-primary" id="actionFilter">\n      <option value="">All</option>\n      <option value="A">Accept</option>\n      <option value="R" selected>Reject</option>\n      <option value="P">Pending</option>\n      <option value="blank">NoAction</option>\n    </select>\n    <button class="btn btn-outline-success" id="exportBtnonly" style="margin-left:10px;"><i class="fa fa-file-excel-o" aria-hidden="true"></i>  Download</button>\n    \n  <table class=\'result-tab\' style=\'font-size:12px; text-align:left; border-collapse:collapse;\' \n         id="imstable" border="1">\n    <thead>\n      <tr>\n        <th>From</th>\n        <th>GSTIN</th>\n        <th>Name</th>\n        <th>Period</th>\n        <th>SL</th>\n        <th>Date</th>\n        <th>Invoice / Note</th>\n        <th>Taxable</th>\n        <th>IGST</th>\n        <th>CGST</th>\n        <th>SGST</th>\n        <th>CESS</th>\n        <th>Total</th>\n        <th>Action</th>\n      </tr>\n    </thead>\n    <tbody>',n=0,s=0,a=0,i=0,o=0,l=0,r={};t.forEach((t=>{const e=t.ctin;r[e]||(r[e]={name:t.tradenm||"",rows:[]}),t.inv&&r[e].rows.push(...t.inv.map((t=>({...t,type:"inv"})))),t.nt&&r[e].rows.push(...t.nt.map((t=>({...t,type:"nt"}))))})),Object.keys(r).forEach((t=>{const d=r[t].name,c=r[t].rows;let u=0,m=0,g=0,y=0,p=0,f=0;c.forEach((t=>{let e=1,n="inv";"nt"===t.type&&("C"===t.ntty?(e=-1,n="cn"):"D"===t.ntty&&(e=1,n="dn")),t._sign=e,t._fromLabel=n,u+=e*(t.txval||0),m+=e*(t.iamt||0),g+=e*(t.camt||0),y+=e*(t.samt||0),p+=e*(t.csamt||0),f+=e*(t.val||0)})),n+=u,s+=m,a+=g,i+=y,o+=p,l+=f,e+=`<tr class="total-row group-total-${t}" data-group="${t}" \n                style="background:#587b9f; color:white; font-weight:bold; cursor:pointer;">\n      <td></td>\n      <td style="text-align:left"><span style='color:#f3ff53;'>${t}</span></td>\n      <td style="text-align:left">${d}</td>\n      <td>Total: (${c.length})</td>\n      <td></td><td></td><td></td>\n      <td>${indianFormat(u)}</td>\n      <td>${indianFormat(m)}</td>\n      <td>${indianFormat(g)}</td>\n      <td>${indianFormat(y)}</td>\n      <td>${indianFormat(p)}</td>\n      <td>${indianFormat(f)}</td>\n      <td></td>\n    </tr>`;let h=0;c.forEach((n=>{h++;let s=n.imsActn||"",a="C"===n.ntty?"red":"black";e+=`<tr class="child-row group-${t}" \n                  data-action="${s}" \n                  style="display:none; color:${a}; background:#f3f3f3; font-style:italic;">\n        <td>${n._fromLabel}</td>\n        <td style="text-align:left">${t}</td>\n        <td style="text-align:left">${d}</td>\n        <td>${n.rtnprd||""}</td>\n        <td>${h}</td>\n        <td>${n.idt||n.nt_dt||""}</td>\n        <td style="text-align:left">${n.inum||n.nt_num||""}</td>\n        <td>${indianFormat(n._sign*(n.txval||0))}</td>\n        <td>${indianFormat(n._sign*(n.iamt||0))}</td>\n        <td>${indianFormat(n._sign*(n.camt||0))}</td>\n        <td>${indianFormat(n._sign*(n.samt||0))}</td>\n        <td>${indianFormat(n._sign*(n.csamt||0))}</td>\n        <td>${indianFormat(n._sign*(n.val||0))}</td>\n        <td>${s}</td>\n      </tr>`}))}));indianFormat(n),indianFormat(s),indianFormat(a),indianFormat(i),indianFormat(o),indianFormat(l);e+="</tbody></table>",document.getElementById("inv").innerHTML=e,setTimeout((()=>{!function(){const t="R";document.querySelectorAll(".total-row, .child-row").forEach((t=>{t.style.display="none"})),document.querySelectorAll(".child-row").forEach((e=>{if((e.dataset.action||"")===t){e.style.display="";const t=[...e.classList].find((t=>t.startsWith("group-")));if(t){const e=t.replace("group-",""),n=document.querySelector(`.group-total-${e}`);n&&(n.style.display="")}}}))}()}),1e3),document.querySelectorAll(".total-row").forEach((t=>{t.addEventListener("click",(function(){let t=this.dataset.group,e=document.querySelectorAll(`.group-${t}`),n=[...e].some((t=>"none"!==t.style.display));document.querySelectorAll(".child-row").forEach((t=>t.style.display="none")),n||e.forEach((t=>t.style.display=""))}))})),document.getElementById("actionFilter").addEventListener("change",(function(){let t=this.value;document.querySelectorAll(".total-row").forEach((t=>t.style.display="none")),document.querySelectorAll(".child-row").forEach((t=>t.style.display="none")),document.querySelectorAll(".child-row").forEach((e=>{let n=e.dataset.action||"";if(""===t||"blank"===t&&""===n||"blank"!==t&&n===t){e.style.display="";let t=[...e.classList].find((t=>t.startsWith("group-"))).replace("group-",""),n=document.querySelector(`.group-total-${t}`);n&&(n.style.display="")}}))})),document.getElementById("exportBtnonly").addEventListener("click",(()=>{const t=XLSX.utils.book_new(),e=document.getElementById("imstable"),n=document.getElementById("actionFilter");if(e){const n=Array.from(e.querySelectorAll("tr")).filter((t=>null!==t.offsetParent&&!t.classList.contains("total-row"))).map((t=>Array.from(t.querySelectorAll("th,td")).filter((t=>null!==t.offsetParent)).map((t=>t.innerText.trim())))),s=XLSX.utils.aoa_to_sheet(n),a=XLSX.utils.decode_range(s["!ref"]);for(let t=a.s.r+1;t<=a.e.r;++t)[7,8,9,10,11,12].forEach((e=>{const n=XLSX.utils.encode_cell({r:t,c:e}),a=s[n];if(a&&"string"==typeof a.v){let t=a.v.replace(/,/g,"");isNaN(t)||""===t||(a.v=Number(t),a.t="n")}}));XLSX.utils.book_append_sheet(t,s,"XLSDEAL-IMS")}XLSX.writeFile(t,`LIVE_OUTWARD_${n.value}_IMS_${session.gstin}.xlsx`)}))}function indianFormat(t){return null==t?"":Number(t).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}function indianFormat(t){if(!t)return"0";let e=(t=parseFloat(t).toFixed(2)).toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{2})+(?!\d))/g,","),e.join(".")}function flattenGSTData(t){let e=[];return Object.keys(t).forEach((n=>{Array.isArray(t[n])&&t[n].forEach((t=>{!t.inum&&t.nt_num&&(t.inum=t.nt_num),!t.idt&&t.nt_dt&&(t.idt=t.nt_dt),t.from=n,e.push(t)}))})),e}function oneGroupedTable(t){t.sort(((t,e)=>t.tradenm<e.tradenm?-1:t.tradenm>e.tradenm?1:new Date(t.idt)-new Date(e.idt)));let e='\n<table class=\'result-tab\' style=\'font-size:12px; text-align:left; border-collapse:collapse;\' id="imstable" border="1">\n  <thead>\n    <tr>\n      <th class="stin-col">Frm</th>\n      <th hidden>NEW/OLD</th> \n      <th>GSTIN</th>\n      <th >NAME</th> \n      \n  \n    <th class="tradenm-col">Period</th> \n          <th hidden>TYP</th>\n      \n      <th>SL</th> \n      <th hidden>GSTR</th>\n      <th>Date</th>\n      <th>Invoice</th>\n      <th>Taxable</th>\n      <th>IGST</th>\n      <th>CGST</th>\n      <th>SGST</th>\n      <th>CESS</th>\n      <th>Amount</th>\n      <th>Action</th>\n    </tr>\n  </thead>\n  <tbody>',n="\n<table class='result-tab' style='font-size:10px; text-align:left; border-collapse:collapse;' id=\"imstable_org\" border=\"1\" hidden>\n  <thead>\n    <tr>\n      <th>FRM</th>\n      <th>N/O</th> \n      <th>GSTIN</th>\n      <th>NAME OF CLIENT</th> \n      <th>POS</th> \n      <th>TYP</th>\n     <th>PERIOD</th>\n      <th>GSTR</th>\n      <th>Date</th>\n      <th>Invoice</th>\n      <th>Taxable</th>\n      <th>IGST</th>\n      <th>CGST</th>\n      <th>SGST</th>\n      <th>CESS</th>\n      <th>Amount</th>\n      <th>Action</th>\n    </tr>\n  </thead>\n  <tbody>";const s={};t.forEach((t=>{s[t.stin]||(s[t.stin]=[]),s[t.stin].push(t)}));let a=0,i=0,o=0,l=0,r=0,d=0;Object.keys(s).forEach((t=>{let c=s[t],u=0,m=0,g=0,y=0,p=0,f=0,h=0;c.forEach((t=>{let e="cn"===t.from||"cna"===t.from?-1:1;m+=e*(t.txval||0),g+=e*(t.iamt||0),y+=e*(t.camt||0),p+=e*(t.samt||0),f+=e*(t.cess||0),h+=e*(t.val||0)})),a+=m,i+=g,o+=y,l+=p,r+=f,d+=h,e+=`<tr class="total-row group-total-${t}" data-group="${t}" \n              style="background:#587b9f; color:white; font-weight:bold; cursor:pointer;">\n      <td style="text-align:left;"><span style='color:#f3ff53;'>${t}</span></td>\n      <td colspan="3" style='text-align:left;'>${c[0].tradenm||""}</td>\n      <td>Total: (${c.length}) Nos.</td>\n      <td>${indianFormat(m)}</td>\n      <td>${indianFormat(g)}</td>\n      <td>${indianFormat(y)}</td>\n      <td>${indianFormat(p)}</td>\n      <td>${indianFormat(f)}</td>\n      <td>${indianFormat(h)}</td>\n      <td></td>\n    </tr>`,c.forEach((s=>{u++;let a="N"==s.ispendactblocked?"":"red",i="cn"===s.from||"cna"===s.from?-1:1;e+=`<tr class="child-row group-${t}"  data-from="${s.from}" \n                  style="color:${a}; background:rgb(243 243 243); display:none; font-style:italic; font-weight:bold">\n        <td style='text-align:left;'>${s.from}</td>\n        <td style='text-align:left;' hidden>${s.ispendactblocked}</td>\n      <td class="stin-col" style='text-align:left;' hidden>${s.stin}</td>\n        <td class="tradenm-col" style='text-align:left;' hidden>${s.tradenm}</td>\n        \n        <td style='text-align:left;' hidden>${s.pos}</td>\n        <td style='text-align:left;' hidden>${s.inv_typ}</td>\n        <td style='text-align:left;'>${s.rtnprd}</td>\n        <td style='text-align:left;'>${u}</td>\n        <td style='text-align:left;' hidden>${s.srcform}</td>\n        <td style='text-align:center;'>${s.idt||s.nt_dt}</td>\n        <td style='text-align:left;'>${s.inum||s.nt_num}</td>\n        <td>${indianFormat(i*(s.txval||0))}</td>\n        <td>${indianFormat(i*(s.iamt||0))}</td>\n        <td>${indianFormat(i*(s.camt||0))}</td>\n        <td>${indianFormat(i*(s.samt||0))}</td>\n        <td>${indianFormat(i*(s.cess||0))}</td>\n        <td>${indianFormat(i*(s.val||0))}</td>\n        <td style='text-align:left;'>${s.action}</td>\n      </tr>`,n+=`<tr>\n        <td style='text-align:left;'>${s.from}</td>\n        <td style='text-align:left;'>${s.ispendactblocked}</td>\n      <td style='text-align:left;' >${s.stin}</td>\n        <td style='text-align:left;' >${s.tradenm}</td>\n        <td style='text-align:left;' >${s.pos}</td>\n        <td style='text-align:left;' >${s.inv_typ?s.inv_typ:""}</td>\n        <td style='text-align:left;'>${s.rtnprd}</td>\n        <td style='text-align:left;' >${s.srcform}</td>\n        <td style='text-align:center;'>${s.idt||s.nt_dt}</td>\n        <td style='text-align:left;'>${s.inum||s.nt_num}</td>\n        <td>${s.txval||0}</td>\n        <td>${s.iamt||0}</td>\n        <td>${s.camt||0}</td>\n        <td>${s.samt||0}</td>\n        <td>${s.cess||0}</td>\n        <td>${s.val||0}</td>\n        <td style='text-align:left;'>${s.action}</td>\n      </tr>`}))})),e+=`<tr style="background:#ffc107; font-weight:bold;">\n  <td></td>\n  <td style="text-align:right;">GRAND TOTAL:</td>\n  <td></td><td></td><td></td>\n      \n          <td class="tradenm-col" style='text-align:left;' hidden></td>\n        <td class="stin-col" hidden></td>\n      <td>${indianFormat(a)}</td>\n      <td>${indianFormat(i)}</td>\n      <td>${indianFormat(o)}</td>\n      <td>${indianFormat(l)}</td>\n      <td>${indianFormat(r)}</td>\n      <td>${indianFormat(d)}</td>\n      <td></td>\n    </tr>`,e+="</tbody></table>",n+="</tbody></table>",document.getElementById("inv").innerHTML=e,document.getElementById("inv_org").innerHTML="<div class='tab-content_org'>"+n+"</div>",document.getElementById("searchBox").value="",1==document.getElementById("showTotals").checked?(document.querySelectorAll(".total-row").forEach((t=>t.style.display="")),document.querySelectorAll(".child-row").forEach((t=>t.style.display="none")),document.querySelectorAll(".tradenm-col").forEach((t=>t.hidden=!0)),document.querySelectorAll(".stin-col").forEach((t=>t.hidden=!0))):(document.querySelectorAll(".child-row").forEach((t=>t.style.display="")),document.querySelectorAll(".total-row").forEach((t=>t.style.display="none")),document.querySelectorAll(".tradenm-col").forEach((t=>t.hidden=!1)),document.querySelectorAll(".stin-col").forEach((t=>t.hidden=!1))),document.querySelectorAll(".total-row").forEach((t=>{t.addEventListener("click",(function(){let t=this.dataset.group,e=document.querySelectorAll(`.group-${t}`),n=[...e].some((t=>"none"!==t.style.display));document.querySelectorAll(".child-row").forEach((t=>t.style.display="none")),n||e.forEach((t=>t.style.display=""))}))})),document.getElementById("searchBox").addEventListener("keyup",(function(){let t=this.value.toLowerCase().trim();if(document.getElementById("IMSINV").checked=!0,document.getElementById("IMSCN").checked=!0,document.getElementById("IMSDN").checked=!0,document.getElementById("IMSECOM").checked=!0,document.querySelectorAll(".child-row").forEach((t=>t.style.display="none")),document.querySelectorAll(".total-row").forEach((t=>t.style.display="")),document.querySelectorAll(".tradenm-col").forEach((t=>t.hidden=!0)),""===t){document.querySelectorAll(".stin-col").forEach((t=>t.hidden=!0));if(!0===document.getElementById("showTotals").checked)return}let e=new Set,n=new Set;document.querySelectorAll("#imstable tbody tr").forEach((s=>{let a=s.innerText.toLowerCase();if(s.classList.contains("total-row")){let n=s.dataset.group;a.includes(t)&&e.add(n)}if(s.classList.contains("child-row")){let e=s.className.match(/group-(\w+)/)[1];s.cells[10].innerText.toLowerCase().includes(t)&&n.add(e)}})),n.size>0?(document.querySelectorAll(".total-row").forEach((t=>t.style.display="none")),n.forEach((t=>{document.querySelectorAll(`.group-${t}`).forEach((t=>t.style.display=""))})),document.querySelectorAll(".tradenm-col").forEach((t=>t.hidden=!1)),document.querySelectorAll(".stin-col").forEach((t=>t.hidden=!1))):e.size>0?(document.querySelectorAll(".total-row").forEach((t=>{let n=t.dataset.group;e.has(n)?t.style.display="":t.style.display="none"})),document.querySelectorAll(".tradenm-col").forEach((t=>t.hidden=!0)),document.querySelectorAll(".stin-col").forEach((t=>t.hidden=!0))):document.querySelectorAll(".total-row, .child-row").forEach((t=>t.style.display="none"))}));const c=document.getElementById("imsfile");if(!c)return;c.addEventListener("change",(t=>{const e=t.target.files[0];if(!e)return;const n=new FileReader;n.onload=function(t){const e=new Uint8Array(t.target.result),n=XLSX.read(e,{type:"array"}),s="XLSDEAL-IMS";if(!n.Sheets[s])return void alert("Sheet XLSDEAL-IMS not found!");const a=n.Sheets[s],i=XLSX.utils.sheet_to_json(a,{header:1});if(!i.length)return;const o=["FRM","N/O","GSTIN","NAME OF CLIENT","POS","TYP","PERIOD","GSTR","Date","Invoice","Taxable","IGST","CGST","SGST","CESS","Amount","Action"],l=["Match/UnMatch","Previous Action","Jsonobj"];let r="<table class='result-tab' id=\"uploadTable\">\n                            <thead><tr>";o.forEach((t=>r+=`<th>${t}</th>`)),l.forEach((t=>r+=`<th>${t}</th>`)),r+="</tr></thead><tbody>";const d=i[0],c={};d.forEach(((t,e)=>c[t.trim()]=e));for(let t=1;t<i.length;t++){const e=i[t];r+="<tr>",o.forEach((t=>{const n=e[c[t]]||"";r+=`<td>${n}</td>`})),l.forEach((t=>r+="<td></td>")),r+="</tr>"}r+="</tbody></table>";const u=document.getElementById("uploadresponse");u&&(u.innerHTML=r,function(){const t=document.getElementById("uploadTable"),e=Array.from(t.tBodies[0]?.rows||[]),n=document.getElementById("imstable_org"),s=Array.from(n.tBodies[0]?.rows||[]),a=16,i=16,o=16,l=t=>(t||"").toString().replace(/\s+/g," ").replace(/,/g,"").trim();e.forEach((t=>{const e=t.cells[i],n=t.cells[i+1]||t.insertCell(i+1),r=t.cells[i+2]||t.insertCell(i+2),d=t.cells[i+3]||t.insertCell(i+3);n.textContent="",r.textContent="",d.textContent="",t.classList.remove("unmatch-row"),Array.from(t.cells).forEach((t=>{t.classList.remove("unmatch-cell","changed-cell")}));const c=Math.min(a,t.cells.length);let u=!1,m=null,g=1/0,y=null;for(const e of s){const n=Math.min(c,e.cells.length);let s=0;const a=new Array(n).fill(!1);for(let i=0;i<n;i++){l(t.cells[i]?.textContent)!==l(e.cells[i]?.textContent)&&(s++,a[i]=!0)}if(0===s){u=!0,m=e;break}s<g&&(g=s,y=a)}if(u&&m){n.textContent="Match";const t=e?.textContent||"",s=m.cells[o]?.textContent||"",a=l(t),i=l(s);r.textContent=s,a!==i?(d.textContent="Yes",e?.classList.add("changed-cell")):d.textContent="No"}else n.textContent="Error",t.classList.add("unmatch-row"),y&&y.forEach(((e,n)=>{e&&t.cells[n]?.classList.add("unmatch-cell")}))}))}())},n.readAsArrayBuffer(e)})),document.getElementById("imsupdate").addEventListener("click",(()=>{const t=document.getElementById("uploadTable");Array.from(t.tBodies[0]?.rows||[]).forEach((t=>{const e=t.cells[19],n=t.cells[17];(e&&"No"===e.textContent.trim()||"Error"===n.textContent.trim())&&t.remove()})),function(){const t=document.getElementById("uploadTable"),e=Array.from(t.tBodies[0]?.rows||[]),n={rtin:session.gstin,reqtyp:"SAVE",invdata:{b2b:[],b2bdn:[],b2bcn:[],ecom:[]}},s=t=>(t||"").toString().trim();e.forEach((t=>{const e=t.cells,a=s(e[0]?.textContent),i={stin:s(e[2]?.textContent),rtnprd:s(e[6]?.textContent),srcform:s(e[7]?.textContent||"R1"),inv_typ:s(e[5]?.textContent),pos:s(e[4]?.textContent),val:parseFloat(e[15]?.textContent)||0,txval:parseFloat(e[10]?.textContent)||0,iamt:parseFloat(e[11]?.textContent)||0,camt:parseFloat(e[12]?.textContent)||0,samt:parseFloat(e[13]?.textContent)||0,cess:parseFloat(e[14]?.textContent)||0,action:s(e[16]?.textContent),prev_status:s(e[18]?.textContent)};"b2b"===a?(i.inum=s(e[9]?.textContent),i.idt=s(e[8]?.textContent),n.invdata.b2b.push(i)):"dn"===a?(i.nt_num=s(e[9]?.textContent),i.nt_dt=s(e[8]?.textContent),n.invdata.b2bdn.push(i)):"cn"===a?(i.nt_num=s(e[9]?.textContent),i.nt_dt=s(e[8]?.textContent),n.invdata.b2bcn.push(i)):"ecom"===a&&(i.inum=s(e[9]?.textContent),i.idt=s(e[8]?.textContent),n.invdata.ecom.push(i))})),window.jsondatatoUpload=n,document.getElementById("syncimsbtn").disabled=!1,document.getElementById("imsupdate").disabled=!0}()}));const u=document.getElementById("syncimsbtn");u.addEventListener("click",(()=>{u.disabled=!0;document.getElementById("finYear").value.split("-")[0];const t=window.jsondatatoUpload;chrome.tabs.query({active:!0,currentWindow:!1},(e=>{const n=e[0];chrome.scripting.executeScript({target:{tabId:n.id},files:["contentscript.js"]},(()=>{chrome.tabs.sendMessage(n.id,{action:"imsSAVE",jdata:t},(t=>{t?t.success&&(document.getElementById("uploadTable").innerHTML="Date Updated Successfully! : [F5] Refresh to View the Result."):document.getElementById("uploadTable").innerHTML="No response Make sure you're on GST portal tab."}))}))}))}))}function view_allreports(t,e){window.actdiv="Details";const n=document.getElementById("result");function s(t,e,n=!1){return`<tr class="${n?"total-row":""}">\n        <td>${t}</td>${e.map((t=>{return`<td>${e=t,(e??0).toLocaleString("en-IN",{maximumFractionDigits:2})}</td>`;var e})).join("")}\n      </tr>`}function a(t,e,s,a){const i=document.createElement("section");i.className="myfirtable";const o=document.createElement("h2");o.textContent=t,i.appendChild(o);const l=document.createElement("table");l.id=a;const r=document.createElement("thead"),d=document.createElement("tbody"),c=document.createElement("tr");e.forEach((t=>{const e=document.createElement("th");e.textContent=t.label,t.rowspan&&e.setAttribute("rowspan",t.rowspan),t.span&&e.setAttribute("colspan",t.span),e.style.textAlign="center",c.appendChild(e)})),r.appendChild(c);const u=document.createElement("tr");return e.forEach((t=>{t.span&&(s.slice(0,t.span).forEach((t=>{const e=document.createElement("th");e.textContent=t,u.appendChild(e)})),s=s.slice(t.span))})),u.children.length>0&&r.appendChild(u),l.appendChild(r),l.appendChild(d),i.appendChild(l),n.appendChild(i),d}"Yes"==e?(n.innerHTML='<h4>GST Liability & Payments Analysis <button class="btn btn-outline-primary" style="border-radius:20px;" type="button" value="Details" id="Details"><i class="fa fa-pie-chart" aria-hidden="true"></i> Consolidate</button> <button id="exportBtn" class="btn btn-outline-primary" style="margin-left:100px;  border-radius:18px;"><i class="fa fa-file-excel-o" aria-hidden="true"></i>  Download</button></h4>',document.getElementById("exportBtn").onclick=function(t){const e=document.getElementById("finYearcl"),n=XLSX.utils.book_new();document.querySelectorAll(".myfirtable").forEach((t=>{const e=t.querySelector("table");if(e){const s=XLSX.utils.table_to_sheet(e);XLSX.utils.book_append_sheet(n,s,t.id.toUpperCase())}})),XLSX.writeFile(n,`FY${e.value}_ANALYSIS_REPORTS_${session.gstin}.xlsx`)}):n.innerHTML='<h4>GST Liability & Payments Analysis <button class="btn btn-outline-primary" style="border-radius:20px;" type="button" value="Details" id="Details"><i class="fa fa-pie-chart" aria-hidden="true"></i> Details</button></h4>',document.getElementById("Details").onclick=function(t){setTimeout((()=>{my_all_reports_fetch("Yes"==e?"no":"Yes")}),1e3)};const i=a("Table 1: Tax Liability",[{label:"Month",rowspan:2},{label:"Tax liability declared in GSTR-1/IFF/GSTR-1A",span:5},{label:"Tax liability declared in GSTR-3B {Reverse Charges}",span:5},{label:"Tax liability declared in (Export and SEZ)",span:5},{label:"Liability paid as per GSTR-3B",span:5},{label:"Shortfall (-)/ Excess (+) in liability",span:5}],Array(25).fill(0).map(((t,e)=>["IGST","CGST","SGST","CESS","Total"][e%5])),"table1"),o=t.tablea||[],l=t.tableb||[],r=t.tablecNew||[],d=t.tableg||[];let c=Array(25).fill(0);for(let t=0;t<Math.max(o.length,l.length)-1;t++){const e=o[t]||{},n=l[t]||{},a=r[t]||{},u=d[t]||{},m=[e.dec_liability?.iamt,e.dec_liability?.camt,e.dec_liability?.samt,e.dec_liability?.csamt,(e.dec_liability?.iamt||0)+(e.dec_liability?.camt||0)+(e.dec_liability?.samt||0)+(e.dec_liability?.csamt||0),n.dec_liability?.iamt,n.dec_liability?.camt,n.dec_liability?.samt,n.dec_liability?.csamt,(n.dec_liability?.iamt||0)+(n.dec_liability?.camt||0)+(n.dec_liability?.samt||0)+(n.dec_liability?.csamt||0),a.dec_liability?.iamt,a.dec_liability?.camt,a.dec_liability?.samt,a.dec_liability?.csamt,(a.dec_liability?.iamt||0)+(a.dec_liability?.camt||0)+(a.dec_liability?.samt||0)+(a.dec_liability?.csamt||0),u.dec_liability?.iamt,u.dec_liability?.camt,u.dec_liability?.samt,u.dec_liability?.csamt,(u.dec_liability?.iamt||0)+(u.dec_liability?.camt||0)+(u.dec_liability?.samt||0)+(u.dec_liability?.csamt||0),e.dec_liability?.iamt+n.dec_liability?.iamt+a.dec_liability?.iamt-u.dec_liability?.iamt||0,e.dec_liability?.camt+n.dec_liability?.camt-u.dec_liability?.camt||0,e.dec_liability?.samt+n.dec_liability?.samt-u.dec_liability?.samt||0,e.dec_liability?.csamt+n.dec_liability?.csamt+a.dec_liability?.csamt-u.dec_liability?.csamt||0,(e.dec_liability?.iamt||0)+(e.dec_liability?.camt||0)+(e.dec_liability?.samt||0)+(e.dec_liability?.csamt||0)+(n.dec_liability?.iamt||0)+(n.dec_liability?.camt||0)+(n.dec_liability?.samt||0)+(n.dec_liability?.csamt||0)+(a.dec_liability?.iamt||0)+(a.dec_liability?.camt||0)+(a.dec_liability?.samt||0)+(a.dec_liability?.csamt||0)-((u.dec_liability?.iamt||0)+(u.dec_liability?.camt||0)+(u.dec_liability?.samt||0)+(u.dec_liability?.csamt||0))||0];m.forEach(((t,e)=>c[e]+=t||0)),i.insertAdjacentHTML("beforeend",s(e.taxPeriod,m))}i.insertAdjacentHTML("beforeend",s("TOTAL",c,!0));const u=a("Table 2: Input Tax Credit",[{label:"Month",rowspan:2},{label:"ITC claimed in GSTR-3B excluding ITC Reversal",span:5},{label:"ITC auto-drafted in GSTR-2B",span:5},{label:"ITC IMPG, IMPG (SEZ)",span:5},{label:"Shortfall (-)/ Excess (+)",span:5}],Array(20).fill(0).map(((t,e)=>["IGST","CGST","SGST","CESS","Total"][e%5])),"table2"),m=t.tabled||[],g=t.tablee||[];let y=Array(20).fill(0);for(let t=0;t<Math.max(m.length,g.length)-1;t++){const e=m[t]||{},n=g[t]||{},a=[e.dec_liability?.iamt,e.dec_liability?.camt,e.dec_liability?.samt,e.dec_liability?.csamt,(e.dec_liability?.iamt||0)+(e.dec_liability?.camt||0)+(e.dec_liability?.samt||0)+(e.dec_liability?.csamt||0),e.actual_liability?.iamt,e.actual_liability?.camt,e.actual_liability?.samt,e.actual_liability?.csamt,(e.actual_liability?.iamt||0)+(e.actual_liability?.camt||0)+(e.actual_liability?.samt||0)+(e.actual_liability?.csamt||0),n.dec_liability?.iamt,n.dec_liability?.camt,n.dec_liability?.samt,n.dec_liability?.csamt,(n.dec_liability?.iamt||0)+(n.dec_liability?.camt||0)+(n.dec_liability?.samt||0)+(n.dec_liability?.csamt||0),e.dec_liability?.iamt-n.dec_liability?.iamt-e.actual_liability?.iamt||0,e.dec_liability?.camt-n.dec_liability?.camt-e.actual_liability?.camt||0,e.dec_liability?.samt-n.dec_liability?.samt-e.actual_liability?.samt||0,e.dec_liability?.csamt-n.dec_liability?.csamt-e.actual_liability?.csamt||0,e.dec_liability?.iamt-n.dec_liability?.iamt-e.actual_liability?.iamt+(e.dec_liability?.camt-n.dec_liability?.camt-e.actual_liability?.camt)+(e.dec_liability?.samt-n.dec_liability?.samt-e.actual_liability?.samt)+(e.dec_liability?.csamt-n.dec_liability?.csamt-e.actual_liability?.csamt)||0];a.forEach(((t,e)=>y[e]+=t||0)),u.insertAdjacentHTML("beforeend",s(e.taxPeriod,a))}u.insertAdjacentHTML("beforeend",s("TOTAL",y,!0));const p=a("Table 3: Reverse Charge & ITC",[{label:"Month",rowspan:2},{label:"ITC claimed on inward RCM supplies",span:5},{label:"Reverse charge liability declared",span:5},{label:"Shortfall (-)/ Excess (+) in ITC",span:5}],Array(15).fill(0).map(((t,e)=>["IGST","CGST","SGST","CESS","Total"][e%5])),"table3"),f=t.tablef||[],h=t.tablee||[];let b=Array(15).fill(0);for(let t=0;t<Math.max(f.length,h.length)-1;t++){const e=f[t]||{},n=(h[t],[e.dec_liability?.iamt,e.dec_liability?.camt,e.dec_liability?.samt,e.dec_liability?.csamt,(e.dec_liability?.iamt||0)+(e.dec_liability?.camt||0)+(e.dec_liability?.samt||0)+(e.dec_liability?.csamt||0),e.actual_liability?.iamt,e.actual_liability?.camt,e.actual_liability?.samt,e.actual_liability?.csamt,(e.actual_liability?.iamt||0)+(e.actual_liability?.camt||0)+(e.actual_liability?.samt||0)+(e.actual_liability?.csamt||0),e.dec_liability?.iamt-e.actual_liability?.iamt||0,e.dec_liability?.camt-e.actual_liability?.camt||0,e.dec_liability?.samt-e.actual_liability?.samt||0,e.dec_liability?.csamt-e.actual_liability?.csamt||0,e.dec_liability?.iamt-e.actual_liability?.iamt+(e.dec_liability?.camt-e.actual_liability?.camt)+(e.dec_liability?.samt-e.actual_liability?.samt)+(e.dec_liability?.csamt-e.actual_liability?.csamt)||0]);n.forEach(((t,e)=>b[e]+=t||0)),p.insertAdjacentHTML("beforeend",s(e.taxPeriod,n))}p.insertAdjacentHTML("beforeend",s("TOTAL",b,!0)),"no"===e&&(keepOnlyTotals("table1"),keepOnlyTotals("table2"),keepOnlyTotals("table3"))}function keepOnlyTotals(t="table1"){const e=document.getElementById(t);if(!e||!e.tHead||e.tHead.rows.length<2)return;const n=e.tHead.rows[0],s=e.tHead.rows[1],a=new Set(["IGST","CGST","SGST","CESS"]),i=[];for(let t=0;t<s.cells.length;t++){const e=s.cells[t].textContent.trim().toUpperCase();a.has(e)?(i.push(t+1),s.cells[t].style.display="none"):(s.cells[t].textContent="GST Total",s.cells[t].style.Width="200px")}Array.from(e.tBodies).forEach((t=>{Array.from(t.rows).forEach((t=>{i.forEach((e=>{t.cells[e]&&(t.cells[e].style.display="none")}))}))})),Array.from(n.cells).forEach((t=>{t.colSpan>1&&(t.colSpan=1)}))}async function club_gstr2b_view(){intoReturn2BPage();const t=document.getElementById("finYear"),e=document.getElementById("result");if(e.innerHTML="Please Wait....<i class='fa fa-spinner fa-pulse fa-3x fa-fw'></i>","Prime"===window.userStatusNow)var n=generateFYMonths(t.value);else{n=generateFYMonths_3monts(t.value);alert("Clubed Only for [Apr, May & Jun] three Months \n \nPrime User will get Full Year Access.")}chrome.tabs.query({active:!0,currentWindow:!1},(t=>{const s=t[0];chrome.scripting.executeScript({target:{tabId:s.id},files:["contentscript.js"]},(()=>{chrome.tabs.sendMessage(s.id,{action:"gstr2ballmonths",rtnprds:n},(t=>{t?(clubeview_r2b_allTable(t.allResults),t.allResults.forEach((t=>{}))):e.innerHTML="<b style='color:red'>❌ Not Fetched</b>"}))}))}))}async function club_gstr2a_view(){const t=document.getElementById("finYear"),e=document.getElementById("result");if(e.innerHTML="Please Wait....<i class='fa fa-spinner fa-pulse fa-3x fa-fw'></i>","Prime"===window.userStatusNow)var n=generateFYMonths(t.value);else{n=generateFYMonths_3monts(t.value);alert("Clubed Only for [Apr, May & Jun] three Months \n \nPrime User will get Full Year Access.")}chrome.tabs.query({active:!0,currentWindow:!1},(t=>{const s=t[0];chrome.scripting.executeScript({target:{tabId:s.id},files:["contentscript.js"]},(()=>{chrome.tabs.sendMessage(s.id,{action:"gstr2aallmonths",rtnprds:n},(t=>{t?(console.log(t.allResults),t.allResults.forEach((t=>{}))):e.innerHTML="<b style='color:red'>❌ Not Fetched</b>"}))}))}))}function generateFYMonths(t){const[e,n]=t.split("-"),s=parseInt(e,10),a=parseInt("20"+n,10),i=[];for(let t=4;t<=12;t++)i.push(t.toString().padStart(2,"0")+s);for(let t=1;t<=3;t++)i.push(t.toString().padStart(2,"0")+a);return i}function generateFYMonths_3monts(t){const[e,n]=t.split("-"),s=parseInt(e,10),a=(parseInt("20"+n,10),[]);for(let t=4;t<=6;t++)a.push(t.toString().padStart(2,"0")+s);return a}async function load2ballTable(t){let e=[],n=[],s=1;t.forEach((t=>{const a=t.fy,i=t.data.gstin||"",o=t?.data?.data?.docdata||[];o.b2b&&o.b2b.forEach((t=>{t.ctin&&!n.includes(t.ctin)&&n.push(t.ctin),t.inv.forEach((n=>{e.push({sl:s++,fy:a,from:"b2b",ctin:t.ctin,trdnm:t.trdnm,dt:n.dt,inum:n.inum,txval:n?.txval||n?.items?.[0]?.txval,val:n.val,itcavl:n.itcavl,gstin_status:i,dataof_cancel:""})}))})),o.ecom&&o.ecom.forEach((t=>{t.ctin&&!n.includes(t.ctin)&&n.push(t.ctin),t.inv.forEach((n=>{e.push({sl:s++,fy:a,from:"ecom",ctin:t.ctin,trdnm:t.trdnm,dt:n.dt,inum:n.inum,txval:n?.txval||n?.items?.[0]?.txval,val:n.val,itcavl:n.itcavl,gstin_status:i,dataof_cancel:""})}))})),o.cdnr&&o.cdnr.forEach((t=>{t.ctin&&!n.includes(t.ctin)&&n.push(t.ctin),t.nt.forEach((n=>{e.push({sl:s++,fy:a,from:"cdnr",ctin:t.ctin,trdnm:t.trdnm,dt:n.dt,inum:n.ntnum,txval:n?.txval||n?.items?.[0]?.txval,val:n.val,itcavl:n.itcavl,gstin_status:i,dataof_cancel:""})}))}))}));let a='<h4>Vendor\'s Cancelled GSTIN Impact: </h4><table class="result-tab" id="totaal2b_8a" style="font-size:10px;">\n    <thead>\n      <tr>\n        <th>SL</th><th>FY</th><th>BY</th><th>GSTIN</th><th>NAME OF VENDOR</th>\n        <th>DATE</th><th>INVOICE/NOTES NO</th><th>TAX VALUE</th><th>AMOUNT</th>\n        <th>ITC</th><th>GSTIN STATUS</th><th>CANCEL DATE</th>\n      </tr>\n    </thead>\n    <tbody>';e.forEach((t=>{if("cdnr"===t.from)var e="-";else e="";a+=`<tr>\n      <td>${t.sl}</td>\n      <td>${t.fy}</td>\n      <td style="text-align:left;">${t.from}</td>\n      <td style="text-align:left;">${t.ctin}</td>\n      <td style="text-align:left;">${t.trdnm}</td>\n      <td>${t.dt}</td>\n      <td style="text-align:left;">${t.inum}</td>\n      <td>${e}${t.txval}</td>\n      <td>${e}${t.val}</td>\n      <td>${t.itcavl}</td>\n      <td style="text-align:left;">${t.gstin_status}</td>\n      <td>${t.dataof_cancel}</td>\n    </tr>`})),a+="</tbody></table>",document.getElementById("result").innerHTML=a,document.getElementById("result").style.height="80%",document.getElementById("returnStatus").style.display="none",document.getElementById("getallgstr2BBtn").innerHTML="Please Wait...<i class='fa fa-spinner fa-pulse fa-3x fa-fw' aria-hidden='true'></i>",await intodeshboadPage();const i={},o={};function l(t){if(!t)return null;let e;if(t.includes("-"))e=t.split("-");else{if(!t.includes("/"))return null;e=t.split("/")}return new Date(e[2],e[1]-1,e[0])}setTimeout((()=>{chrome.tabs.query({active:!0,currentWindow:!1},(t=>{const e=t[0];chrome.scripting.executeScript({target:{tabId:e.id},files:["contentscript.js"]},(()=>{chrome.tabs.sendMessage(e.id,{action:"fetchGSTIN",gstins:n},(t=>{if(!t)return void console.log("not fetched");t.results.forEach((t=>{i[t.gstin]=t.status,o[t.gstin]=t.canceldt||""}));const e=document.getElementById("totaal2b_8a");if(e){for(let t=1;t<e.rows.length;t++){const n=e.rows[t],s=n.cells[3]?.innerText.trim();n.cells[10].innerText=i[s],n.cells[11].innerText=o[s],l(n.cells[5].innerText)>=l(o[s])&&(n.style.background="red")}for(let t=e.rows.length-1;t>0;t--){const n=e.rows[t],s=n.cells[10]?.innerText.trim();"Active"===s&&e.deleteRow(t)}document.getElementById("getallgstr2BBtnDownload").style.display="",document.getElementById("getallgstr2BBtn").innerHTML='<i class="fa fa-sitemap" aria-hidden="true"></i>  VIEW Cancelled'}}))}))}))}),1e3)}async function clubeview_r2b_allTable(t){let e=[],n=[],s=1;t.forEach((t=>{const a=t.fy,i=(t.data.gstin,t?.data?.data?.docdata||[]);i.b2b&&i.b2b.forEach((t=>{t.ctin&&!n.includes(t.ctin)&&n.push(t.ctin),t.inv.forEach((n=>{e.push({sl:s++,fy:a,from:"b2b",ctin:t.ctin,trdnm:t.trdnm,dt:n.dt,inum:n.inum,txval:n?.txval||n?.items?.[0]?.txval,igst:n?.igst||n?.items?.[0]?.igst||0,cgst:n?.cgst||n?.items?.[0]?.cgst||0,sgst:n?.sgst||n?.items?.[0]?.sgst||0,cess:n?.cess||n?.items?.[0]?.cess||0,val:n.val,itcavl:n.itcavl})}))})),i.ecom&&i.ecom.forEach((t=>{t.ctin&&!n.includes(t.ctin)&&n.push(t.ctin),t.inv.forEach((n=>{e.push({sl:s++,fy:a,from:"ecom",ctin:t.ctin,trdnm:t.trdnm,dt:n.dt,inum:n.inum,txval:n?.txval||n?.items?.[0]?.txval,igst:n?.igst||n?.items?.[0]?.igst||0,cgst:n?.cgst||n?.items?.[0]?.cgst||0,sgst:n?.sgst||n?.items?.[0]?.sgst||0,cess:n?.cess||n?.items?.[0]?.cess||0,val:n.val,itcavl:n.itcavl})}))})),i.cdnr&&i.cdnr.forEach((t=>{t.ctin&&!n.includes(t.ctin)&&n.push(t.ctin),t.nt.forEach((n=>{e.push({sl:s++,fy:a,from:"cdnr",ctin:t.ctin,trdnm:t.trdnm,dt:n.dt,inum:n.ntnum,txval:n?.txval||n?.items?.[0]?.txval,igst:n?.igst||n?.items?.[0]?.igst||0,cgst:n?.cgst||n?.items?.[0]?.cgst||0,sgst:n?.sgst||n?.items?.[0]?.sgst||0,cess:n?.cess||n?.items?.[0]?.cess||0,val:n.val,itcavl:n.itcavl})}))}))}));let a='<h4>YEARLY GSTR2B CLUBED VIEW: <Button id="downExgstr2bclubtn" class="btn btn-outline-primary"><i class="fa fa-file-excel-o" aria-hidden="true"></i> Download</button><button id="gstinwise_Gstr2B_club" class="btn btn-outline-info">Club GSTIN Wise</button></h4>\n  <table class="result-tab" id="clubed_totaal2b" style="font-size:10px;">\n    <thead>\n      <tr>\n        <th>SL</th><th>FY</th><th>BY</th><th>GSTIN</th><th>NAME OF VENDOR</th>\n        <th>DATE</th><th>INVOICE/NOTES NO</th><th>TAX VALUE</th><th>IGST</th><th>CGST</th><th>SGST</th><th>CESS</th><th>AMOUNT</th>\n        <th>ITC</th>\n      </tr>\n    </thead>\n    <tbody>';var i=0,o=0,l=0,r=0,d=0,c=0;e.forEach((t=>{if("cdnr"===t.from){var e="-";i-=t.txval,o-=t.igst,l-=t.cgst,r-=t.sgst,d-=t.cess,c-=t.val}else e="",i+=t.txval,o+=t.igst,l+=t.cgst,r+=t.sgst,d+=t.cess,c+=t.val;a+=`<tr>\n      <td>${t.sl}</td>\n      <td>${t.fy}</td>\n      <td style="text-align:left;">${t.from}</td>\n      <td style="text-align:left;">${t.ctin}</td>\n      <td style="text-align:left;">${t.trdnm}</td>\n      <td>${t.dt}</td>\n      <td style="text-align:left;">${t.inum}</td>\n      <td>${e}${t.txval}</td>\n      <td>${e}${t.igst}</td>\n    <td>${e}${t.cgst}</td>\n    <td>${e}${t.sgst}</td>\n    <td>${e}${t.cess}</td>\n      <td>${e}${t.val}</td>\n      <td>${t.itcavl}</td>\n      \n    </tr>`})),a+=`<tr>\n      <td></td>\n      <td></td>\n      <td style="text-align:left;"></td>\n      <td style="text-align:left;"></td>\n      <td style="text-align:left;">Total:</td>\n      <td></td>\n      <td style="text-align:left;"></td>\n      <td>${i.toFixed()}</td>\n      <td>${o.toFixed()}</td>\n    <td>${l.toFixed()}</td>\n    <td>${r.toFixed()}</td>\n    <td>${d.toFixed()}</td>\n      <td>${c.toFixed()}</td>\n      <td></td>\n      </tr>`,a+="</tbody></table>",document.getElementById("result").innerHTML=a,document.getElementById("result").style.height="80%",document.getElementById("returnStatus").style.display="none",document.getElementById("downExgstr2bclubtn").addEventListener("click",(()=>{const t=XLSX.utils.book_new(),e=document.getElementById("clubed_totaal2b");if(e){let n=XLSX.utils.table_to_sheet(e,{raw:!0});Object.keys(n).forEach((t=>{if("!"===t[0])return;const s=parseInt(t.replace(/[^0-9]/g,""))-1,a=t.replace(/[0-9]/g,"").charCodeAt(0)-65,i=e.rows[s]?.cells[a];if(i){const e=i.innerText.trim();n[t].t="s",n[t].v=e,n[t].w=e}})),XLSX.utils.book_append_sheet(t,n,"XLSDEAL-GSTR2B-YR")}XLSX.writeFile(t,`GSTR2B_YEARLY_${session.gstin}.xlsx`)})),document.getElementById("gstinwise_Gstr2B_club").addEventListener("click",(()=>{let t=document.getElementById("clubed_totaal2b"),e=Array.from(t.querySelectorAll("tbody tr")),n={};e.forEach((t=>{let e=t.querySelectorAll("td"),s=e[3].innerText.trim();n[s]||(n[s]={tax:0,igst:0,cgst:0,sgst:0,cess:0,amount:0,firstRow:t}),n[s].tax+=parseFloat(e[7].innerText)||0,n[s].igst+=parseFloat(e[8].innerText)||0,n[s].cgst+=parseFloat(e[9].innerText)||0,n[s].sgst+=parseFloat(e[10].innerText)||0,n[s].cess+=parseFloat(e[11].innerText)||0,n[s].amount+=parseFloat(e[12].innerText)||0,n[s].firstRow!==t&&t.remove()}));var s=0;for(let t in n){s+=1;let e=n[t].firstRow.querySelectorAll("td");e[0].innerText=s,e[1].innerText="",e[2].innerText="",e[5].innerText="",e[6].innerText="",e[13].innerText="",e[7].innerText=n[t].tax.toFixed(2),e[8].innerText=n[t].igst.toFixed(2),e[9].innerText=n[t].cgst.toFixed(2),e[10].innerText=n[t].sgst.toFixed(2),e[11].innerText=n[t].cess.toFixed(2),e[12].innerText=n[t].amount.toFixed(2)}}))}function GSTINS_List_ToJSON(){const t=document.getElementById("gstinSearchResult"),e=Array.from(t.querySelectorAll("thead th")).map((t=>t.innerText.trim())),n=Array.from(t.querySelectorAll("tbody tr")).map((t=>{const n=Array.from(t.querySelectorAll("td"));if(!n[2]||""===n[2].innerText.trim())return null;let s={};return e.forEach(((t,e)=>{"SL"!==t&&(s[t]=n[e]?n[e].innerText.trim():"")})),s})).filter((t=>null!==t));JSON.stringify(n,null,2);var s=document.getElementById("finYearcl").value;uploadJsonFile(session.gstin,"GSTIN",s,n)}function openWhatsAppSmart(){const t=Date.now();setTimeout((()=>{var e=document.getElementById("businessGSTIN")?.innerText||"",n=document.getElementById("businessName")?.innerText||"";if("GSTIN"!==e)var s=`Radhe Radhe!! \n My ${e} | ${n} \n I have a Query.`;else s="Radhe Radhe!! \n A new user of your GSTR-N Chrome Extension \n Thank You.";const a=`https://web.whatsapp.com/send?phone=919038129731&text=${encodeURIComponent(s)}`;Date.now()-t<3e3&&window.open(a,"_blank")}),200)}function showpopup(){document.getElementById("popup-content").innerHTML='<h4>Please Upgrade <span style="color:blue">'+session.gstin+'</span> to Prime user! \n<b>Rs.100/Annual</b> for Full Access.</h4>  <div style="text-align: center; margin-top: 20px;"><a href="https://xlsdeal.com/donation.html" target="_blank" style="background: #4a148c; color: #fff; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-size: 16px; font-weight: bold; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: 0.3s;"> 🌸 Support Me 🌸<img src="https://xlsdeal.com/chrome_extension/phpay.jpg" height="320px">🌸 Thank You 🌸</a> <h4 style="color:#4a148c"><i class="fa fa-whatsapp" aria-hidden="true"></i> Send Your GSTIN to 9038129731 | With Payment Confirmation!</h4><hr><h5 style="color:grey">For CA/Consultants <i class="fa fa-info-circle blink" aria-hidden="true"></i> Offer Price | [ Rs.1,000/(30 Days) or Rs.10,000/(365 Days) ] for Unlimited GSTINs Access.</h5>  </div>  ';const t=document.getElementById("popup");t.classList.add("show"),t.onclick=function(e){e.target===t&&t.classList.remove("show")}}document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("ims"),e=document.getElementById("imsinward"),n=document.getElementById("imsoutward"),s=document.getElementById("result");t.addEventListener("click",(()=>{s.innerHTML="Please Wait... <i class='fa fa-spinner fa-pulse fa-3x fa-fw' aria-hidden='true'></i>";populateMonths(document.getElementById("finYear").value),chrome.tabs.query({active:!0,currentWindow:!1},(t=>{if(!t[0].url.startsWith("https://return.gst.gov.in/"))return s.textContent="Please [F5] Refresh!",void intoReturnPage();window.actdiv="ims",document.getElementById("ims-penal").style.display="",document.getElementById("returnStatus").style.display="none",document.getElementById("result").innerHTML=""}))})),e.addEventListener("click",(()=>{s.innerHTML="Please Wait... <i class='fa fa-spinner fa-pulse fa-3x fa-fw' aria-hidden='true'></i> (If Missing something Please re-click.)",chrome.tabs.query({active:!0,currentWindow:!1},(t=>{const e=t[0];chrome.scripting.executeScript({target:{tabId:e.id},files:["contentscript.js"]},(()=>{const t=["B2B","CN","DN","ECOM","B2BA","CNA","DNA","ECOMA"];let n={},s=0;t.forEach((a=>{chrome.tabs.sendMessage(e.id,{action:"imsinward",gstin:session.gstin,section:a},(e=>{if(s++,e&&e.success?n[a]=e.data:n[a]={error:e?.error||"No response"},s===t.length){AllGroupedTable(flattenGSTData({b2b:(0!==n.B2B?.status?n.B2B?.data?.b2b:[])||[],cn:(0!==n.CN?.status?n.CN?.data?.b2bcn:[])||[],dn:(0!==n.DN?.status?n.DN?.data?.b2bdn:[])||[],ecom:(0!==n.ECOM?.status?n.ECOM?.data?.ecom:[])||[],b2ba:(0!==n.B2BA?.status?n.B2BA?.data?.b2ba:[])||[],cna:(0!==n.CNA?.status?n.CNA?.data?.b2bcna:[])||[],dna:(0!==n.DNA?.status?n.DNA?.data?.b2bdna:[])||[],ecoma:(0!==n.ECOMA?.status?n.ECOMA?.data?.ecoma:[])||[]}))}}))}))}))}))})),n.addEventListener("click",(()=>{s.innerHTML="Please Wait... <i class='fa fa-spinner fa-pulse fa-3x fa-fw' aria-hidden='true'></i>  (If data Incomplete Please re-click. [Outward] Button.)";var t=document.getElementById("monthSelect").value;chrome.tabs.query({active:!0,currentWindow:!1},(e=>{const n=e[0];chrome.scripting.executeScript({target:{tabId:n.id},files:["contentscript.js"]},(()=>{const e=["B2B","CN"];let s={},a=0;e.forEach((i=>{chrome.tabs.sendMessage(n.id,{action:"imsoutward",gstin:session.gstin,section:i,period:t},(t=>{if(a++,t&&t.success?s[i]=t.data:s[i]={error:t?.error||"No response"},a===e.length){AllGroupedTableoutward(flattenGSTData({b2b:(0!==s.B2B?.status?s.B2B?.data?.b2b:[])||[],cn:(0!==s.CN?.status?s.CN?.data?.cdn:[])||[]}))}}))}))}))}))}))})),document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("NoticeViewBtn"),e=document.getElementById("downExlNotices"),n=document.getElementById("result");function s(t){if(!t)return"";let e=new Date(t);return("0"+e.getDate()).slice(-2)+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+e.getFullYear()}function a(){const t=document.querySelector("#notces-details"),e=[...t.querySelectorAll("thead th")].map((t=>t.innerText.trim())),n=[...t.querySelectorAll("tbody tr")].map((t=>{const n=[...t.querySelectorAll("td")].map((t=>t.innerText.trim())),s={};return e.forEach(((t,e)=>s[t]=n[e]||"")),s})),s={};n.forEach((t=>{s[t.ARN]||(s[t.ARN]=[]),s[t.ARN].push(t)})),Object.values(s).forEach((t=>{const e=t.find((t=>t["ARN.DATE"]))?.["ARN.DATE"]||"",n=t.find((t=>t.FY))?.FY||"";t.forEach((t=>{t["ARN.DATE"]||(t["ARN.DATE"]=e),t.FY||(t.FY=n)}))}));const a=Object.entries(s).sort(((t,e)=>{const n=t=>{const e=t.map((t=>t["REF.DATE"])).filter((t=>t&&!isNaN(Date.parse(t))));return e.length?new Date(e.sort()[0]):new Date("1900-01-01")};return n(t[1])-n(e[1])}));let i=`\n      <table class="result-tab1" style="border-collapse:collapse; width:100%; font-size:12px;" id="allNoticesTable">\n        <thead>\n          <tr style="background:#22246f; color:white;">\n            ${e.map(((t,e)=>{let n="";return 0!==e&&11!==e||(n="width:40px;"),1!==e&&3!==e&&4!==e&&6!==e&&7!==e&&8!==e||(n="width:80px; white-space:nowrap;"),2!==e&&5!==e||(n="width:130px; white-space:nowrap;"),9===e&&(n="width:850px; text-overflow:ellipsis;"),10===e&&(n="width:60px;"),`<th style="${n}">${t}</th>`})).join("")}\n            <th style="width:20px;">no</th>\n          </tr>\n        </thead>\n        <tbody>\n    `,l=1;function r(t){return Array.isArray(t)?t.map((t=>r(t))).filter((t=>null!==t&&""!==t&&!("object"==typeof t&&0===Object.keys(t).length))):"object"==typeof t&&null!==t?(Object.keys(t).forEach((e=>{t[e]=r(t[e]),(null===t[e]||""===t[e]||"object"==typeof t[e]&&0===Object.keys(t[e]).length)&&delete t[e]})),t):t}a.forEach((([t,n])=>{const s=n[0];i+=`<tr class="parent" data-arn="${t}" style="background: #4c5d85;cursor:pointer;font-weight:bold;color: #ffc107;">`,e.forEach(((t,n)=>{let a="SL"===t?l++:s[t]||"";n===e.length-1&&a?i+="<td></td>":i+=`<td>${a}</td>`})),i+=`<td>${n.length}</td></tr>`,n.forEach(((n,s)=>{i+=`<tr class="child child-${t}" style="background:#eee;display:none; font-style:italic;">`,e.forEach(((t,a)=>{let o="SL"===t?s+1:n[t]||"";a===e.length-1&&o?i+=`<td><a href="#" class="view-json" data-json='${o.replace(/'/g,"&apos;")}'><b><i class="fa fa-eye fa-3x" aria-hidden="true"></i><b></a></td>`:i+=`<td>${o}</td>`})),i+="<td></td></tr>"}))})),i+="</tbody></table>",document.getElementById("result").innerHTML=i,document.querySelectorAll(".view-json").forEach((t=>{t.addEventListener("click",(function(t){t.preventDefault();let e=this.dataset.json;try{let t=JSON.parse(e);t=r(t),t=function(t,e){const n=new Set(e.map((t=>t.toLowerCase())));function s(t){if(!t||"object"!=typeof t)return t;if(Array.isArray(t)){for(let e=0;e<t.length;e++)s(t[e]);return t}for(const e of Object.keys(t))n.has(e.toLowerCase())?delete t[e]:s(t[e]);return t}return s(t)}(t,["suppdocs","maindocs","dcupdtls","docupdtl"]),document.getElementById("popup-content").innerHTML=o(t),document.getElementById("popup").classList.add("show")}catch(t){alert("Invalid JSON")}}))})),document.getElementById("popup").addEventListener("click",(function(t){"popup"===t.target.id&&document.getElementById("popup").classList.remove("show")})),document.querySelectorAll(".parent").forEach((t=>{t.addEventListener("click",(()=>{const e=t.dataset.arn,n=document.querySelectorAll(`.child-${e}`),s=[...n].some((t=>"table-row"===t.style.display));document.querySelectorAll(".child").forEach((t=>t.style.display="none")),s||n.forEach((t=>t.style.display="table-row"))}))}))}function i(t,e,n){chrome.tabs.query({active:!0,currentWindow:!1},(s=>{const i=s[0];chrome.tabs.sendMessage(i.id,{action:"getNoticesFolders",gstin:session.gstin,cId:t,ctyp:e},(t=>{t?t.success&&(document.getElementById("notces-details-body").innerHTML="",t.data.filter((t=>["INTIM","NOTCE","REPLY","ORDRS","CLOSR"].includes(t.caseFolderTypeCd))).forEach((t=>{chrome.tabs.query({active:!0,currentWindow:!1},(e=>{const s=e[0];chrome.tabs.sendMessage(s.id,{action:"getNoticesItems",fId:t.caseFolderId},(e=>{if(e){if(e.success&&e.data&&e.data.length>0){const s=e.data[0];s.itemJson&&s.itemJson,s.insertDate&&s.insertDate,s.refId&&s.refId;!function(t,e,n){const s=document.getElementById("notces-details").querySelector("tbody");let a=s.rows.length;t.forEach(((t,i)=>{let o=t.itemJson||"{}",l={};try{l=JSON.parse(o)}catch(t){console.warn("Invalid JSON in itemJson:",t)}const r=s.insertRow();r.insertCell(0).textContent=a+i+1,r.insertCell(1).textContent=l?.arndt||l?.vp?.paymentdate||l?.dof||"",r.insertCell(2).textContent=e||t?.arn||l?.arn||"",r.insertCell(3).textContent=n||"",r.insertCell(4).textContent=l?.sdtls?.srscn?.fy||l?.sdtls?.dtscn?.fy||l?.sdtls?.adjrn?.fy||l?.sdtls?.dtorder?.fy||l?.reply?.fy||l?.sdtls?.remnd?.fy||l?.sdtls?.drprcdt?.fy||l?.sdtls?.rorect?.fy||l?.vp?.fy||l?.fy||"",r.insertCell(5).textContent=t?.refId||l?.refId||"",r.insertCell(6).textContent=l?.refdt||l?.reply?.intdt||l?.reply?.ntcdt||"",r.insertCell(7).textContent=l?.sdtls?.dtscn?.replyDuedt||l?.sdtls?.dtscn?.duedt||l?.sdtls?.adjrn?.duedt||l?.sdtls?.rorect?.duedt||l?.sdtls?.dtorder?.duedt||l?.sdtls?.remnd?.duedt||"",r.insertCell(8).textContent=l?.sdtls?.dtscn?.pymtDuedt||"",r.insertCell(9).textContent=function(t){const e=document.getElementById("list-notices");if(e.style.display="none",!e)return null;for(let n=0;n<e.rows.length;n++){const s=e.rows[n],a=s.cells[3];if(a&&a.innerText.trim()===t){const t=s.cells[8];return t?t.innerText.trim():null}}return null}(t?.refId||l?.refId||"")||"";const d=r.insertCell(10);d.textContent=JSON.stringify(l),d.style.display="none"}))}(e.data,n,t.caseFolderTypeName)}}else console.log(`❌ Not Run for ${t.caseFolderTypeName} (ID: ${n})`)}))}))})),setTimeout((()=>{a()}),1e3)):console.log("Not Run!")}))}))}function o(t){let e="<table border='1' cellspacing='0' cellpadding='5' style='border-collapse:collapse; width:100%'>";for(let n in t)"object"==typeof t[n]&&null!==t[n]?e+=`<tr><td><b>${n}</b></td><td>${o(t[n])}</td></tr>`:e+=`<tr><td><b>${n}</b></td><td>${t[n]}</td></tr>`;return e+="</table>",e}t.addEventListener("click",(()=>{chrome.tabs.query({active:!0,currentWindow:!1},(t=>{const e=t[0];chrome.scripting.executeScript({target:{tabId:e.id},files:["contentscript.js"]},(()=>{chrome.tabs.sendMessage(e.id,{action:"getNotices",gstin:session.gstin},(t=>{t?t.success&&(n.innerHTML="",function(t){let e={};t.forEach((t=>{e[t.arn]||(e[t.arn]=[]),e[t.arn].push(t)})),Object.values(e).forEach((t=>{t.sort(((t,e)=>t.assignmentDt-e.assignmentDt))}));let n='\n    <table id="list-notices" border="1" cellspacing="0" cellpadding="5" style="border-collapse:collapse;width:100%" hidden>\n      <thead>\n        <tr style="background:#eee">\n          <th>SL</th>\n          <th>Date</th>\n          <th>ARN</th>\n          <th>Ref ID</th>\n          \n          <th style="display:none">caseTaskId</th>\n          <th style="display:none">caseTpeCd</th>\n          <th style="display:none">caseId</th>\n          <th style="display:none">status</th>\n          <th >Description</th>\n          <th style="display:none">caseTypeName</th>\n          <th>Notices</th>\n          <th>Replay</th>\n          <th>Order</th>\n        </tr>\n      </thead>\n      <tbody>\n    ',a=1;for(let t in e){let o=e[t],l=o[0];n+=`\n          <tr class="arn-row1" data-arn1="${t}" style="cursor:pointer;background:pink;">\n            <td>${a++}</td>\n            <td>${s(l.assignmentDt)}</td>\n          <td>${t}</td>\n            <td>${l.refId}</td>\n            \n            <td style="display:none">${l.caseTaskId}</td>\n            <td style="display:none">${l.caseTpeCd}</td>\n            <td style="display:none">${l.caseId}</td>\n            <td style="display:none">${l.status}</td>\n            <td >${l.taskDesc}</td>\n            <td style="display:none">${l.caseTypeName}</td>\n            <td></td>\n            <td></td>\n            <td></td>\n          </tr>\n        `,i(l.caseId,l.caseTpeCd,l.arn),o.forEach(((e,a)=>{n+=`\n              <tr class="child-row child1-${t}" data-child1="${e.refId}" style="display:none;background:#fff">\n                <td>${a+1}</td>\n                <td>${s(e.assignmentDt)}</td>\n              <td>${e.arn}</td>\n                <td >${e.refId}</td>\n                \n                <td style="display:none">${e.caseTaskId}</td>\n                <td style="display:none">${e.caseTpeCd}</td>\n                <td style="display:none">${e.caseId}</td>\n                <td style="display:none">${e.status}</td>\n                <td style="display:">${e.taskDesc}</td>\n                <td style="display:none">${e.caseTypeName}</td>\n                <td></td>\n                <td></td>\n                <td></td>\n              </tr>\n            `}))}n+="</tbody></table>",document.getElementById("result").innerHTML=n,maximizerfn(),document.querySelectorAll(".arn-row").forEach((t=>{t.addEventListener("click",(()=>{let e=t.dataset.arn;document.querySelectorAll(".child-"+e).forEach((t=>{t.style.display="none"===t.style.display?"table-row":"none"}))}))})),document.querySelectorAll(".noticeBtn").forEach((t=>{t.addEventListener("click",(function(){const t=this.getAttribute("data-arn");try{JSON.parse(t);!function(t){const e=JSON.parse(t),n=Array.isArray(e)?e:[e];console(n);const s=Object.keys(n[0]);let a='<table border="1" cellspacing="0" cellpadding="5" style="border-collapse:collapse;width:100%">';a+="<thead><tr>",s.forEach((t=>a+=`<th>${t}</th>`)),a+="</tr></thead><tbody>",n.forEach((t=>{a+="<tr>",s.forEach((e=>{let n="object"==typeof t[e]&&null!==t[e]?JSON.stringify(t[e]):t[e];a+=`<td>${n??""}</td>`})),a+="</tr>"})),a+="</tbody></table>"}(t),document.getElementById("popupNotice").style.display="block"}catch(t){console.error("Invalid JSON in data-arn:",t)}}))}))}(t.data)):n.innerHTML="No response Make sure you're on GST portal tab."}))}))}))})),e.addEventListener("click",(()=>{const t=XLSX.utils.book_new();document.getElementById("allNoticesTable");const e=document.getElementById("allNoticesTable");if(e){const n=XLSX.utils.table_to_sheet(e);XLSX.utils.book_append_sheet(t,n,"NOTICES")}XLSX.writeFile(t,`Notices_List_${session.gstin}.xlsx`)}))})),document.addEventListener("DOMContentLoaded",(()=>{var t=document.getElementById("mygstinslist"),e=document.getElementById("withAddress"),n=document.getElementById("basicInfo"),s=document.getElementById("withFilling"),a=document.getElementById("finYearcl").value;function i(t){const e=t.results;if(!e||0===e.length)return"No data available";document.getElementById("mygstinslist").style.display="none",document.getElementById("downExlgstinsStatusbtn").style.display="",document.getElementById("result").style.height="75%";let n='<h4>Search Result</h4>\n        <table id="gstinSearchResult" class="result-tab" style="width:100%">\n      <thead>\n        <tr>\n          <th>SL</th>\n          <th>GSTIN</th>\n          <th>TRADE_NAME</th>\n          <th>LEGAL_NAME</th>\n          <th>DATE_OF_REG</th>\n          <th>STATUS</th>\n          <th>CANCEL_DATE</th>\n          <th>NATURE</th>\n          <th>TYPES</th>\n          <th>ADDRESS</th>\n        </tr>\n      </thead>\n      <tbody>\n  ';return e.forEach(((t,e)=>{const s=t.status.toLowerCase().includes("cancelled")?"cancelled":"";"Prime"===window.userStatusNow?n+=`\n      <tr class="${s}">\n        <td>${e+1}</td>\n        <td style="text-align:left;">${t.gstin}</td>\n        <td style="text-align:left;">${t.tradeName}</td>\n        <td style="text-align:left;">${t.legalName}</td>\n        <td>${t.regDate}</td>\n        <td style="text-align:left;">${t.status}</td>\n        <td>${t.canceldt||""}</td>\n        <td style="text-align:left;">${t.nature}</td>\n        <td style="text-align:left;">${t.types}</td>\n        <td style="text-align:left;"></td>\n      </tr>\n    `:n+=e<=3?`\n      <tr class="${s}">\n        <td>${e+1}</td>\n        <td style="text-align:left;">${t.gstin}</td>\n        <td style="text-align:left;">${t.tradeName}</td>\n        <td style="text-align:left;">${t.legalName}</td>\n        <td>${t.regDate}</td>\n        <td style="text-align:left;">${t.status}</td>\n        <td>${t.canceldt||""}</td>\n        <td style="text-align:left;">${t.nature}</td>\n        <td style="text-align:left;">${t.types}</td>\n        <td style="text-align:left;"></td>\n      </tr>\n    `:`\n      <tr class="${s}">\n        <td>${e+1}</td>\n        <td style="text-align:left;">${t.gstin}</td>\n        <td style="text-align:left;">${t.tradeName.substring(0,20)}  <span style='color:red'> ....Demo User</span></td>\n        <td style="text-align:left;">${t.legalName.substring(0,20)}  <span style='color:red'> ....Demo User</span></td>\n        <td>${t.regDate}</td>\n        <td style="text-align:left;">NA</td>\n        <td>NA</td>\n        <td style="text-align:left;">${t.nature}</td>\n        <td style="text-align:left;">${t.types}</td>\n        <td style="text-align:left;"></td>\n      </tr>\n    `})),n+='\n      <tr >\n        <td></td>\n        <td style="text-align:left;"></td>\n        <td style="text-align:left;"></td>\n        <td style="text-align:left;"></td>\n        <td></td>\n        <td style="text-align:left;"></td>\n        <td></td>\n        <td style="text-align:left;"></td>\n        <td style="text-align:left;"></td>\n        <td style="text-align:left;"></td>\n      </tr>\n    ',n+="</tbody></table>",n}document.getElementById("fetchGSINs").addEventListener("click",(async()=>{document.getElementById("fetchGSINs").innerHTML="Please Wait....<i class='fa fa-spinner fa-pulse fa-3x fa-fw'></i>";const o=document.getElementById("gstinSearchResult");if(o||(document.getElementById("result").innerHTML="Please Wait...."),!t)return void console.error("Textarea not found!");const l=[...new Set(t.value.split(/\r?\n/).map((t=>t.split(/\t/)[0].trim())).filter(Boolean))];chrome.tabs.query({active:!0,currentWindow:!1},(t=>{const r=t[0];chrome.scripting.executeScript({target:{tabId:r.id},files:["contentscript.js"]},(()=>{chrome.tabs.sendMessage(r.id,{action:"fetchGSTIN",gstins:l},(t=>{t?t&&(o||(document.getElementById("result").innerHTML=i(t),document.getElementById("fetchGSINs").innerHTML='<i class="fa fa-search-plus" aria-hidden="true"></i> Fetch Again'),1==n.checked&&(document.getElementById("result").innerHTML=i(t),document.getElementById("fetchGSINs").innerHTML='<i class="fa fa-search-plus" aria-hidden="true"></i> Fetch Again'),1==e.checked&&chrome.tabs.sendMessage(r.id,{action:"fetchGSTINAddress",gstins:l},(t=>{if(t){if(t){const e={};t.results1.forEach((t=>{e[t.gstin]=t.address})),setTimeout((()=>{const t=document.getElementById("gstinSearchResult");if(t){t.rows[0].cells[9].innerText="Address",t.rows[0].cells[9].innerText="Address";for(let n=1;n<t.rows.length;n++){const s=t.rows[n],a=s.cells[1]?.innerText.trim();a&&void 0!==e[a]&&("Prime"===window.userStatusNow?s.cells[9].innerText=e[a]:s.cells[9].innerHTML=e[a].substring(0,30)+"<sapn style='color:red'> ...Demo User</span>")}}else console.log("tab not avil ");document.getElementById("fetchGSINs").innerHTML='<i class="fa fa-search-plus" aria-hidden="true"></i> Fetch Again'}),1e3)}}else console.log("not fetched")})),1==s.checked&&chrome.tabs.sendMessage(r.id,{action:"fetchGSTINFilling",gstins:l,fy:a},(t=>{if(t){if(t){const e={},n={};t.results2.forEach((t=>{e[t.gstin]=t.filingStatus[0].find((t=>"GSTR3B"===t.rtntype)),n[t.gstin]=t.filingStatus[0].find((t=>"GSTR1"===t.rtntype))}));const s=document.getElementById("gstinSearchResult");if(s){s.rows[0].cells[6].innerText="GSTR1-Return",s.rows[0].cells[7].innerText="R1 Return Date",s.rows[0].cells[8].innerText="GSTR3B-Return",s.rows[0].cells[9].innerText="3B Return Date";for(let t=1;t<s.rows.length;t++){const a=s.rows[t];a.cells[6].innerText="",a.cells[7].innerText="",a.cells[8].innerText="",a.cells[9].innerText="";const i=a.cells[1]?.innerText.trim();i&&void 0!==e[i]&&("Prime"===window.userStatusNow?(a.cells[6].innerText=n[i].taxp,a.cells[7].innerText=n[i].dof,a.cells[8].innerText=e[i].taxp,a.cells[9].innerText=e[i].dof):(a.cells[6].innerText=n[i].taxp,a.cells[7].innerText="Demo-User",a.cells[8].innerText=e[i].taxp,a.cells[9].innerText="Dmeo-User"))}}else console.log("tab not avil Files");document.getElementById("fetchGSINs").innerHTML='<i class="fa fa-search-plus" aria-hidden="true"></i> Fetch Again'}}else console.log("not fetched")}))):console.log("not fetched")}))}))}))})),document.getElementById("downExlgstinsStatusbtn").addEventListener("click",(()=>{const t=XLSX.utils.book_new(),e=document.getElementById("gstinSearchResult");if(e){let n=XLSX.utils.table_to_sheet(e,{raw:!0});Object.keys(n).forEach((t=>{if("!"===t[0])return;const s=parseInt(t.replace(/[^0-9]/g,""))-1,a=t.replace(/[0-9]/g,"").charCodeAt(0)-65,i=e.rows[s]?.cells[a];if(i){const e=i.innerText.trim();n[t].t="s",n[t].v=e,n[t].w=e}})),XLSX.utils.book_append_sheet(t,n,"XLSDEAL-GSTINS-STATUS")}XLSX.writeFile(t,`GSTINS_InfoBy_${session.gstin}.xlsx`)}))})),document.addEventListener("DOMContentLoaded",(()=>{document.getElementById("getallgstr2BBtn").addEventListener("click",(async()=>{intoReturn2BPage();const t=document.getElementById("finYearcl"),e=document.getElementById("result");e.innerHTML="Please Wait....<i class='fa fa-spinner fa-pulse fa-3x fa-fw'></i>";const n=generateFYMonths(t.value);chrome.tabs.query({active:!0,currentWindow:!1},(t=>{const s=t[0];chrome.scripting.executeScript({target:{tabId:s.id},files:["contentscript.js"]},(()=>{chrome.tabs.sendMessage(s.id,{action:"gstr2ballmonths",rtnprds:n},(t=>{t?(load2ballTable(t.allResults),t.allResults.forEach((t=>{}))):e.innerHTML="<b style='color:red'>❌ Not Fetched</b>"}))}))}))})),document.getElementById("getallgstr2BBtnDownload").addEventListener("click",(async()=>{const t=XLSX.utils.book_new(),e=document.getElementById("finYearcl"),n=document.getElementById("totaal2b_8a"),s=XLSX.utils.table_to_sheet(n);n&&(Object.keys(s).forEach((t=>{if("!"===t[0])return;const e=parseInt(t.replace(/[^0-9]/g,""))-1,a=t.replace(/[0-9]/g,"").charCodeAt(0)-65;if(5===a||11===a){const i=n.rows[e]?.cells[a];if(i){const e=i.innerText.trim();s[t].t="s",s[t].v=e,s[t].w=e}}})),XLSX.utils.book_append_sheet(t,s,"GSTR8A_CANCELLED")),XLSX.writeFile(t,`${e.value}_GSTR8A_CANCELED_${session.gstin}.xlsx`)}))})),setTimeout((()=>{document.addEventListener("contextmenu",(t=>t.preventDefault())),document.addEventListener("keydown",(t=>{"F12"===t.key&&t.preventDefault(),(t.ctrlKey&&t.shiftKey&&["I","J","C"].includes(t.key)||t.ctrlKey&&"u"===t.key)&&t.preventDefault()})),setInterval((()=>{const t=(new Date).getTime();(new Date).getTime()-t>200&&(window.location.href="about:blank")}))}),500);